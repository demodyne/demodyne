var partnerDashboardSearchOpportunitiesFormCoveredDepartments=[];var partnerDashboardSearchOpportunitiesFormCoveredCategories=[];var partnerDashboardSearchOpportunitiesFormCoveredKeywords=[];var inboxListTimer;var newsListTimer;$(document).ajaxError(function(c,b,a){if(b.status==401){window.location=location.pathname.substring(location.pathname.indexOf("/"))}});function updateContextualHelp(a){$("#contextual-help").attr("href",$("#contextual-help").data("base-url")+a)}(function(a){a.fn.reload=function(b){this.parent().load(b);return this}}(jQuery));$(function(){var a=["#inbox","#mycontacts","#favorites","#myprop2","#myscn","#impl","#hours","#fundings","#draftmeasures","#banner","#newsletter","#events"];if(location.hash!==""){$('a[href="'+location.hash+'"]').tab("show");updateContextualHelp(location.hash);if($.inArray(location.hash,a)>-1){$("[href=#myspace]").tab("show")}}$('a[data-toggle="tab"]').on("click",function(c){var b;if(typeof $(this).data("tabs")==="undefined"){b=$(this).attr("href");history.pushState(null,null,b)}else{b=$("."+$(this).data("tabs")).find(".active > a").attr("href");history.pushState(null,null,b)}updateContextualHelp(b)});window.addEventListener("popstate",function(c){var b;if(location.hash!==""){b=$("[href="+location.hash+"]");if(b.length){b.tab("show");updateContextualHelp(location.hash)}if($.inArray(location.hash,a)>-1){$("[href=#myspace]").tab("show")}}else{$(".nav-tabsj a:first").tab("show");updateContextualHelp($(".nav-tabsj a:first").attr("href"))}})});$(function(){$("a#layout-browse").popover({trigger:"manual",html:true,placement:"auto",container:"body",animation:false,content:function(){if(!$("#layout-browse-content").length){$('<div id="layout-browse-content" style="display:none">').html("Loading...").appendTo("#pageContent");$.ajax({url:$("#layout-browse").attr("href"),success:function(a){$("#layout-browse-content").html(a);$("#layout-browse").popover("show")}})}return $("#layout-browse-content").html()}}).on("click",function(){console.log("pop");var a=this;$(".popover").popover("hide");$(this).popover("show");return false});$("body").on("click",function(a){if(!$(a.target).parent().hasClass("mini-profile")&&$(a.target).parents(".popover.in").length===0){$("#layout-browse").popover("hide")}});$("a#history-back").click(function(){parent.history.back();return false});$("button#history-back").click(function(){parent.history.back()});$("button#history-home").click(function(){window.location.href=$(this).attr("href")});$("#layout-goto-inbox").on("click",function(){if($("#inbox").length){$("[href=#myspace]").tab("show");$("[href=#inbox]").tab("show");return false}window.location.href=$(this).attr("href")});$("#submit-bug").click(function(){modalDialog("submit-bug-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("button#please-register-button, button#viewing-mode").click(function(){modalDialog("guest-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})});$(function(){$(document).tooltip({position:{my:"center top",at:"center bottom+5"},content:function(){return $(this).prop("title")},show:{duration:0,delay:0,effect:"fold"},hide:{duration:0,delay:0,effect:"fold"}});$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(b,c){var a=$("<li>",{text:c.label});if(c.disabled){a.addClass("ui-state-disabled")}$("<span>",{style:c.element.attr("data-style"),"class":"ui-icon "+c.element.attr("data-class")}).appendTo(a);return a.appendTo(b)}})});$(function(){$("#menuFindPartners").click(function(){$("#findPartners").slideDown();$("#selectedPartners").slideUp();$("#helpSelectPartners").slideUp();return false});$("#menuListPartners").click(function(){$("#findPartners").slideUp();$("#selectedPartners").slideDown();$("#helpSelectPartners").slideUp();return false});$("#menuHelpSelectPartners").click(function(){$("#findPartners").slideUp();$("#selectedPartners").slideUp();$("#helpSelectPartners").slideDown();return false});$("#findPartnersForm").submit(function(){if($("#partnerCategoryList span").length==0&&$("#partnerKeywordList span").length==0){$.msg("You must choose at least a category or write a keyword.","error");return false}$("#findPartnersIcon").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#findPartnersDiv").html(b)},complete:function(){$("#findPartnersIcon").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-search")}});return false});$("#mainPartnerCategories").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons avatar");$("#subPartnerCategories").selectmenu();$("#mainPartnerCategories").iconselectmenu({select:function(b,c){a($(this).val())}});function a(b){$.post("/category/get-subcategories",{main_category:b},function(d){console.log(d);$("#subPartnerCategories").find("option").remove().end();$("#subPartnerCategories").selectmenu("destroy").selectmenu({style:"dropdown"});if(typeof d.name!="undefined"){$("#subPartnerCategories").append('<option value="'+(-b)+'">All</option>');for(var c=0;c<d.name.length;c++){$("#subPartnerCategories").append('<option value="'+d.id[c]+'">'+d.name[c]+"</option>")}$("#subPartnerCategories").selectmenu("refresh",true)}},"json");return false}$("#btnPartnerAddCategory").on("click",function(){if($("#partnerCategoryList span[id="+$("#subPartnerCategories").val()+"]").length==0){$("#partnerCategoryList").append('<span class="badge" id="'+$("#subPartnerCategories").val()+'">'+$("#mainPartnerCategories option:selected").text()+" / "+$("#subPartnerCategories option:selected").text()+' <input name="partnerCategories[]" type="hidden" value="'+$("#subPartnerCategories").val()+'"><a><i class="fa fa-times-circle"></i></a></span>');$("#partnerCategoryList span a").click(function(){$(this).parent().remove()})}});$("#partnerKeywords").on("keypress",function(b){if(b.which==13){$("#btnPartnerAddKeyword").click();return false}});$("#btnPartnerAddKeyword").on("click",function(){var b=$.trim($("#partnerKeywords").val());if(b.length>0&&$('#partnerKeywordList span[id="'+b+'"]').length==0){$("#partnerKeywordList").append('<span class="badge" id="'+b+'">'+b+' <input name="partnerKeywords[]" type="hidden" value="'+b+'"><a><i class="fa fa-times-circle"></i></a></span>');$("#partnerKeywordList span a").click(function(){$(this).parent().remove()});$("#partnerKeywords").val("")}});$("#ckbAddRemovePartner").click(function(){var e=$(this);var b=$(this).attr("user");var d=$(this).attr("proposal");var c="/city/proposal/implementation/add-remove-user/"+d+"/user/"+b;$.ajax({type:"POST",url:c,complete:function(){if(e.is(":checked")){$.msg(e.parent().parent().find("#partnerName").text()+" has been added to Partners list.","success")}else{$.msg(e.parent().parent().find("#partnerName").text()+" has been removed from Partners list.","success")}$("#partnerListSection").load("/city/proposal/implementation/get-partners/"+d,function(){})}})})});function administrationDashboardCitizenProposalsHandlers(){userMiniProfilePopover($("a#administration-dashboard-citizen-proposals-view-profile"));proposalAddRemoveFavoriteHandler($("a#administration-dashboard-add-remove-favorite"));proposalAddProposalToProgramHandler($("a#administration-dashboard-citizen-proposals-add-proposal-to-scenario"),$("#administration-dashboard-citizen-proposals").data("add-proposal-to-scenario"));$("a#page-citizen-proposals").click(function(){$("#administration-dashboard-citizen-proposals").parent().load($(this).attr("href"));return false})}function bannerMyBannersHandlers(){$("#banner-my-banners-add-banner").click(function(){modalDialog("new-banner-dialog",$(this).data("dialog-title"),$(this).data("href"),true);return false})}function bannerAddBannerHandlers(){$("#bannerImage").on("change",function(){imageUploadPreview(this,$("#banner-add-banner-preview"))});$("#banner-add-banner-save-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#banner-add-banner-form").submit()});$("#banner-add-banner-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#banner-add-banner-form").attr("action");if(a.indexOf("publish")<0){$("#banner-add-banner-form").attr("action",a+"/publish/true")}$("#banner-add-banner-form").submit()});$("#banner-add-banner-form").submit(function(){console.log("submit");var a=new FormData($("#banner-add-banner-form")[0]);$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){if(typeof b=="object"){updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"]);$(".modal").modal("hide")}else{$("#banner-add-banner").parent().html(b)}}});return false})}function bannerInactiveBannersHandlers(){$("a#banner-inactive-banners-publish").click(function(){modalDialog("publish-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-inactive-banners-edit").click(function(){modalDialog("edit-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-inactive-banners-delete").click(function(){modalDialog("delete-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#page-inactive-banners").click(function(){$("#banner-inactive-banners").parent().load($(this).attr("href"));return false})}function bannerActiveBannersHandlers(){$("a#banner-active-banners-edit").click(function(){modalDialog("edit-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-active-banners-publish").click(function(){modalDialog("publish-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-active-banners-delete").click(function(){modalDialog("delete-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});renumber_table("#banner-active-banners-table");$("#banner-active-banners-table tbody").sortable({helper:fixHelperModified,stop:function(a,b){renumber_table("#banner-active-banners-table");$("#banner-active-banners-sort-form").submit()}}).disableSelection();$("#sort-proposals-save-button").click(function(){$("#sort-proposals-save-button").prop("disabled","disabled");$("#sort-proposals-save-button-icon").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#sort-proposals-form").submit()});$("#banner-active-banners-sort-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){updatePages(["#banner-carousel-banners"])}}});return false})}function bannerPublishBannerHandlers(){$("#publish-banner-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#banner-publish-banner").data("url"),success:function(a){if(typeof a=="object"){updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"]);$(".modal").modal("hide")}else{$("#banner-publish-banner").parent().html(a)}}});return false})}function bannerDeleteBannerHandlers(){$("#banner-delete-banner-yes").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("href"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"])}else{$("#banner-delete-banner").parent().html(a)}}});return false})}function contentEditableTextLimit(e,d,c){var b=parseInt(e.attr("maxlength"));var a=e.text().length;if(a>(b)){d.html(e.attr("over-text"));d.find("span").addClass("label label-danger");c.forEach(function(g,f){if(g.length){g.prop("disabled",true)}});d.find("span").text(-(b-a))}else{d.html(e.attr("below-text"));d.find("span").removeClass("label label-danger");c.forEach(function(g,f){if(g.length){g.prop("disabled",false)}});d.find("span").text(b-a)}}function commentAddCommentHandlers(){contentEditableTextLimit($("#comment-add-comment-textbox"),$("#comment-add-comment-textbox-count"),[$("#comment-add-comment-submit")]);$("#comment-add-comment-textbox").on("change propertychange click keyup input paste focus",function(a){if($("#comment-add-comment-textbox").text()==""){$("#comment-add-comment-submit").prop("disabled",true)}else{$("#comment-add-comment-submit").prop("disabled",false)}contentEditableTextLimit($("#comment-add-comment-textbox"),$("#comment-add-comment-textbox-count"),$("#comment-add-comment-submit"))});$("#comment-form").submit(function(){$("#addCommentIcon").removeClass("fa-comment-o").addClass("fa-spinner").addClass("fa-pulse");$("#comText").html($("#comment-add-comment-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#comment-add-comment").html(a)}});return false})}function commentListHandlers(){userMiniProfilePopover($("a#comment-list-profile"));$("a#page-com").click(function(){$("#comment-list").load($(this).attr("href"));return false});$("a#thumb").click(function(){var a=$(this);$.post(a.attr("href"),{},function(c){if(c){var b=parseInt(a.prev().text());a.prev().text(b+1);a.parent().children("#thumb").removeAttr("href")}},"json");return false});$("a#comment-list-report").click(function(){modalDialog("report-dialog",$("#comment-list").data("report-comment"),$(this).attr("href"),false);return false});$("a#comment-list-reply").click(function(){var b=$(this).parent().prev();var a=$("#comment-list").data("reply-text");a=a.replace("%date%",b.find("#comment-list-datetime").html());a=a.replace("%user%",b.find("#comment-list-username").html());a=a.replace("%text%",b.find("#comment-list-text").html());$("#comment-add-comment-textbox").html(a).trigger("focus");$("#comment-add-comment")[0].scrollIntoView({behavior:"smooth",block:"start"});return false})}function commentListNoActionsHandlers(){$("a#page-com").click(function(){console.log("page-com");$("#comment-list-no-actions").load($(this).attr("href"));return false})}function eventAddEventHandlers(){contentEditableTextLimit($("#event-add-event-textbox"),$("#event-add-event-textbox-count"),[$("#event-add-event-save-button"),$("#event-add-event-publish-button")]);$("#event-add-event-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#event-add-event-textbox"),$("#event-add-event-textbox-count"),[$("#event-add-event-save-button"),$("#event-add-event-publish-button")])});$("#eventStartDateGroup").datetimepicker({format:"DD/MM/YYYY HH:mm"});$("#eventEndDateGroup").datetimepicker({useCurrent:false,format:"DD/MM/YYYY HH:mm"});$("#eventStartDateGroup").on("dp.change",function(a){$("#eventEndDateGroup").data("DateTimePicker").minDate(a.date)});$("#eventEndDateGroup").on("dp.change",function(a){});$("#eventImage").on("change",function(){imageUploadPreview(this,$("#event-add-event-preview"))});$("#event-add-event-save-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#event-add-event-form").submit()});$("#event-add-event-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#event-add-event-form").attr("action");if(a.indexOf("publish")<0){$("#event-add-event-form").attr("action",a+"/publish/true")}$("#event-add-event-form").submit()});$("#event-add-event-form").submit(function(){$("#eventDescription").html($("#event-add-event-textbox").html());var a=new FormData($("#event-add-event-form")[0]);$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){if(typeof b=="object"){updatePages(["#event-my-events","#event-all-events","#event-upcoming-events"]);$(".modal").modal("hide")}else{$("#event-add-event").parent().html(b)}}});return false})}function eventDeleteEventHandlers(){$("#event-delete-event-yes").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("href"),success:function(a){if(typeof a=="object"){updatePages(["#event-my-events","#event-all-events","#event-upcoming-events"]);$(".modal").modal("hide")}else{$("#event-delete-event").parent().html(a)}}});return false})}function eventMyEventsHandlers(a){$("#event-my-events-month").datepicker({autoclose:true,format:"MM yyyy",viewMode:"months",minViewMode:"months",language:a}).on("changeDate",function(c){var b=c.date;$("#event-my-events").parent().load($("#event-my-events-see-all").data("url")+"/date/"+(b.getMonth()+1)+"/"+b.getFullYear())});$("#event-my-events-add-new-event").click(function(){modalDialog("new-event-dialog",$("#event-my-events").data("add-event"),$(this).data("href"),true);return false});$("a#event-my-events-delete").click(function(){modalDialog("delete-event-dialog",$("#event-my-events").data("delete-event"),$(this).attr("href"),true);return false});$("a#event-my-events-duplicate").click(function(){modalDialog("duplicate-event-dialog",$("#event-my-events").data("duplicate-event"),$(this).attr("href"),true);return false});$("#event-my-events-see-all").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-see-drafts").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-see-month").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-search-form").submit(function(){$(this).find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#event-my-events").replaceWith(b)}});return false});$("a#event-my-events-edit").click(function(){modalDialog("edit-event-dialog",$("#event-my-events").data("edit-event"),$(this).attr("href"),true);return false});$("a#event-my-events-cancel").click(function(){modalDialog("cancel-event-dialog",$("#event-my-events").data("cancel-event"),$(this).attr("href"),true);return false});$("a#event-my-events-publish").click(function(){modalDialog("publish-event-dialog",$("#event-my-events").data("publish-event"),$(this).attr("href"),true);return false});$("a#page-my-events").click(function(){$("#event-my-events").parent().load($(this).attr("href"));return false})}function eventAllEventsHandlers(a){$("#event-all-events-month").datepicker({autoclose:true,format:"MM yyyy",viewMode:"months",minViewMode:"months",language:a}).on("changeDate",function(c){var b=c.date;$("#event-all-events").parent().load($("#event-all-events-see-all").data("url")+"/date/"+(b.getMonth()+1)+"/"+b.getFullYear())});$("#event-all-events-add-new-event").click(function(){modalDialog("new-event-dialog",$("#event-all-events").data("add-event"),$(this).data("href"),true);return false});$("#event-all-events-see-all").click(function(){$("#event-all-events").parent().load($(this).data("url"));return false});$("#event-all-events-see-month").click(function(){$("#event-all-events").parent().load($(this).data("url"));return false});$("#event-all-events-search-form").submit(function(){$(this).find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#event-all-events").replaceWith(b)}});return false});$("a#event-all-events-edit").click(function(){modalDialog("edit-event-dialog",$("#event-all-events").data("edit-event"),$(this).attr("href"),true);return false});$("a#event-all-events-cancel").click(function(){modalDialog("cancel-event-dialog",$("#event-all-events").data("cancel-event"),$(this).attr("href"),true);return false});$("a#page-all-events").click(function(){$("#event-all-events").parent().load($(this).attr("href"));return false});$("a#event-all-events-attend").click(function(){var b=$(this);b.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(b.attr("href"),{},function(e){if(e.success){var d=b.parent().find("#event-all-events-attendees-count");var c=parseInt(d.text());if(e.success==1){b.html('<i class="fa fa-check-circle-o"></i> '+$("#event-all-events").data("attend"));d.text(c-1)}else{b.html('<i class="fa fa-times-circle-o"></i> '+$("#event-all-events").data("decline"));d.text(c+1)}}},"json");return false})}function eventPublishEventHandlers(){$("#publish-event-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#event-publish-event").data("url"),success:function(a){if(typeof a=="object"){if(typeof $("#event-my-events").data("url")!=="undefined"){$("#event-my-events").parent().load($("#event-my-events").data("url"))}if(typeof $("#event-all-events").data("url")!=="undefined"){$("#event-all-events").parent().load($("#event-all-events").data("url"))}if(typeof $("#event-upcoming-events").data("url")!=="undefined"){$("#event-upcoming-events").parent().load($("#event-upcoming-events").data("url"))}$(".modal").modal("hide")}else{$("#event-publish-event").parent().html(a)}}});return false})}function eventCancelEventHandlers(){$("#cancel-event-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#event-cancel-event").data("url"),success:function(a){if(typeof a=="object"){if(typeof $("#event-my-events").data("url")!=="undefined"){$("#event-my-events").parent().load($("#event-my-events").data("url"))}if(typeof $("#event-all-events").data("url")!=="undefined"){$("#event-all-events").parent().load($("#event-all-events").data("url"))}if(typeof $("#event-upcoming-events").data("url")!=="undefined"){$("#event-upcoming-events").parent().load($("#event-upcoming-events").data("url"))}$(".modal").modal("hide")}else{$("#event-publish-event").parent().html(a)}}});return false})}function eventUpcomingEventsHandlers(){$("#event-upcoming-events-see-all").click(function(){$("[href=#all-events]").tab("show");return false})}function eventViewEventHandlers(){updateContextualHelp("#event-view-event")}function eventViewAttendeesHandlers(){userMiniProfilePopover($("a#event-view-attendees-view-profile"));$("a#page-view-attendees").click(function(){$("#event-view-attendees").parent().load($(this).attr("href"));return false});$("#event-view-attendees-attend").click(function(){var a=$(this);a.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(a.data("url"),{},function(b){if(b.success){updatePages(["#event-view-attendees"])}},"json");return false})}function executionAddStepDialogHandlers(){$("#stepStartDate").datepicker({defaultDate:"+1d",minDate:0,dateFormat:"dd/mm/yy",changeMonth:true,numberOfMonths:3,onClose:function(a){$("#stepEndDate").datepicker("option","minDate",a)}});$("#stepEndDate").datepicker({defaultDate:"+1d",dateFormat:"dd/mm/yy",changeMonth:true,numberOfMonths:3,onClose:function(a){$("#stepStartDate").datepicker("option","maxDate",a)}})}function executionTimelineHandlers(){var a=function(d,b){var c=finddren();var f=b.clone();f.children().each(function(e){$(this).width(c.eq(e).width())});return f};$("#timelineTable tbody").sortable({helper:a,stop:function(b,c){}}).disableSelection();$("#addStepForm").submit(function(){console.log("Calling submit...");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#dialogAddNewStep").html(b);if($(".text-danger").length==0){setTimeout(function(){$("#dialogAddNewStep").dialog("close")},2000);$("#timeline").load("/city/proposal/implementation/timeline/"+$("#propUUID").val(),function(){})}else{$(":button:contains('Add step')").attr("disabled",false)}}});return false});$("a#execution-timeline-add-new-step").on("click",function(b){modalDialog("execution-timeline-add-new-step-dialog","Add new Step to Proposal",$(this).attr("href"));return false});$('a[title="Edit Step"]').on("click",function(){var b=$(this).attr("href");$("#editStepName").text($(this).text());$("#dialogEditStep .modal-body").html("Loading step <strong>"+$(this).text()+'</strong>. Please wait... <i class="fa fa-spinner fa-pulse "></i> ').load(b);$("#dialogEditStep").modal({backdrop:"static",keyboard:false,show:true});return false});$(".modal-dialog").draggable({handle:".modal-header"})}function homeLoggedinHandlers(){$("div.product-chooser").not(".disabled").find("div.product-chooser-item").on("click",function(){$(this).parent().parent().find("div.product-chooser-item").removeClass("selected");$(this).addClass("selected");$(this).find('input[type="radio"]').prop("checked",true)});$("#home-step-user-0-next").click(function(){if($('input[name="level-radio"]:checked').length){if($('input[name="level-radio"]:checked').val()=="city"){$("#home-step-user-1").show();$("#home-step-user-0").hide()}else{if($('input[name="level-radio"]:checked').val()=="region"){window.location.href=$('input[name="level-radio"]:checked').data("url")}else{if($('input[name="level-radio"]:checked').val()=="country"){window.location.href=$('input[name="level-radio"]:checked').data("url")}}}}});$("#home-step-user-1-next").click(function(){if($('input[name="user-radio"]:checked').length){if($('input[name="user-radio"]:checked').val()=="proposal"){$("#home-step-user-proposal").show()}else{if($('input[name="user-radio"]:checked').val()=="program"){$("#home-step-user-measure").show()}else{if($('input[name="user-radio"]:checked').val()=="scenario"){$("#home-step-user-scenario").show()}}}$("#home-step-user-1").hide()}});$("#home-step-admin-1-next").click(function(){if($('input[name="admin-radio"]:checked').length){if($('input[name="admin-radio"]:checked').val()=="bne"){$("#home-step-admin-bne").show()}else{if($('input[name="admin-radio"]:checked').val()=="program"){$("#home-step-admin-program").show()}else{if($('input[name="admin-radio"]:checked').val()=="scnprop"){$("#home-step-admin-scenario").show()}}}$("#home-step-admin-1").hide()}});$("button#home-step-goto").click(function(){$($(this).data("show")).show();$($(this).data("hide")).hide()})}function inboxDeleteSelectedHandlers(){$("#inbox-list-delete-selected-form").submit(function(){$("#inbox-delete-selected-yes-button").prop("disabled","disabled");$("#inbox-delete-selected-yes-button-icon").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#inbox-delete-selected").parent().html(a)}});return false})}function inboxMyContactsHandlers(){$("a#page-contact").click(function(){$("#inbox-my-contacts").parent().load($(this).attr("href"));return false});$("a#inbox-my-contacts-send-message").click(function(){modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).attr("href"),true);return false});$("#inbox-my-contacts-new-message-selected").click(function(){if($("#inbox-my-contacts input:checked").length==0){return false}var a="";$("#inbox-my-contacts input:checked").each(function(){a=a+$(this).val()+"%2C%20"});modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).data("href")+"/to/"+a,true);return false});$("a#inbox-my-contacts-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').addClass("btn-orange").removeClass("btn-primary").html('<i class="fa fa-plus-circle"></i> '+$("#user-profile-mini-profile").data("add-contact"));if(typeof $("#inbox-my-contacts").data("url")!=="undefined"){$("#inbox-my-contacts").parent().load($("#inbox-my-contacts").data("url"))}}},"json");return false})}function inboxListHandlersSelectToView(){return'<div class="panel panel-default" id="inbox-view-message"><div class="panel-body" style="min-height: 450px !important; text-align: center; vertical-align: middle; line-height: 450px;"><div class="row"><div class="col-md-12 col-xs-12">'+$("#inbox-list-received").data("select-message")+"</div></div></div></div>"}function inboxListHandlers(a){userMiniProfilePopover($("a#inbox-list-profile-"+a));$("a#page-ibx-"+a).click(function(){$.get($(this).attr("href"),function(b){$("#inbox-list-"+a).replaceWith(b)});return false});$("input#checkbox-"+a).change(function(){if($("input#checkbox-"+a+":checked").length){$("#inbox-delete-selected-"+a).show()}else{$("#inbox-delete-selected-"+a).hide()}return false});$("#inbox-list-delete-more-form-"+a).submit(function(){modalDialog("inbox-delete-more-dialog",$(this).data("dialog-title"),$(this).attr("action")+"?"+$(this).serialize(),false);return false});$("a#inbox-list-message-item-"+a).click(function(){$("#inbox-list-"+a).find(".list-group-item").removeClass("active");$(this).addClass("active").removeClass("notview");$("#inbox-view-div").load($(this).attr("href"));$("#inbox-list-"+a).data("view-url",$(this).attr("href"));return false});clearInterval(inboxListTimer);inboxListTimer=setInterval(function(){$.get($("#inbox-list-received").data("url"),function(b){var c=$("#inbox-list-received").css("display");$("#inbox-list-received").replaceWith(b);$("#inbox-list-received").css("display",c)})},600000);$("#inbox-list-view-received-"+a).click(function(){if($("#inbox-list-received").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-received").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-received").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").show();$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();if(typeof $("#inbox-list-received").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-received").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false});$("#inbox-list-view-sent-"+a).click(function(){if($("#inbox-list-sent").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-received").hide();$("#inbox-list-trash").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-sent").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-sent").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").hide();$("#inbox-list-sent").show();$("#inbox-list-trash").hide();if(typeof $("#inbox-list-sent").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-sent").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false});$("#inbox-list-view-trash-"+a).click(function(){if($("#inbox-list-trash").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-trash").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-trash").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-list-trash").show();if(typeof $("#inbox-list-trash").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-trash").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false})}function inboxNewMessageHandlers(b){contentEditableTextLimit($("#inbox-new-message-textbox"),$("#inbox-new-message-textbox-count"),[$("#inbox-new-message-send-message")]);$("#inbox-new-message-textbox").on("change propertychange click keyup input paste focus",function(d){contentEditableTextLimit($("#inbox-new-message-textbox"),$("#inbox-new-message-textbox-count"),[$("#inbox-new-message-send-message")])});function a(d){return d.split(/,\s*/)}function c(d){return a(d).pop()}$("#msgTo").bind("keydown",function(d){if(d.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active){d.preventDefault()}}).autocomplete({source:function(e,d){$.getJSON(b,{term:c(e.term)},d)},search:function(){var d=c(this.value);if(d.length<2){return false}},focus:function(){return false},select:function(e,f){var d=a(this.value);d.pop();d.push(f.item.value);d.push("");this.value=d.join(", ");return false}});$("#newMessageForm").submit(function(){$("#inbox-new-message-send-message-icon").removeClass("fa-envelope-o").addClass("fa-spinner").addClass("fa-pulse");$("#msgText").html($("#inbox-new-message-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(d){$("#inbox-new-message").parent().html(d);updateInboxLists("all")}});return false})}function inboxPartialMenuHandlers(){$("#inbox-partial-menu-new-message").click(function(){modalDialog("new-message-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("a#page-ibx_filter").click(function(){$("#inbox-partia-menu-filter").removeClass("open");$("#inbox-partia-menu-filter-check").prependTo($(this));$("#inbox-list").parent().load($(this).attr("href"));return false});$("a#inbox-partial-menu-view-sent").click(function(){var a=this;$(this).find("i").removeClass("fa-eye").addClass("fa-spinner").addClass("fa-pulse");$("#inbox-list").parent().load($(this).attr("href"),function(){$(a).find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-eye");if($(a).data("sent")==$("#inbox-partial-menu-view-sent-text").html()){$("#inbox-partial-menu-view-sent-text").html($(a).data("received"));$(a).attr("href",$(a).attr("href").replace("-sent",""))}else{$("#inbox-partial-menu-view-sent-text").html($(a).data("sent"));$(a).attr("href",$(a).attr("href")+"-sent")}});return false});$("a#inbox-partial-menu-refresh").click(function(){var a=this;$("#inbox-partial-menu-refresh-icon").addClass("fa-spin");if(typeof $("#inbox-list-received").data("url")!=="undefined"){$.get($("#inbox-list-received").data("url"),function(b){var c=$("#inbox-list-received").css("display");$("#inbox-list-received").replaceWith(b);$("#inbox-list-received").css("display",c);$("#inbox-partial-menu-refresh-icon").removeClass("fa-spin")})}return false});$("a#inbox-partial-menu-search-receiver").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-receiver-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-receiver-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-sender").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-sender-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-sender-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-subject").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-subject-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-subject-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-message").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-message-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-message-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-all").click(function(){if($("#inbox-partial-menu-search-receiver").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-receiver").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-receiver-input").attr("value","1")}if($("#inbox-partial-menu-search-sender").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-sender").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-sender-input").attr("value","1")}if($("#inbox-partial-menu-search-subject").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-subject").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-subject-input").attr("value","1")}if($("#inbox-partial-menu-search-message").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-message").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-message-input").attr("value","1")}return false});$("#inbox-partial-menu-search-form").submit(function(){$("#inbox-partial-menu-search-submit").find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");var a=$(this).attr("action")+"/sk/"+$("#inbox-partial-menu-search-keywords").val().trim()+"/sr/"+$("#inbox-partial-menu-search-receiver-input").attr("value")+"/ss/"+$("#inbox-partial-menu-search-sender-input").attr("value")+"/st/"+$("#inbox-partial-menu-search-subject-input").attr("value")+"/sm/"+$("#inbox-partial-menu-search-message-input").attr("value");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:a,success:function(b){$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();if($("#inbox-list-search").length){$("#inbox-list-search").replaceWith(b).show()}else{$("#inbox-list-received").parent().append(b)}$("#inbox-partial-menu-search-submit").find("i").addClass("fa-search").removeClass("fa-spinner").removeClass("fa-pulse")}});return false})}function inboxViewHandlers(a){userMiniProfilePopover($("a#inbox-view-message-view-profile"));if(a){$("span#inbox-unread-messages-count").html($("#inbox-unread-messages-count").html()-1)}$("#inbox-view-message-delete-one").click(function(){var b=$(this);$.get($(this).data("url"),function(c){$("#inbox-view-div").replaceWith('<div class="col-md-6" id="inbox-view-div"><div class="panel panel-default" id="inbox-view-message" ><div class="panel-body" style="min-height:450px !important;text-align: center;vertical-align: middle;line-height: 450px; " ><div class="row"><div class="col-md-12 col-xs-12">'+b.data("message")+"</div></div></div></div></div>");updateInboxLists(c.type);updateInboxLists("trash")});return false});$("#inbox-view-message-reply").click(function(){modalDialog("inbox-reply-dialog",$(this).data("dialog-title")+" "+$(this).data("type"),$(this).data("url"),true)});$("#inbox-view-message-reply-all").click(function(){modalDialog("inbox-reply-all-dialog",$(this).data("dialog-title"),$(this).data("url"),true)});$("#inbox-view-message-forward").click(function(){modalDialog("inbox-forward-dialog",$(this).data("dialog-title"),$(this).data("url"),true)});$("#inbox-view-message-report").click(function(){modalDialog("add-report",$(this).data("dialog-title"),$(this).data("url"),false)});$("#inbox-view-message-print").click(function(){$("#inbox-view-message-print-zone").print()})}function measureAddMesureRemoveLinkHandler(b,a){b.find("a").click(function(){$(this).parents("#measure-add-measure-link-row").remove();if(!a&&!$("#measure-add-measure-links").find("a").length){$("#measure-add-measure-publish").prop("disabled","disabled")}return false});if($("#measure-add-measure-links").find("a").length){$("#measure-add-measure-publish").prop("disabled",false)}}function measureAddMeasureHandlers(b,a){contentEditableTextLimit($("#measure-add-measure-textbox"),$("#measure-add-measure-textbox-count"),[$("#measure-add-measure-save"),$("#measure-add-measure-publish")]);$("#measure-add-measure-textbox").on("change propertychange click keyup input paste focus",function(c){contentEditableTextLimit($("#measure-add-measure-textbox"),$("#measure-add-measure-textbox-count"),[$("#measure-add-measure-save"),$("#measure-add-measure-publish")])});$(".input-daterange").datepicker({format:"dd/mm/yyyy",calendarWeeks:true,autoclose:true,todayHighlight:true});measureAddMesureRemoveLinkHandler($("#measure-add-measure-links"),a);$("#measure-add-measure-new-link").click(function(){var c=$('<div class="bot5" id="measure-add-measure-link-row"><div style="width: 250px; float: left;" class="bot5"><input type="url" name="links[]" class="form-control col-md-11 text-change" value=""></div><div style="width: 20px; float: left; padding: 10px 0 0 5px;"><a href="" id="measure-add-measure-remove-link"><i class="fa fa-times-circle darkgray"></i></a></div></div>');c.appendTo($("#measure-add-measure-links"));measureAddMesureRemoveLinkHandler(c,a)});$("#measure-add-measure-publish").click(function(){$("#measure-add-measure-publish").prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");var c=$("#measure-add-measure-form").attr("action");if(c.indexOf("publish")<0){$("#measure-add-measure-form").attr("action",c+"/publish/true")}$("#measure-add-measure-form").submit()});$("#measure-add-measure-form").submit(function(){$("#propDescription").html($("#measure-add-measure-textbox").html());$("#measure-add-measure-save").prop("disabled","disabled");$("#measure-add-measure-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(c){if(typeof c=="object"){updatePages(["#measure-view-measure","#administration-dashboard-draft-measures","#measure-all-measures","#city-news-list"]);$(".modal").modal("hide")}else{$("#measure-add-measure").parent().html(c)}}})});$("#main_category").on("change",function(){updateSubCategories($(this).val(),b)})}function mesureAllMeasuresHandlers(){var a=$("#measure-all-measures");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler($("a#measure-all-measures-favorite"));userMiniProfilePopover(a.find("a#view-profile"));$("#measure-all-measures-add-new-measure").click(function(){modalDialog("new-measure-dialog",$(this).data("dialog-title").replace("$level$",a.find("#level-name").html()),$(this).data("url"),true)});$("a#page-all-measures").click(function(){console.log("page");a.parent().load($(this).attr("href"));return false})}function measureClaimOwnershipHandlers(){$("#measure-claim-ownership-form").submit(function(){$("#measure-claim-ownership-submit").prop("disabled","disabled").find("i").removeClass("fa-certificate").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){if(typeof $("#measure-view-measure").data("url")!=="undefined"){$("#measure-view-measure").parent().load($("#measure-view-measure").data("url"))}$(".modal").modal("hide")}else{$("#measure-claim-ownership").parent().html(a)}}});return false})}function mesureDraftMeasuresHandlers(){$("#administration-dashboard-draft-measures-add-new-measure").click(function(){modalDialog("new-measure-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("a#administration-dashboard-draft-measures-edit-draft").click(function(){modalDialog("edit-draft-measure-dialog",$("#administration-dashboard-draft-measures").data("edit-measure"),$(this).attr("href"),true);return false});$("a#page-draft-proposals").click(function(){$("#administration-dashboard-draft-measures").parent().load($(this).attr("href"));return false})}function measureViewMeasureHandlers(){var a=$("#measure-view-measure");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));updateContextualHelp("#measure-view-measure");proposalAddRemoveFavoriteHandler($("#measure-view-measure-favorite"));userMiniProfilePopover($("a#measure-view-measure-view-profile"));$("#measure-view-measure-edit").click(function(){modalDialog("edit-measure-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-view-history").click(function(){modalDialog("view-history-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-claim-ownership").click(function(){modalDialog("claim-ownership-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false})}function measureViewHistoryHandlers(){userMiniProfilePopover($("a#measure-view-history-view-profile"))}function newsAllNewsHandlers(){userMiniProfilePopover($("a#news-all-news-view-profile"));$("a#page-all-news").click(function(){$("#news-all-news").parent().load($(this).attr("href"));return false});clearInterval(newsListTimer);newsListTimer=setInterval(function(){updatePages(["#news-all-news"])},600000)}function newsletterAddNewsletterHandlers(){var d=$("#mainCategories option:first").val();var c=$("#mainCategories option:first").data("style");var f=c.substring(23,c.indexOf(";")-2);var e=$("#mainCategories option:first").text();$("#mainCategories").TFOiconSelectImg({create:function(h,j){var i=$(this).TFOiconSelectImg("widget");var g=$('<span id="'+this.id+'ImgSelected" class="TFOSizeImgSelected"> ').html("&nbsp;").appendTo(i);g.attr("style",$(this).children(":first").data("style"))},change:function(g,h){$("#"+this.id+"ImgSelected").attr("style",h.item.element.data("style"));d=h.item.value;f=h.item.element.data("style");f=f.substring(23,f.indexOf(";")-2);e=h.item.label},open:function(g,h){$(".ui-selectmenu-open").zIndex($(".modal").zIndex()+1)}}).TFOiconSelectImg("menuWidget").addClass("ui-menu-icons customicons");$("#picture-file").on("change",function(){imageUploadPreview(this,$("#newsletter-add-newsletter-preview"))});function a(){$("#newsletter-add-newsletter-title").html($("#nlSubject").val());$("#newsletter-add-newsletter-message").html(nl2br($("#newsletter-add-newsletter-textbox").html()));if($("#nlContact").val()!=""){$("#newsletter-add-newsletter-contact").html($("#nlContact").val())}else{$("#newsletter-add-newsletter-contact").html($("#newsletter-add-newsletter").data("no-contact"))}if($("#nlUrl").val()!=""){$("#newsletter-add-newsletter-url").html($('<a target="_blank">').attr("href",$("#nlUrl").val()).text($("#nlUrl").val()))}else{$("#newsletter-add-newsletter-url").html($("#newsletter-add-newsletter").data("no-url"))}}if($("#newsletter-add-newsletter").find(".text-danger").length){a();b()}$("#nlSubject, #newsletter-add-newsletter-textbox, #nlContact, #nlUrl").on("change propertychange click keyup input paste",a);$("a#newsletter-add-newsletter-remove-category").click(function(){$(this).parent().remove();b();return false});function b(){$("#newsletter-add-newsletter-category-preview").empty();if(!$("#newsletter-add-newsletter-category-list > span").length){$("#newsletter-add-newsletter-category-preview").html($("#newsletter-add-newsletter").data("no-categories-selected"))}else{$("#newsletter-add-newsletter-category-list > span").each(function(){var g=$(this).clone();g.find("span").remove();g.find("input").remove();g.find("a").remove();$("<span>&nbsp;</span>").appendTo(g);g.appendTo($("#newsletter-add-newsletter-category-preview"))})}}$("#newsletter-add-newsletter-add-category").click(function(){if(!$("#category-"+d).length&&$("#newsletter-add-newsletter-category-list").find("input").length<3){var g=$('<span id="category-'+d+'">');$("<span>&nbsp;</span>").appendTo(g);$('<img width="32" height="32" title="'+e+'"	src="'+f+'">&nbsp; ').appendTo(g);$('<input type="hidden" name="categories[]" value="'+d+'">').appendTo(g);$("<span>&nbsp;</span>").appendTo(g);$('<a href=""><i class="fa fa-times-circle darkgray"></i></a>').click(function(){$(this).parent().remove();b();return false}).appendTo(g);g.appendTo($("#newsletter-add-newsletter-category-list"));b()}});$("#newsletter-add-newsletter-citizens").click(function(){if($(this).prop("checked")){$("#newsletter-add-newsletter-champions").prop("checked",false)}newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-champions").click(function(){if($(this).prop("checked")){$("#newsletter-add-newsletter-citizens").prop("checked",false)}newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-partners").click(function(){newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-contacts").click(function(){newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var g=$("#newsletter-add-newsletter-form").attr("action");if(g.indexOf("publish")<0){$("#newsletter-add-newsletter-form").attr("action",g+"/publish/true")}$("#newsletter-add-newsletter-form").submit()});$("#newsletter-add-newsletter-form").submit(function(){console.log("submit");$("#nlMessage").html($("#newsletter-add-newsletter-textbox").html());var g=new FormData($("#newsletter-add-newsletter-form")[0]);$("#newsletter-add-newsletter-save-button > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:g,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(h){if(typeof h=="object"){if(typeof $("#newsletter-my-newsletters").data("url")!=="undefined"){$("#newsletter-my-newsletters").parent().load($("#newsletter-my-newsletters").data("url"))}$(".modal").modal("hide")}else{$("#newsletter-add-newsletter").parent().html(h)}}});return false})}function newsletterMyNewslettersHandlers(){newsletterAddNewsletterUpdateSendTo();$("#newsletter-my-newsletters-add-new-newsletter").click(function(){modalDialog("new-newsletter-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("a#page-my-newsletters").click(function(){$("#newsletter-my-newsletters").parent().load($(this).attr("href"));return false});$("a#newsletter-my-newsletters-edit").click(function(){modalDialog("edit-newsletter-dialog",$("#newsletter-my-newsletters").data("edit-newsletter"),$(this).attr("href"),true);return false})}function resizeImages(f,d,b,c){var e=f.prop("files")[0];if(e.type.match("image.*")){var a=new FileReader();a.onload=function(h){var g=new Image();g.onload=function(){b(resizeInCanvas(g,d))};g.src=h.target.result};a.readAsDataURL(e)}else{c()}}function resizeInCanvas(c,d){var b=500;var e=b/c.width;d?d=d[0]:$("<canvas>")[0];d.width=c.width*e;d.height=c.height*e;d.style.width="100%";var a=d.getContext("2d");a.drawImage(c,0,0,d.width,d.height);return d.toDataURL("image/jpeg")}function proposalAddEditProposalHandlers(){contentEditableTextLimit($("#proposal-add-edit-proposal-textbox"),$("#proposal-add-edit-proposal-textbox-count"),[$("#proposal-add-edit-proposal-save-button"),$("#proposal-add-edit-proposal-publish-button")]);$("#proposal-add-edit-proposal-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#proposal-add-edit-proposal-textbox"),$("#proposal-add-edit-proposal-textbox-count"),[$("#proposal-add-edit-proposal-save-button"),$("#proposal-add-edit-proposal-publish-button")])});$("canvas").each(function(){if(typeof $(this).data("image")!=="undefined"){var a=$(this)[0];var b=new Image();b.onload=function(){a.width=b.width;a.height=b.height;a.style.width="100%";var c=a.getContext("2d");c.drawImage(b,0,0,a.width,a.height)};b.src=$(this).data("image")}});$("#imageFile").change(function(){$(".modal-body").block({message:"Resizing image..."});if($(this).hasExtension(["jpg","png","gif","jpeg","bmp","tiff"])){$(this).siblings(".red").html("");var a=null;if(!$("#proposal-add-edit-proposal-image-1").is(":visible")){a=$("#proposal-add-edit-proposal-image-1")}else{if(!$("#proposal-add-edit-proposal-image-2").is(":visible")){a=$("#proposal-add-edit-proposal-image-2")}else{if(!$("#proposal-add-edit-proposal-image-3").is(":visible")){a=$("#proposal-add-edit-proposal-image-3")}else{$(this).siblings(".red").html($("#proposal-add-edit-proposal").data("error-image-size"));$("#imageFile").wrap("<form>").parent("form").trigger("reset");$("#imageFile").unwrap();$(".modal-body").unblock()}}}if(a){resizeImages($(this),a.find("canvas"),function(b){a.find("input").val(b);a.show();$("#imageFile").wrap("<form>").parent("form").trigger("reset");$("#imageFile").unwrap();$(".modal-body").unblock()},function(){})}}else{$(this).siblings(".red").html($("#proposal-add-edit-proposal").data("error-image-type"));$(".modal-body").unblock()}});$("a#proposal-add-edit-proposal-remove-image").click(function(){$(this).siblings("input").val("");$(this).parent().hide();$("#imageFile").prop("disabled",false);return false});$("#proposal-add-edit-proposal-save-button").click(function(){$("#proposal-add-edit-proposal-save-button").prop("disabled","disabled");$("#proposal-add-edit-proposal-save-button").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#proposal-add-edit-proposal-form").submit()});$("#proposal-add-edit-proposal-publish-button").click(function(){$("#proposal-add-edit-proposal-publish-button").prop("disabled","disabled");$("#proposal-add-edit-proposal-publish-button-icon").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#proposal-add-edit-proposal-form").attr("action");if(a.indexOf("publish")<0){$("#proposal-add-edit-proposal-form").attr("action",a+"/publish/true")}$("#proposal-add-edit-proposal-form").submit()});$("#proposal-add-edit-proposal-form").submit(function(){$("#propDescription").html($("#proposal-add-edit-proposal-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){if(a.level=="edit"){updatePages(["#proposal-view"])}else{updatePages(["#proposal-my-proposals","#proposal-all-proposals","#news-all-news"])}$(".modal").modal("hide")}else{$("#proposal-add-edit-proposal").parent().html(a)}}});return false});$("input[name=level]").change(function(){$("#add-proposal-category-image").html('<i class="fa fa-spinner fa-pulse fa-2x"></i>');$.post($("#proposal-add-edit-proposal").data("get-categories-url")+"/level/"+$('input[name="level"]:checked').val(),function(c){$("#main_category option").remove();if(typeof c.name!="undefined"){for(var a=0;a<c.name.length;a++){$("#main_category").append('<option value="'+c.id[a]+'" style="background: url('+c.image[a]+') no-repeat; background-size: 32px 32px;  padding-left: 35px; padding-top:10px; height:35px;">'+c.name[a]+"</option>")}}$("#main_category").val($("#main_category option:first").val());var b=$("#main_category").find("option:selected").css("background-image");b=b.substring(4,b.length-1);$("#add-proposal-category-image").html('<img width="32px" height="32px" src='+b+">");updateSubCategories($("#main_category").find("option:selected").val(),$("#proposal-add-edit-proposal").data("get-subcategories-url")+"/level/"+$('input[name="level"]:checked').val())},"json");return false});$("#main_category").on("change",function(){var a=$('input[name="level"]:checked').length?$('input[name="level"]:checked').val():$('input[name="level"]').val();updateSubCategories($(this).val(),$("#proposal-add-edit-proposal").data("get-subcategories-url")+"/level/"+a)})}function proposalAddRemoveFavoriteHandler(a){var b="Add Favorite",c="Remove Favorite";if(a.length==0){return}if(typeof a.parents(".parent").data("add-favorite")!=="undefined"){b=a.parents(".parent").data("add-favorite")}if(typeof a.parents(".parent").data("remove-favorite")!=="undefined"){c=a.parents(".parent").data("remove-favorite")}a.click(function(){var d=$(this);var f=d.data("favorite");var e=d.html();d.find("i").removeClass("fa-heart").removeClass("fa-heart-o").addClass("fa-spinner").addClass("fa-pulse");$.post(d.attr("href"),{},function(g){if(g.success){if(typeof $("#proposal-my-favorites").data("url")!=="undefined"){$("#proposal-my-favorites").parent().load($("#proposal-my-favorites").data("url"))}d.html((g.success==1)?'<i class="fa fa-heart-o"></i> '+b:'<i class="fa fa-heart"></i> '+c)}else{d.html(e)}},"json").done(function(){});return false})}function proposalAddProposalToProgramHandler(a){a.click(function(){modalDialog("add-proposal-to-program-dialog",a.parents(".parent").data("add-to-my-program"),$(this).attr("href"),false);return false})}function proposalRemoveProposalFromProgramHandler(a){a.click(function(){var b=$(this);b.find("i").removeClass("fa-unlink").addClass("fa-spinner").addClass("fa-pulse");$.post(b.attr("href"),{},function(c){var d=b.data("id");b.html('<i class="fa fa-link"></i> '+b.parents(".parent").data("add-to-my-program"));b.attr("href",b.attr("href").replace("remove-",""));b.attr("id","add-to-program");b.unbind("click");proposalAddProposalToProgramHandler(b);if(typeof $("#program-all-programs").data("url")!=="undefined"){updatePages(["#program-all-programs","#program-my-programs"])}else{updatePages(["#program-view-aggregated-program"])}},"json").done(function(){});return false})}function proposalAllProposalsHandlers(){var a=$("#proposal-all-proposals");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover(a.find("a#view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));a.find("#add-new-proposal").click(function(){modalDialog("add-new-proposal-dialog",$(this).data("dialog-title").replace("$level$",a.find("#level-name").html()),$(this).data("url"));return false});$("a#page-all-proposals").click(function(){$("#proposal-all-proposals").parent().load($(this).attr("href"));return false})}function proposalDeleteHandlers(){$("#delete-proposal-yes-button").click(function(){$("#delete-proposal-yes-button").prop("disabled","disabled");$("#delete-proposal-yes-button-icon").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).attr("href"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");parent.history.back()}else{$("#delete-proposal-content").parent().html(a)}}});return false})}function proposalMyFavoritesHandlers(){var a=$("#proposal-my-favorites");userMiniProfilePopover($("a#proposal-my-favorites-view-profile"));proposalAddRemoveFavoriteHandler($("a#proposal-my-favorites-remove-favorite"));proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));$("a#page-fav").click(function(){$("#proposal-my-favorites").reload($(this).attr("href"));return false})}function proposalMyProposalsHandlers(){var a=$("#proposal-my-proposals");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler($("a#proposal-my-proposals-favorite"));$("a#page-my-prop").click(function(){$("#proposal-my-proposals").parent().load($(this).attr("href"));return false});$("#proposal-my-proposals-new-proposal").click(function(){modalDialog("add-new-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"));return false})}function proposalProlongDebateHandlers(){$("#proposal-prolong-debate-yes-button").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-calendar-plus-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("url"),success:function(a){if(typeof a=="object"){updatePages(["#proposal-view"])}$(".modal").modal("hide")}});return false})}function proposalPublishProposalHandlers(){$("#proposal-publish-proposal-yes-button").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("url"),success:function(a){if(typeof a=="object"){updatePages(["#proposal-view"]);$(".modal").modal("hide")}else{$("#publish-proposal-dialog").parent().html(a)}}});return false})}function proposalUserProposalsHandlers(){var a=$("#proposal-user-proposals");proposalAddRemoveFavoriteHandler($("a#proposal-user-proposals-favorite"));proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));$("a#page-user-proposals").click(function(){$("#proposal-user-proposals").parent().load($(this).attr("href"));return false})}function proposalViewHandlers(){updateContextualHelp("#proposal-view-proposal");$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});var a=$("#proposal-view");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover($("a#proposal-view-profile"));proposalAddRemoveFavoriteHandler($("#proposal-view-favorite"));$("#proposal-view-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#proposal-view-proposal-publish").click(function(){modalDialog("publish-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#proposal-view-proposal-delete").click(function(){modalDialog("delete-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),false)});$("#proposal-view-proposal-extend-debate").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#proposal-view-proposal-edit").click(function(){modalDialog("add-edit-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false})}function partnerSelectDepartmentsPartialFormHandlers(a){$(a+"-add-departments").click(function(){if(!$(a+"-from-departments option:selected").length){return false}moveSelect2Select($(a+"-from-departments :selected"),$(a+"-to-departments"));orderOptgroups()});$(a+"-add-all-departments").click(function(){$(a+"-from-departments option").each(function(){moveSelect2Select($(this),$(a+"-to-departments"))});orderOptgroups();return false});$(a+"-remove-departments").click(function(){if(!$(a+"-to-departments option:selected").length){return false}moveSelect2Select($(a+"-to-departments :selected"),$(a+"-from-departments"));orderOptgroups();return false});$(a+"-remove-all-departments").click(function(){$(a+"-to-departments option").each(function(){moveSelect2Select($(this),$(a+"-from-departments"))});orderOptgroups();return false})}function partnerProfilePartnerSelectCategoriesHandlers(){removeEmptyGroups();orderOptgroups();partnerSelectCategoriesPartialFormHandlers("#user-profile-partner-select-categories");$("#user-profile-partner-select-categories-form").submit(function(){$("#user-profile-partner-select-categories-to-categories option").prop("selected",true);$("#user-profile-partner-select-categories-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#partner-profile-partner-presentation-category-list").find("span").remove();$("#user-profile-partner-select-categories-to-categories optgroup").each(function(){var e=$(this).find("option").first().css("background-image");e=e.substring(5,e.length-2);var d=$('<span class="right5">');var b=$('<img src="'+e+'" valign="middle" width="34" height="34" title="" class="round5">');var c=$(this).attr("label");var f="";$(this).find("option").each(function(){f+=c+" - "+$(this).text()+"<br>"});b.attr("title",f);d.append(b);d.insertBefore("#partner-profile-partner-presentation-goto-categories")})},complete:function(){$("#user-profile-partner-select-categories-save > i").addClass("fa-floppy-o").removeClass("fa-spinner").removeClass("fa-pulse");$("#user-profile-partner-select-categories-to-categories option").prop("selected",false)}});return false})}function partnerProfilePartnerSelectDepartmentsHandlers(){removeEmptyGroups();orderOptgroups();partnerSelectDepartmentsPartialFormHandlers("#user-profile-partner-select-regions");$("#user-profile-partner-select-regions-form").submit(function(){$("#user-profile-partner-select-regions-to-departments option").prop("selected",true);$("#user-profile-partner-select-regions-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#partner-profile-partner-presentation-department-no-regions").html($("#user-profile-partner-select-regions-to-departments optgroup").length);$("#partner-profile-partner-presentation-department-no-departments").html($("#user-profile-partner-select-regions-to-departments option").length);var b="";$("#user-profile-partner-select-regions-to-departments optgroup").each(function(){var c=$(this).attr("label");$(this).find("option").each(function(){b+=c+" - "+$(this).text()+"<br>"});$("#partner-profile-partner-presentation-department-list").attr("title",b)})},complete:function(){$("#user-profile-partner-select-regions-save > i").addClass("fa-floppy-o").removeClass("fa-spinner").removeClass("fa-pulse");$("#user-profile-partner-select-regions-to-departments option").prop("selected",false)}});return false})}function partnerProfilePartnerPresentationHandlers(a){setLastCitySearch($("#usrPostalcode").val());$("#partner-profile-partner-presentation-goto-categories").click(function(){$("[href=#categ]").tab("show")});$("#partner-profile-partner-presentation-goto-departments").click(function(){$("[href=#area]").tab("show")});removeKeywordHandler("#partner-profile-partner-presentation-keyword-list");$("#partner-profile-partner-presentation-keyword-input").on("keypress",function(b){if(b.which==13){$("#partner-profile-partner-presentation-add-keyword-button").click();return false}});$("#partner-profile-partner-presentation-add-keyword-button").on("click",function(){var b=$.trim($("#partner-profile-partner-presentation-keyword-input").val());if(b.length>0&&$('#partner-profile-partner-presentation-keyword-list span[id="'+b+'"]').length==0){$("#partner-profile-partner-presentation-keyword-list").append('<span class="badgegray right5" id="'+b+'">'+b+'<input name="keywords[]" type="hidden" value="'+b+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a> </span>');removeKeywordHandler("#partner-profile-partner-presentation-keyword-list");$("#partner-profile-partner-presentation-keyword-input").val("")}});$("#usrPostalcode").on("keyup change",function(){getCities(a)});$(".partner-presentation-text-change").on("keypress",function(c){if(c.which==13){var b=$(this).closest("form").find(":focusable").not("a, button");b.eq(b.index(this)+1).focus();return false}});$("#user-profile-partner-presentation-form").submit(function(){$("#partner-profile-partner-presentation-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#partner-profile-partner-presentation").parent().html(b)}});return false});$("#partner-profile-partner-presentation-reset").click(function(){$("#partner-profile-partner-presentation-reset > i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#partner-profile-partner-presentation").parent().load($(this).attr("href"));return false})}function partnerSearchOppotunitiesFormResetDepartments(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});$.each(partnerDashboardSearchOpportunitiesFormCoveredDepartments,function(a,b){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-departments > optgroup > option[value="'+b+'"]'),$("#partner-dashboard-search-opportunities-form-to-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-department-list").empty();$("#partner-dashboard-search-opportunities-form-no-departments").html($("#partner-dashboard-search-opportunities-form-to-departments > optgroup ").length);$("#partner-dashboard-search-opportunities-form-to-departments > optgroup > option").each(function(){$("#partner-dashboard-search-opportunities-form-department-list").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredDepartments)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="departments[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')});$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){$(this).parent().remove();return false})}function partnerSearchOppotunitiesFormDepartmentHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredDepartments=a;removeEmptyGroups();orderOptgroups();partnerSelectDepartmentsPartialFormHandlers("#partner-dashboard-search-opportunities-form");$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-departments > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-departments"));orderOptgroups();$(this).parent().remove();return false});$("#partner-dashboard-search-opportunities-form-collapse-region-button").click(function(){$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("show");$("#partner-dashboard-search-opportunities-form-collapse-region-button").attr("disabled","disabled");return false});$("#partner-dashboard-search-opportunities-form-save-departments").click(function(){$("#partner-dashboard-search-opportunities-form-department-list").empty();$("#partner-dashboard-search-opportunities-form-no-departments").html($("#partner-dashboard-search-opportunities-form-to-departments > optgroup ").length);$("#partner-dashboard-search-opportunities-form-to-departments > optgroup > option").each(function(){$("#partner-dashboard-search-opportunities-form-department-list").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredDepartments)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="departments[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')});$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-departments > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-departments"));orderOptgroups();$(this).parent().remove();return false});$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-region-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-cancel-departments").click(function(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});$("#partner-dashboard-search-opportunities-form-department-list > span").each(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-departments > optgroup > option[value="'+$(this).data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-to-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-region-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-reset-department-list").click(function(){partnerSearchOppotunitiesFormResetDepartments();return false});$("#partner-dashboard-search-opportunities-form-clear-department-list").click(function(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-no-departments").html("0");$("#partner-dashboard-search-opportunities-form-department-list").empty();return false})}function partnerSelectCategoriesPartialFormHandlers(a){$(a+"-add-categories").click(function(){if(!$(a+"-from-categories option:selected").length){return false}moveSelect2Select($(a+"-from-categories :selected"),$(a+"-to-categories"));orderOptgroups();return false});$(a+"-add-all-categories").click(function(){$(a+"-from-categories option").each(function(){moveSelect2Select($(this),$(a+"-to-categories"))});orderOptgroups();return false});$(a+"-remove-categories").click(function(){if(!$(a+"-to-categories option:selected").length){return false}moveSelect2Select($(a+"-to-categories :selected"),$(a+"-from-categories"));orderOptgroups();return false});$(a+"-remove-all-categories").click(function(){$(a+"-to-categories option").each(function(){moveSelect2Select($(this),$(a+"-from-categories"))});orderOptgroups();return false})}function partnerSearchOppotunitiesFormRemoveCategoryHandler(){$("#partner-dashboard-search-opportunities-form-line span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-categories > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-categories"));orderOptgroups();if($(this).parent().siblings().length){$(this).parent().remove()}else{$(this).parents("tr").remove()}return false})}function partnerSearchOppotunitiesFormResetCategories(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});$.each(partnerDashboardSearchOpportunitiesFormCoveredCategories,function(a,b){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-categories > optgroup > option[value="'+b+'"]'),$("#partner-dashboard-search-opportunities-form-to-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-categories-table").empty();$("#partner-dashboard-search-opportunities-form-to-categories > optgroup").each(function(){var b=$(this).children().first().css("background-image");b=b.substring(5,b.length-2);console.log(b);var a=$('<tr><td style="width:32px; border-top:none;"><img src="'+b+'" height="24" width="24" title="'+$(this).attr("label")+'">&nbsp;</td><td style="line-height:1.6em; border-top:none;" id="partner-dashboard-search-opportunities-form-line"></td></tr>');$("#partner-dashboard-search-opportunities-form-categories-table").append(a);$(this).children().each(function(){console.log("Add option "+$(this).text());a.find("#partner-dashboard-search-opportunities-form-line").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredCategories)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="categories[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')})});partnerSearchOppotunitiesFormRemoveCategoryHandler()}function partnerSearchOppotunitiesFormCategoryHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredCategories=a;removeEmptyGroups();orderOptgroups();partnerSelectCategoriesPartialFormHandlers("#partner-dashboard-search-opportunities-form");partnerSearchOppotunitiesFormRemoveCategoryHandler();$("#partner-dashboard-search-opportunities-form-collapse-categories-button").click(function(){$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("show");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").attr("disabled","disabled");return false});$("#partner-dashboard-search-opportunities-form-save-categories").click(function(){$("#partner-dashboard-search-opportunities-form-categories-table").empty();$("#partner-dashboard-search-opportunities-form-to-categories > optgroup").each(function(){var c=$(this).children().first().css("background-image");c=c.substring(5,c.length-2);var b=$('<tr><td style="width:32px; border-top:none;"><img src="'+c+'" height="24" width="24" title="'+$(this).attr("label")+'">&nbsp;</td><td style="line-height:1.6em; border-top:none;" id="partner-dashboard-search-opportunities-form-line"></td></tr>');$("#partner-dashboard-search-opportunities-form-categories-table").append(b);$(this).children().each(function(){b.find("#partner-dashboard-search-opportunities-form-line").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredCategories)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="categories[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')})});partnerSearchOppotunitiesFormRemoveCategoryHandler();$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-cancel-categories").click(function(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});$("#partner-dashboard-search-opportunities-form-line > span").each(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-categories > optgroup > option[value="'+$(this).data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-to-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-reset-categories-list").click(function(){partnerSearchOppotunitiesFormResetCategories();return false});$("#partner-dashboard-search-opportunities-form-clear-categories-list").click(function(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-categories-table").empty();return false})}function removeKeywordHandler(a){$(a+" span a").click(function(){$(this).parent().remove();return false})}function partnerSearchOppotunitiesFormResetKeywords(){$("#partner-dashboard-search-opportunities-form-keyword-list").empty();$.each(partnerDashboardSearchOpportunitiesFormCoveredKeywords,function(b,a){$("#partner-dashboard-search-opportunities-form-keyword-list").append('<span class="badgegray" id="'+a+'">'+a+'<input name="keywords[]" type="hidden" value="'+a+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a></span>')});removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list")}function partnerSearchOppotunitiesFormKeywordsHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredKeywords=a;removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list");$("#partner-dashboard-search-opportunities-form-keyword-input").on("keypress",function(b){if(b.which==13){$("#partner-dashboard-search-opportunities-form-add-keyword-button").click();return false}});$("#partner-dashboard-search-opportunities-form-add-keyword-button").on("click",function(){var b=$.trim($("#partner-dashboard-search-opportunities-form-keyword-input").val());if(b.length>0&&$('#partner-dashboard-search-opportunities-form-keyword-list span[id="'+b+'"]').length==0){$("#partner-dashboard-search-opportunities-form-keyword-list").append('<span class="badgegray" '+(($.inArray(b,partnerDashboardSearchOpportunitiesFormCoveredKeywords)==-1)?'style="background-color:#FFE1C0;" ':"")+'id="'+b+'">'+b+'<input name="keywords[]" type="hidden" value="'+b+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a></span>');removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list");$("#partner-dashboard-search-opportunities-form-keyword-input").val("")}});$("#partner-dashboard-search-opportunities-form-reset-keyword-list").click(function(){partnerSearchOppotunitiesFormResetKeywords();return false});$("#partner-dashboard-search-opportunities-form-clear-keyword-list").click(function(){$("#partner-dashboard-search-opportunities-form-keyword-list").empty();return false})}function partnerSearchOppotunitiesFormHandlers(c,b,a){partnerSearchOppotunitiesFormDepartmentHandlers(c);partnerSearchOppotunitiesFormCategoryHandlers(b);partnerSearchOppotunitiesFormKeywordsHandlers(a);$("#partner-dashboard-search-opportunities-form-reset-form").click(function(){partnerSearchOppotunitiesFormResetKeywords();partnerSearchOppotunitiesFormResetCategories();partnerSearchOppotunitiesFormResetDepartments();return false});$("#partner-dashboard-search-opportunities-form-form").submit(function(){console.log("Search opportunities");$("#partner-dashboard-search-opportunities-form-update-results > i").removeClass("fa-refresh").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(d){$("#partner-dashboard-search-opportunities").parent().html(d)},complete:function(){$("#partner-dashboard-search-opportunities-form-update-results > i").addClass("fa-refresh").removeClass("fa-spinner").removeClass("fa-pulse")}});return false})}function reportAddReportHandlers(){$("#report-add-report-form").submit(function(){$("#report-add-report-submit-button").prop("disabled","disabled").find("i").removeClass("fa-exclamation-triangle").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$(".modal-body").html(a)}});return false})}function reportSubmitBugHandlers(){$("#report-submit-bug-form").submit(function(){var a=new FormData($(this)[0]);$("#report-submit-bug-submit-icon").removeClass("fa-bug").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){$("#report-submit-bug").html(b)}});return false})}function programAddEditProgramHandlers(){contentEditableTextLimit($("#program-add-program-textbox"),$("#program-add-program-textbox-count"),[$("#program-add-program-save")]);$("#program-add-program-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#program-add-program-textbox"),$("#program-add-program-textbox-count"),[$("#program-add-program-save")])});$("#program-add-program-form").submit(function(){$("#progDescription").html($("#program-add-program-textbox").html());$("#program-add-program-save").prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){console.log(a);if(typeof a=="object"){if(typeof $("#program-add-program-save").data("url")!=="undefined"){$("#modal-dialog-title").html($("#program-add-program-save").data("dialog-title"));$(".modal-body").load(a.link);$("#dialog-help-button").attr("href","/pages/help#add-proposal-to-program-dialog")}else{updatePages(["#program-view-program"]);$(".modal").modal("hide")}}else{updatePages(["#program-my-programs","#program-all-programs"]);$(".modal-body").html(a)}}});return false})}function programGetProposalsHandlers(a){$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});userMiniProfilePopover($("a#program-get-proposals-view-profile"));$("a#program-get-proposals-favorite").click(function(){var b=$(this);var d=b.data("favorite");var c=b.html();b.find("i").removeClass("fa-heart").removeClass("fa-heart-o").addClass("fa-spinner").addClass("fa-pulse");$.post(b.attr("href"),{},function(e){if(e.success){b.html((e.success==1)?'<i class="fa fa-heart-o"></i>':'<i class="fa fa-heart"></i>')}else{b.html(c)}},"json").done(function(){});return false});$("a#page-prog-prop").click(function(){$("#program-get-proposals").parent().load($(this).attr("href"));return false});$("a#program-get-proposals-remove-proposal").click(function(){$(this).find("i").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get($(this).attr("href"),{},function(b){updatePages(["#program-get-proposals"])},"json");return false});$("#add-remove-proposals").click(function(){modalDialog("add-remove-proposals-dialog",$(this).data("dialog-title"),$(this).data("url"))});$("#sort-proposals-button").click(function(){modalDialog("sort-proposals-dialog",$(this).data("dialog-title"),$(this).data("url"))})}function programMyProgramsHandlers(){$("a#program-my-programs-add-remove-proposals").click(function(){modalDialog("add-remove-proposals-dialog",$(this).data("dialog-title"),$(this).attr("href"));return false});$("button#program-my-programs-add-new-program").click(function(){modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programAddProposalHandlers(){$("#program-add-proposal-add-button").click(function(){var a=$(this);$(this).prop("disabled","disabled").find("span").replaceWith($('<i class="fa fa-spinner fa-pulse"></i>'));$.post(a.data("url"),function(b){$(".modal-body").html(b)})});$("#program-add-proposal-create-program").click(function(){$(".modal").modal("hide");modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programAddProposalSuccessHandlers(){$("#program-add-proposal-success-close").click(function(){var a=$(this);$("a#add-to-program[data-id='"+$(this).data("id")+"']").each(function(){$(this).html('<i class="fa fa-unlink"></i> '+a.data("remove-from-my-program"));$(this).attr("href",a.data("url"));$(this).attr("id","remove-from-program");$(this).unbind("click");proposalRemoveProposalFromProgramHandler($(this))});if(typeof $("#program-all-programs").data("url")!=="undefined"){updatePages(["#program-all-programs","#program-my-programs"])}else{updatePages(["#program-view-aggregated-program"])}$(".modal").modal("hide")})}function programViewProgramHandlers(){updateContextualHelp("#program-view-program");$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});$("#program-view-program-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#program-view-program-edit").click(function(){modalDialog("program-edit-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#program-view-program-delete").click(function(){modalDialog("program-delete-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programViewAggregatedProgramHandlers(){var a=$("#program-view-aggregated-program");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover(a.find("a#view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"))}function programAddProposalsFromCityHandlers(){userMiniProfilePopover($("a#program-add-proposals-from-city-view-profile"));$("button#add-remove-proposal").click(function(){var a=$(this);a.children("i").removeClass("fa-plus-circle").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get(a.data("url"),{},function(b){var c=$('<a href="'+a.attr("href")+'" class="btn" id="add-remove-proposal"></a>');if(b.added){a.removeClass("btn-orange").addClass("btn-primary");a.find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-times-circle");a.find("span").html($("#program-add-proposals-from-city").data(a.data("measure")?"remove-measure":"remove-proposal"));$("#program-add-proposals-from-city-count").html(parseInt($("#program-add-proposals-from-city-count").html())+1)}else{a.addClass("btn-orange").removeClass("btn-primary");a.find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-plus-circle");a.find("span").html($("#program-add-proposals-from-city").data(a.data("measure")?"add-measure":"add-proposal"));$("#program-add-proposals-from-city-count").html(parseInt($("#program-add-proposals-from-city-count").html())-1)}updatePages(["#program-get-proposals","#program-my-programs","#program-all-programs"])},"json");return false});$("a#page-add-city-proposals").click(function(){$("#program-add-proposals-from-city").parent().load($(this).attr("href"));return false})}function programDeleteProgramHandlers(){$("#program-delete-program-delete").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");var a=$(this);$.ajax({type:"POST",url:$(this).data("url"),success:function(b){if(typeof b=="object"){window.location.href=a.data("goto");$(".modal").modal("hide")}else{$("#program-delete-program").parent().html(b)}}});return false})}function programAllProgramsHandlers(){userMiniProfilePopover($("a#program-all-programs-view-profile"));$("a#page-all-programs").click(function(){$("#program-all-programs").parent().load($(this).attr("href"));return false});$("#program-all-programs-add-new-program").click(function(){modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false)});$("#program-all-programs-view-my-program").click(function(){window.location.href=$(this).data("url")})}function programSortProposalsHandlers(){renumber_table("#sort-proposals-table");$("#sort-proposals-table tbody").sortable({helper:fixHelperModified,stop:function(a,b){renumber_table("#sort-proposals-table")}}).disableSelection();$("#sort-proposals-save-button").click(function(){$("#sort-proposals-save-button").prop("disabled","disabled");$("#sort-proposals-save-button-icon").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#sort-proposals-form").submit()});$("#sort-proposals-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){updatePages(["#program-get-proposals"]);$(".modal").modal("hide")}});return false})}function userProfileChangePictureHandlers(){$("#layout-picture").attr("src",$("#user-profile-change-picture-picture").attr("src"));$("#user-profile-edit-picture").attr("src",$("#user-profile-change-picture-picture").attr("src"));$("#user-profile-change-picture-form").submit(function(){var a=new FormData($("#user-profile-change-picture-form")[0]);$("#user-profile-change-picture-save-button > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){$("#user-profile-change-picture").replaceWith(b)}});return false})}function userProfileDeleteHandlers(){$("#user-profile-delete-yes").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-trash-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#user-profile-delete").data("url"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");window.location.href=a.url}else{$("#user-profile-delete").parent().html(a)}}});return false})}function userProfileUserSettingsHandlers(){$("a#user-profile-user-settings-language").click(function(){$("a#user-profile-user-settings-language").parent("li").removeClass("active");$("#language").val($(this).data("lang"));$("#user-profile-user-settings-current-language-image").attr("src",$(this).find("img").attr("src"));$("#user-profile-user-settings-current-language-image").attr("alt",$(this).find("alt").attr("src"));$("#user-profile-user-settings-current-language").html($(this).find("span").html());$(this).parent("li").addClass("active");$("#user-profile-user-settings-language-select").removeClass("open");return false});$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").on("change propertychange click keyup input paste",function(){if($("#usrOldPassword").val()!=""||$("#usrNewPassword").val()!=""||$("#usrNewPasswordConfirm").val()!=""){$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").attr("required","required")}else{$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").removeAttr("required")}});$("#user-profile-user-settings-cancel").click(function(){$(this).find("i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#user-profile-user-settings").parent().load($("#user-profile-user-settings").data("url"));return false});$("#user-settings-form").submit(function(){$("#user-profile-user-settings-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#user-profile-user-settings").parent().html(a);if($("#user-profile-user-settings-refresh").length){location.reload()}}});return false});$("#user-profile-user-settings-delete").click(function(){modalDialog("delete-account-dialog",$("#user-profile-user-settings").data("delete-account"),$(this).attr("href"));return false})}function userProfileMiniProfileHandlers(){$("a#user-profile-mini-profile-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-plus-square-o").removeClass("fa-minus-square-o").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{if(b.added){$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').removeClass("btn-orange").addClass("btn-primary").html('<i class="fa fa-minus-circle"></i> '+$("#user-profile-mini-profile").data("remove-contact"))}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').addClass("btn-orange").removeClass("btn-primary").html('<i class="fa fa-plus-circle"></i> '+$("#user-profile-mini-profile").data("add-contact"))}if(typeof $("#inbox-my-contacts").data("url")!=="undefined"){$("#inbox-my-contacts").parent().load($("#inbox-my-contacts").data("url"))}}},"json");return false});$("button#user-profile-mini-profile-new-message").click(function(){$(".popover").popover("hide");modalDialog("new-message-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function userProfileUserPresentationHandlers(a){$("#usrPostalcode, #country").on("keyup change",function(){getCities(a)});$("#user-profile-presentation-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#user-profile-presentation").parent().html(b)}});return false})}function userRegistrationAdministrationRegistrationHandlers(){getCities($("#administration-register").data("getcities"));getRegions($("#administration-register").data("getregions"));a();$("#usrPostalcode").on("keyup change",function(){getCities($("#administration-register").data("getcities"))});$("#adminPostalcode").on("keyup change",function(){getCities($("#administration-register").data("getcities"),"#adminPostalcode","#adminCity")});$("#country").on("keyup change",function(){getCities($("#administration-register").data("getcities"));getRegions($("#administration-register").data("getregions"));getCities($("#administration-register").data("getcities"),"#adminPostalcode","#adminCity")});$("#adminLevel").change(function(){a()});function a(){var b=$("#adminLevel").val();if(b==3){$("#administration-register-administrated-region").hide();$("#administration-register-administrated-city").hide();$("#adminRegion").removeAttr("required");$("#adminPostalcode").removeAttr("required");$("#adminCity").removeAttr("required")}else{if(b==2){$("#administration-register-administrated-region").show();$("#administration-register-administrated-city").hide();$("#adminRegion").attr("required","required");$("#adminPostalcode").removeAttr("required");$("#adminCity").removeAttr("required")}else{$("#administration-register-administrated-region").hide();$("#administration-register-administrated-city").show();$("#adminRegion").removeAttr("required");$("#adminPostalcode").attr("required","required");$("#adminCity").removeAttr("required","required")}}}}function userRegistrationUserRegistrationHandlers(a,b){getCities($("#user-registration").data("getcities"));$("#usrPostalcode").on("keyup change",function(){getCities($("#user-registration").data("getcities"))});$("#country").on("keyup change",function(){getCities($("#user-registration").data("getcities"))});$("#usrLanguage").on("change",function(){var c=$(this).val();if(c){window.location=c}return false})}function userRegistrationPleaseRegisterHandlers(){$("#user-register-please-register-register-button").click(function(){window.location=$(this).data("url");return false});$("#user-register-please-register-login-button").click(function(){window.location=$(this).data("url");return false})}function voteAddHandlers(a){$("#vote").on("change",function(){var b=$("#vote option:selected").val();if(a!=b){$("#changeVoteBtn").removeAttr("disabled")}else{$("#changeVoteBtn").attr("disabled","disabled")}});$("#voteForm").submit(function(){$("#add-change-vote-div-icon").removeClass("fa-sticky-note-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#add-change-vote-div").parent().html(b)}});return false})};