var partnerDashboardSearchOpportunitiesFormCoveredDepartments=[];var partnerDashboardSearchOpportunitiesFormCoveredCategories=[];var partnerDashboardSearchOpportunitiesFormCoveredKeywords=[];var inboxListTimer;var newsListTimer;$(document).ajaxError(function(c,b,a){if(b.status==401){window.location=location.pathname.substring(location.pathname.indexOf("/"))}});(function(a){a.fn.reload=function(b){this.parent().load(b);return this}}(jQuery));$(function(){$("body").on("touchstart.dropdown",".dropdown-menu",function(b){b.stopPropagation()});var a=["#inbox","#mycontacts","#favorites","#myprop2","#myscn","#my-sessions","#impl","#hours","#fundings","#draftmeasures","#banner","#newsletter","#events"];if(location.hash!==""){$('a[href="'+location.hash+'"]').tab("show");if($.inArray(location.hash,a)>-1){$('[href="#myspace"]').tab("show")}}$('a[data-toggle="tab"]').on("click",function(d){var b;if(typeof $(this).data("tabs")==="undefined"){b=$(this).attr("href");history.pushState(null,null,b)}else{var c="."+$(this).data("tabs");b=$(c).find(".active > a").attr("href");history.pushState(null,null,b)}});window.addEventListener("popstate",function(c){var b;if(location.hash!==""){b=$('[href="'+location.hash+'"]');if(b.length){b.tab("show")}if($.inArray(location.hash,a)>-1){$('[href="#myspace"]').tab("show")}}else{$(".nav-tabsj a:first").tab("show")}})});function userLayoutHandlers(){$(document).tooltip({position:{my:"center top",at:"center bottom+5"},content:function(){return $(this).prop("title")},show:{duration:0,delay:0,effect:"fold"},hide:{duration:0,delay:0,effect:"fold"}})}$(function(){$("a#homepage-user-registration").click(function(){modalDialog("user-registration",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#layout-browse").click(function(){modalDialog("browse-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("body").on("click",function(a){if(!$(a.target).parents(".popover").length){$(".popover").popover("hide")}});$("a#layout-advanced-search").click(function(){modalDialog("search-advanced-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("#layout-search-form").submit(function(){var a=$.trim($("#layout-search-keywords").val());if(a==""){return false}});$("button#history-back").click(function(){window.history.back();window.location.href="/"});$("button#history-home").click(function(){window.location.href=$(this).attr("href")});$("#layout-goto-inbox").on("click",function(){if($("#inbox").length){$('[href="#myspace"]').tab("show");$('[href="#inbox"]').tab("show");return false}window.location.href=$(this).attr("href")});$("#submit-bug").click(function(){modalDialog("submit-bug-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("button#please-register-button, button#viewing-mode").click(function(){modalDialog("guest-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})});$(function(){$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(b,c){var a=$("<li>",{text:c.label});if(c.disabled){a.addClass("ui-state-disabled")}$("<span>",{style:c.element.attr("data-style"),"class":"ui-icon "+c.element.attr("data-class")}).appendTo(a);return a.appendTo(b)}});$("a#vote-popover").click(function(){$(this).popover("show");return false})});function partnerFindHandlers(){$("#menuFindPartners").click(function(){$("#findPartners").slideDown();$("#selectedPartners").slideUp();$("#helpSelectPartners").slideUp();return false});$("#menuListPartners").click(function(){$("#findPartners").slideUp();$("#selectedPartners").slideDown();$("#helpSelectPartners").slideUp();return false});$("#menuHelpSelectPartners").click(function(){$("#findPartners").slideUp();$("#selectedPartners").slideUp();$("#helpSelectPartners").slideDown();return false});$("#findPartnersForm").submit(function(){if($("#partnerCategoryList span").length==0&&$("#partnerKeywordList span").length==0){$.msg("You must choose at least a category or write a keyword.","error");return false}$("#findPartnersIcon").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#findPartnersDiv").html(b)},complete:function(){$("#findPartnersIcon").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-search")}});return false});$("#mainPartnerCategories").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons avatar");$("#subPartnerCategories").selectmenu();$("#mainPartnerCategories").iconselectmenu({select:function(b,c){a($(this).val())}});function a(b){$.post("/category/get-subcategories",{main_category:b},function(d){$("#subPartnerCategories").find("option").remove().end();$("#subPartnerCategories").selectmenu("destroy").selectmenu({style:"dropdown"});if(typeof d.name!="undefined"){$("#subPartnerCategories").append('<option value="'+(-b)+'">All</option>');for(var c=0;c<d.name.length;c++){$("#subPartnerCategories").append('<option value="'+d.id[c]+'">'+d.name[c]+"</option>")}$("#subPartnerCategories").selectmenu("refresh",true)}},"json");return false}$("#btnPartnerAddCategory").on("click",function(){if($("#partnerCategoryList span[id="+$("#subPartnerCategories").val()+"]").length==0){$("#partnerCategoryList").append('<span class="badge" id="'+$("#subPartnerCategories").val()+'">'+$("#mainPartnerCategories option:selected").text()+" / "+$("#subPartnerCategories option:selected").text()+' <input name="partnerCategories[]" type="hidden" value="'+$("#subPartnerCategories").val()+'"><a><i class="fa fa-times-circle"></i></a></span>');$("#partnerCategoryList span a").click(function(){$(this).parent().remove()})}});$("#partnerKeywords").on("keypress",function(b){if(b.which==13){$("#btnPartnerAddKeyword").click();return false}});$("#btnPartnerAddKeyword").on("click",function(){var b=$.trim($("#partnerKeywords").val());if(b.length>0&&$('#partnerKeywordList span[id="'+b+'"]').length==0){$("#partnerKeywordList").append('<span class="badge" id="'+b+'">'+b+' <input name="partnerKeywords[]" type="hidden" value="'+b+'"><a><i class="fa fa-times-circle"></i></a></span>');$("#partnerKeywordList span a").click(function(){$(this).parent().remove()});$("#partnerKeywords").val("")}});$("#ckbAddRemovePartner").click(function(){var e=$(this);var b=$(this).attr("user");var d=$(this).attr("proposal");var c="/city/proposal/implementation/add-remove-user/"+d+"/user/"+b;$.ajax({type:"POST",url:c,complete:function(){if(e.is(":checked")){$.msg(e.parent().parent().find("#partnerName").text()+" has been added to Partners list.","success")}else{$.msg(e.parent().parent().find("#partnerName").text()+" has been removed from Partners list.","success")}$("#partnerListSection").load("/city/proposal/implementation/get-partners/"+d)}})})}function adminSessionsHandlers(){$("a#page-all-sessions").click(function(){$("#session-all-sessions").parent().load($(this).attr("href"));return false});$("a#session-all-sessions-attend").click(function(){var a=$(this);a.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(a.attr("href"),{},function(d){if(d.success){var c=a.parent().find("#session-all-sessions-attendees-count");var b=parseInt(c.text());if(d.success==1){a.html('<i class="fa fa-check-circle-o size15em" title="'+$("#session-all-sessions").data(a.data("session")?"attend-session":"attend-session")+'"></i>');c.text(b-1)}else{a.html('<i class="fa fa-times-circle-o size15em" title="'+$("#session-all-sessions").data("decline")+'"></i>');c.text(b+1)}}},"json");return false})}function adminUsersHandlers(){$("a#page-contact").click(function(){$("#inbox-my-contacts").parent().load($(this).attr("href"));return false});$("a#inbox-my-contacts-send-message").click(function(){modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).attr("href"),true);return false});$("#admin-users-new-message-selected").click(function(){if($("#admin-users input:checked").length==0){return false}var a="";$("#admin-users input:checked").each(function(){a=a+$(this).val()+"%2C%20"});modalDialog("new-message-dialog",$("#admin-users").data("new-message"),$(this).data("href")+"/to/"+a,true);return false});$("a#user-profile-mini-profile-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-plus-square-o").removeClass("fa-minus-square-o").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{if(b.added){$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').html('<i class="fa fa-minus-circle"></i> '+$("#admin-users").data("remove-contact"))}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').html('<i class="fa fa-plus-circle"></i> '+$("#admin-users").data("add-contact"))}}},"json");return false})}function adminDigestHandlers(){$("a#page-contact").click(function(){$("#inbox-my-contacts").parent().load($(this).attr("href"));return false});$("a#inbox-my-contacts-send-message").click(function(){modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).attr("href"),true);return false});$("#admin-users-new-message-selected").click(function(){if($("#admin-users input:checked").length==0){return false}var a="";$("#admin-users input:checked").each(function(){a=a+$(this).val()+"%2C%20"});modalDialog("new-message-dialog",$("#admin-users").data("new-message"),$(this).data("href")+"/to/"+a,true);return false});$("a#user-profile-mini-profile-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-plus-square-o").removeClass("fa-minus-square-o").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{if(b.added){$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').html('<i class="fa fa-minus-circle"></i> '+$("#admin-users").data("remove-contact"))}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').html('<i class="fa fa-plus-circle"></i> '+$("#admin-users").data("add-contact"))}}},"json");return false})}function bannerMyBannersHandlers(){$("#banner-my-banners-add-banner").click(function(){modalDialog("new-banner-dialog",$(this).data("dialog-title"),$(this).data("href"),true);return false})}function bannerAddBannerHandlers(){$("#bannerImage").on("change",function(){imageUploadPreview(this,$("#banner-add-banner-preview"))});$("#banner-add-banner-save-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#banner-add-banner-form").submit()});$("#banner-add-banner-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#banner-add-banner-form").attr("action");if(a.indexOf("publish")<0){$("#banner-add-banner-form").attr("action",a+"/publish/true")}$("#banner-add-banner-form").submit()});$("#banner-add-banner-form").submit(function(){var a=new FormData($("#banner-add-banner-form")[0]);$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){if(typeof b=="object"){updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"]);$(".modal").modal("hide")}else{$("#banner-add-banner").parent().html(b)}}});return false})}function bannerInactiveBannersHandlers(){$("a#banner-inactive-banners-publish").click(function(){modalDialog("publish-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-inactive-banners-edit").click(function(){modalDialog("edit-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-inactive-banners-delete").click(function(){modalDialog("delete-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#page-inactive-banners").click(function(){$("#banner-inactive-banners").parent().load($(this).attr("href"));return false})}function bannerActiveBannersHandlers(){$("a#banner-active-banners-edit").click(function(){modalDialog("edit-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-active-banners-publish").click(function(){modalDialog("publish-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#banner-active-banners-delete").click(function(){modalDialog("delete-banner-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});renumber_table("#banner-active-banners-table");$("#banner-active-banners-table tbody").sortable({helper:fixHelperModified,stop:function(a,b){renumber_table("#banner-active-banners-table");$("#banner-active-banners-sort-form").submit()}}).disableSelection();$("#sort-proposals-save-button").click(function(){$("#sort-proposals-save-button").prop("disabled","disabled");$("#sort-proposals-save-button-icon").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#sort-proposals-form").submit()});$("#banner-active-banners-sort-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){updatePages(["#banner-carousel-banners"])}}});return false})}function bannerPublishBannerHandlers(){$("#publish-banner-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#banner-publish-banner").data("url"),success:function(a){if(typeof a=="object"){updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"]);$(".modal").modal("hide")}else{$("#banner-publish-banner").parent().html(a)}}});return false})}function bannerDeleteBannerHandlers(){$("#banner-delete-banner-yes").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("href"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");updatePages(["#banner-active-banners","#banner-inactive-banners","#banner-carousel-banners"])}else{$("#banner-delete-banner").parent().html(a)}}});return false})}function blogAddArticleHandlers(){textboxFormatHandlers($("#edit-description"));$("#picture-file").on("change",function(){imageUploadPreview(this,$("#blog-view-article-preview"))});function a(){$("#blog-view-article-articleTitle").html($("#articleTitle").val().length?$("#articleTitle").val():"Title");$("#blog-view-article-articleDescription").html($("#blog-add-article-textbox").html().length?$("#blog-add-article-textbox").html():"Article content...");$("#blog-view-article-articleCategory").html($("#articleCategory").find(":selected").text())}if($("#newsletter-add-newsletter").find(".text-danger").length){a()}$("#articleTitle, #blog-add-article-textbox, #articleCategory").on("change propertychange click keyup input paste",a);$("#blog-add-article-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var b=$("#blog-add-edit-article-form").attr("action");if(b.indexOf("publish")<0){$("#blog-add-edit-article-form").attr("action",b+"/publish/true")}$("#blog-add-edit-article-form").submit()});$("#blog-add-edit-article-form").submit(function(){$("#articleDescription").html($("#blog-add-article-textbox").html());$("#newsletter-add-newsletter-save-button > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse")})}function blogListHandlers(){$("a#page-list").click(function(){$("#blog-list-published").parent().load($(this).attr("href"));return false});$("a#articles-tag").click(function(){$("#blog-list-published").parent().load($(this).attr("href"));$("#blog-list-draft").parent().load($(this).attr("href").replace("list","list-draft"));return false})}function blogViewArticleHandlers(){var a=$("#proposal-view");userMiniProfilePopover($("a#blog-view-article-profile"))}function blogListDraftHandlers(){userMiniProfilePopover($("a#comment-list-profile"));$("a#page-list-draft").click(function(){$("#blog-list-draft").parent().load($(this).attr("href"));return false});$("#article-list-see-published").click(function(){$(this).removeClass("btn-default").addClass("btn-success");$("#article-list-see-draft").removeClass("btn-success").addClass("btn-default");$("#blog-list-published").parent().show();$("#blog-list-draft").parent().hide()});$("#article-list-see-draft").click(function(){$(this).removeClass("btn-default").addClass("btn-success");$("#article-list-see-published").removeClass("btn-success").addClass("btn-default");$("#blog-list-draft").parent().show();$("#blog-list-published").parent().hide()})}function browseDialogHandlers(){$("#browse-search, #browse-region").on("keyup change paste",function(){$("#browse-level-form").submit()});$("#browse-country").on("keyup change paste",function(){var a=$(this).find(":selected").val();$.post($("#index-browse-dialog").data("get-regions"),{country:a},function(b){$("#browse-region").empty();if(!jQuery.isEmptyObject(b)){$.each(b,function(c){var d=$("<option></option>");d.val($(this)[0].id);d.text($(this)[0].name);$("#browse-region").append(d)})}else{$("#browse-region").append($("<option value>No regions for this country!</option>"))}$("#browse-region").val($("#browse-region option:first").val());$("#browse-level-form").submit()},"json")});$("#view-region-level").click(function(){window.location=$(this).data("url").replace("$region$",$("#browse-region").find("option:selected").text()).replace("$country$",$("#browse-country").find("option:selected").text())});$("#view-country-level").click(function(){window.location=$(this).data("url").replace("$country$",$("#browse-country").find("option:selected").text())});$("#browse-level-form").submit(function(){if($("#browse-search").val().length>=2){$("#browse-cityLoad").show();$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#browse-dialog-city-list").html(a);$("#browse-cityLoad").hide()}})}return false})}function contentEditableTextLimit(e,d,c){var b=parseInt(e.attr("maxlength"));var a=e.text().length;if(a>(b)){d.html(e.attr("over-text"));d.find("span").addClass("label label-danger");c.forEach(function(g,f){if(g.length){g.prop("disabled",true)}});d.find("span").text(-(b-a))}else{d.html(e.attr("below-text"));d.find("span").removeClass("label label-danger");c.forEach(function(g,f){if(g.length){g.prop("disabled",false)}});d.find("span").text(b-a)}}function commentAddCommentHandlers(){contentEditableTextLimit($("#comment-add-comment-textbox"),$("#comment-add-comment-textbox-count"),[$("#comment-add-comment-submit")]);textboxFormatHandlers($("#edit-description-comment"));$("#comment-add-comment-textbox").on("change propertychange click keyup input paste focus",function(a){if($("#comment-add-comment-textbox").text()==""){$("#comment-add-comment-submit").prop("disabled",true)}else{$("#comment-add-comment-submit").prop("disabled",false)}contentEditableTextLimit($("#comment-add-comment-textbox"),$("#comment-add-comment-textbox-count"),[$("#comment-add-comment-submit")])});$("#comment-form").submit(function(){$("#addCommentIcon").removeClass("fa-comment-o").addClass("fa-spinner").addClass("fa-pulse");$("#comText").html($("#comment-add-comment-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#comment-add-comment").html(a)}});return false})}function commentListHandlers(){userMiniProfilePopover($("a#comment-list-profile"));$("a#page-com").click(function(){$("#comment-list").load($(this).attr("href"));return false});$("a#thumb").click(function(){var a=$(this);$.post(a.attr("href"),{},function(c){if(c){var b=parseInt(a.prev().text());a.prev().text(b+1);a.parent().children("#thumb").removeAttr("href")}},"json");return false});$("a#comment-list-report").click(function(){modalDialog("report-dialog",$("#comment-list").data("report-comment"),$(this).attr("href"),false);return false});$("a#comment-list-reply").click(function(){var b=$(this).parents("#comment-item");var a=$("#comment-list").data("reply-text");a=a.replace("%date%",b.find("#comment-list-datetime").html());a=a.replace("%user%",b.find("#comment-list-username").html());a=a.replace("%text%",b.find("#comment-list-text").html());$("#comment-add-comment-textbox").html(a).trigger("focus");$("#comment-add-comment")[0].scrollIntoView({behavior:"smooth",block:"start"});return false})}function commentListNoActionsHandlers(){$("a#page-com").click(function(){$("#comment-list-no-actions").load($(this).attr("href"));return false})}function eventAddEventHandlers(){contentEditableTextLimit($("#event-add-event-textbox"),$("#event-add-event-textbox-count"),[$("#event-add-event-save-button"),$("#event-add-event-publish-button")]);textboxFormatHandlers($("#edit-description"));$("#event-add-event-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#event-add-event-textbox"),$("#event-add-event-textbox-count"),[$("#event-add-event-save-button"),$("#event-add-event-publish-button")])});$("#eventStartDateGroup").datetimepicker({format:"DD/MM/YYYY HH:mm"});$("#eventEndDateGroup").datetimepicker({useCurrent:false,format:"DD/MM/YYYY HH:mm"});$("#eventStartDateGroup").on("dp.change",function(a){$("#eventEndDateGroup").data("DateTimePicker").minDate(a.date)});$("#eventEndDateGroup").on("dp.change",function(a){});$("#eventImage").on("change",function(){imageUploadPreview(this,$("#event-add-event-preview"))});$("#event-add-event-save-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#event-add-event-form").submit()});$("#event-add-event-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#event-add-event-form").attr("action");if(a.indexOf("publish")<0){$("#event-add-event-form").attr("action",a+"/publish/true")}$("#event-add-event-form").submit()});$("#event-add-event-form").submit(function(){$("#eventDescription").html($("#event-add-event-textbox").html());var a=new FormData($("#event-add-event-form")[0]);$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){if(typeof b=="object"){updatePages(["#event-my-events","#event-all-events","#event-upcoming-events"]);$(".modal").modal("hide")}else{$("#event-add-event").parent().html(b)}}});return false})}function eventDeleteEventHandlers(){$("#event-delete-event-yes").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("href"),success:function(a){if(typeof a=="object"){updatePages(["#event-my-events","#event-all-events","#event-upcoming-events"]);$(".modal").modal("hide")}else{$("#event-delete-event").parent().html(a)}}});return false})}function eventMyEventsHandlers(a){$("#event-my-events-month").datepicker({autoclose:true,format:"MM yyyy",viewMode:"months",minViewMode:"months",language:a}).on("changeDate",function(c){var b=c.date;$("#event-my-events").parent().load($("#event-my-events-see-all").data("url")+"/date/"+(b.getMonth()+1)+"/"+b.getFullYear())});$("#event-my-events-add-new-event").click(function(){modalDialog("new-event-dialog",$("#event-my-events").data("add-event"),$(this).data("href"),true);return false});$("a#event-my-events-delete").click(function(){modalDialog("delete-event-dialog",$("#event-my-events").data("delete-event"),$(this).attr("href"),true);return false});$("a#event-my-events-duplicate").click(function(){modalDialog("duplicate-event-dialog",$("#event-my-events").data("duplicate-event"),$(this).attr("href"),true);return false});$("#event-my-events-see-all").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-see-drafts").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-see-month").click(function(){$("#event-my-events").parent().load($(this).data("url"));return false});$("#event-my-events-search-form").submit(function(){$(this).find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#event-my-events").replaceWith(b)}});return false});$("a#event-my-events-edit").click(function(){modalDialog("edit-event-dialog",$("#event-my-events").data("edit-event"),$(this).attr("href"),true);return false});$("a#event-my-events-cancel").click(function(){modalDialog("cancel-event-dialog",$("#event-my-events").data("cancel-event"),$(this).attr("href"),true);return false});$("a#event-my-events-publish").click(function(){modalDialog("publish-event-dialog",$("#event-my-events").data("publish-event"),$(this).attr("href"),true);return false});$("a#page-my-events").click(function(){$("#event-my-events").parent().load($(this).attr("href"));return false})}function loadText(b){var a=$("div[data-loading-text]").length?$("div[data-loading-text]").data("loading-text"):"";b.html('<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i> '+a)}function eventAllEventsHandlers(a){$("#event-all-events-month").datepicker({autoclose:true,format:"MM yyyy",viewMode:"months",minViewMode:"months",language:a}).on("changeDate",function(c){loadText($("#event-all-events-results"));var b=c.date;$("#event-all-events").parent().load($("#event-all-events-see-all").data("url")+"/date/"+(b.getMonth()+1)+"/"+b.getFullYear())});$("#event-all-events-add-new-event").click(function(){modalDialog("new-event-dialog",$("#event-all-events").data("add-event"),$(this).data("href"),true);return false});$("#event-all-events-see-all").click(function(){loadText($("#event-all-events-results"));$("#event-all-events").parent().load($(this).data("url"));return false});$("#event-all-events-see-month").click(function(){loadText($("#event-all-events-results"));$("#event-all-events").parent().load($(this).data("url"));return false});$("#event-all-events-add-new-session").click(function(){modalDialog("new-session-dialog",$("#session-my-sessions").data("add-session"),$(this).data("href"),true);return false});$("#event-all-events-search-form").submit(function(){loadText($("#event-all-events-results"));$(this).find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#event-all-events").replaceWith(b)}});return false});$("a#event-all-events-edit").click(function(){modalDialog("edit-event-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#event-all-events-duplicate").click(function(){modalDialog("duplicate-event-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#event-all-events-cancel").click(function(){modalDialog("cancel-event-dialog",$(this).data("dialog-title"),$(this).attr("href"),true);return false});$("a#page-all-events").click(function(){$("#event-all-events").parent().load($(this).attr("href"));loadText($("#event-all-events-results"));return false});$("a#event-all-events-attend").click(function(){var b=$(this);b.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(b.attr("href"),{},function(e){if(e.success){var d=b.parent().find("#event-all-events-attendees-count");var c=parseInt(d.text());if(e.success==1){b.html('<i class="fa fa-check-circle-o size15em" title="'+$("#event-all-events").data(b.data("event")?"attend-event":"attend-session")+'"></i>');d.text(c-1)}else{b.html('<i class="fa fa-times-circle-o size15em" title="'+$("#event-all-events").data("decline")+'"></i>');d.text(c+1)}}},"json");return false})}function eventPublishEventHandlers(){$("#publish-event-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#event-publish-event").data("url"),success:function(a){if(typeof a=="object"){if(typeof $("#event-my-events").data("url")!=="undefined"){$("#event-my-events").parent().load($("#event-my-events").data("url"))}if(typeof $("#event-all-events").data("url")!=="undefined"){$("#event-all-events").parent().load($("#event-all-events").data("url"))}if(typeof $("#event-upcoming-events").data("url")!=="undefined"){$("#event-upcoming-events").parent().load($("#event-upcoming-events").data("url"))}$(".modal").modal("hide")}else{$("#event-publish-event").parent().html(a)}}});return false})}function eventCancelEventHandlers(){$("#cancel-event-yes-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#event-cancel-event").data("url"),success:function(a){if(typeof a=="object"){if(typeof $("#event-my-events").data("url")!=="undefined"){$("#event-my-events").parent().load($("#event-my-events").data("url"))}if(typeof $("#event-all-events").data("url")!=="undefined"){$("#event-all-events").parent().load($("#event-all-events").data("url"))}if(typeof $("#event-upcoming-events").data("url")!=="undefined"){$("#event-upcoming-events").parent().load($("#event-upcoming-events").data("url"))}$(".modal").modal("hide")}else{$("#event-publish-event").parent().html(a)}}});return false})}function eventUpcomingEventsHandlers(){$("#event-upcoming-events-see-all").click(function(){$('[href="#all-events"]').tab("show");return false})}function eventViewEventHandlers(){}function eventViewAttendeesHandlers(){userMiniProfilePopover($("a#event-view-attendees-view-profile"));$("a#page-view-attendees").click(function(){$("#event-view-attendees").parent().load($(this).attr("href"));return false});$("#event-view-attendees-attend").click(function(){var a=$(this);a.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(a.data("url"),{},function(b){if(b.success){updatePages(["#event-view-attendees"])}},"json");return false})}function eventViewInvitationsHandlers(){userMiniProfilePopover($("a#event-view-invitations-view-profile"));$("#event-view-invitations-invite").click(function(){modalDialog("invite-attendees-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("a#page-view-invitations").click(function(){$("#event-view-invitations").parent().load($(this).attr("href"));return false});$("#event-view-attendees-attend").click(function(){var a=$(this);a.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(a.data("url"),{},function(b){if(b.success){updatePages(["#event-view-attendees"])}},"json");return false})}function eventInviteAttendeesReset(a){a.find(".btn-success").removeClass("btn-success").addClass("btn-default");a.find("#my-contacts-list, #level-list, #all-users-list, #invitations-list, #selected-list").hide()}function eventInviteAttendeesCheckboxHandlers(a){userMiniProfilePopover(a.find("a#view-profile"));a.find("input:checkbox").change(function(){if($(this).prop("checked")){var b=$(this).parents("#user").clone();eventInviteAttendeesCheckboxHandlers(b);$("#invite-form").find("#user-list").append(b);$("#invite-form").find("#no-users").hide();var e=$(this).parents("#user").data("id");$('div#user[data-id="'+e+'"]').each(function(){$(this).find("input:checkbox").prop("checked",true);$(this).find("#userstat").html($("#event-invite-attendees").data("selected-user-stat"));$(this).find(".label-default").removeClass("label-default").addClass("label-warning")})}else{var e=$(this).parents("#user").data("id");$("#invite-form").find("#user[data-id="+e+"]").remove();$('div#user[data-id="'+e+'"]').each(function(){$(this).find("input:checkbox").prop("checked",false);$(this).find("#userstat").html($("#event-invite-attendees").data("not-invited"));$(this).find(".label-warning").removeClass("label-warning").addClass("label-default")});if($("#invite-form").find("#user").length==0){$("#invite-form").find("#no-users").show()}}$("#invite-form").find("#sort-name-desc, #sort-city-desc, #sort-state-desc, #sort-name-asc, #sort-city-asc, #sort-state-asc, #search-text").off();eventInviteAttendeesSearchSortHandlers($("#invite-form"));var d=$("span#event-invite-attendees-no-invitations");var c=$("#invite-form").find("#user").length;d.html(c);if(c){$("#event-invite-attendees-invite-button").removeAttr("disabled")}else{$("#event-invite-attendees-invite-button").attr("disabled","disabled")}})}function eventInviteAttendeesSearchSortHandlers(b){var a=b.find("div#user");b.find("#sort-name-desc").off();b.find("#sort-name-desc").click(function(){var c=a.sort(function(e,d){return $(e).find("#username").text().toLowerCase()<$(d).find("#username").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-down"></i>');b.find("#sort-value").data("sort","name-down");eventInviteAttendeesCheckboxHandlers(b)});b.find("#sort-city-desc").off();b.find("#sort-city-desc").click(function(){var c=a.sort(function(e,d){return $(e).find("#usercity").text().toLowerCase()<$(d).find("#usercity").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-down"></i>');b.find("#sort-value").data("sort","city-down");eventInviteAttendeesCheckboxHandlers(b)});b.find("#sort-state-desc").off();b.find("#sort-state-desc").click(function(){var c=a.sort(function(e,d){return $(e).find("#userstat").text().toLowerCase()<$(d).find("#userstat").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-down"></i>');b.find("#sort-value").data("sort","state-down");eventInviteAttendeesCheckboxHandlers(b)});b.find("#sort-name-asc").off();b.find("#sort-name-asc").click(function(){var c=a.sort(function(e,d){return $(e).find("#username").text().toLowerCase()>$(d).find("#username").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-up"></i>');b.find("#sort-value").data("sort","name-up");eventInviteAttendeesCheckboxHandlers(b)});b.find("#sort-city-asc").off();b.find("#sort-city-asc").click(function(){var c=a.sort(function(e,d){return $(e).find("#usercity").text().toLowerCase()>$(d).find("#usercity").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-up"></i>');b.find("#sort-value").data("sort","city-up");eventInviteAttendeesCheckboxHandlers(b)});b.find("#sort-state-asc").off();b.find("#sort-state-asc").click(function(){var c=a.sort(function(e,d){return $(e).find("#userstat").text().toLowerCase()>$(d).find("#userstat").text().toLowerCase()});b.find("#user-list").html(c);b.find("#sort-value").html($(this).text()+' <i class="fa fa-arrow-up"></i>');b.find("#sort-value").data("sort","state-up");eventInviteAttendeesCheckboxHandlers(b)});b.find("#search-text").off();b.find("#search-text").on("input",function(c){var d=$(this).val().toLowerCase();a.each(function(){$(this).show();var e=($(this).find("#username").text().toLowerCase().indexOf(d)==-1&&$(this).find("#usercity").text().toLowerCase().indexOf(d)==-1);if(e){$(this).hide()}})});b.find("#search-users").off();b.find("#search-users").on("input",function(c){var d=$(this).val().toLowerCase();if(d.length<3){b.find("#user-list").empty();b.find("#no-users").show();b.find("#no-users").find(".col-md-12").html($("#event-invite-attendees").data("search-users"));$("#event-invite-attendees").find("#all-button").find("#no-users").html("0");return}$.get($("#event-invite-attendees").data("search-users-url")+d,function(e){b.find("#user-list").html(e);if(e.length<100){b.find("#no-users").show();b.find("#no-users").find(".col-md-12").html($("#event-invite-attendees").data("no-users-found"))}else{b.find("#no-users").hide()}b.find("#user").each(function(){var f=$(this).data("id");if($('#user[data-id="'+f+'"]').find("input:checkbox:checked").length){$(this).find("input:checkbox").prop("checked",true);$(this).find("#userstat").html($("#event-invite-attendees").data("selected-user-stat"));$(this).find(".label-default").removeClass("label-default").addClass("label-warning")}if($('#user[data-id="'+f+'"]').find(".label-info, .label-primary").length){$(this).find("input:checkbox").remove();$(this).find(".label").replaceWith($('#user[data-id="'+f+'"]').find(".label").first().clone())}eventInviteAttendeesCheckboxHandlers($(this))});$("#event-invite-attendees").find("#all-button").find("#no-users").html($("#all-users-list").find("div#user").length);eventInviteAttendeesSearchSortHandlers($("#all-users-list"));switch(b.find("#sort-value").data("sort")){case"name-up":b.find("#sort-name-asc").click();break;case"name-down":b.find("#sort-name-desc").click();break;case"city-up":b.find("#sort-city-asc").click();break;case"city-down":b.find("#sort-city-desc").click();break;case"state-up":b.find("#sort-state-asc").click();break;case"state-down":b.find("#sort-state-desc").click();break}})})}function eventInviteAttendeesUserListHandlers(b){var a=$("#"+b);eventInviteAttendeesCheckboxHandlers(a);a.find("#select").click(function(){a.find("input[type=checkbox]").each(function(){$(this).prop("checked",true)});a.find("#no-invitations").html($("input[type=checkbox]").length);a.find("#invite").removeAttr("disabled")});a.find("#deselect").click(function(){a.find("input[type=checkbox]").each(function(){$(this).prop("checked",false)});a.find("#no-invitations").html("0");a.find("#invite").attr("disabled","disabled")});eventInviteAttendeesSearchSortHandlers(a)}function eventInviteAttendeesAllUserListHandlers(b){var a=$("#"+b);userMiniProfilePopover(a.find("a#view-profile"));eventInviteAttendeesCheckboxHandlers(a);a.find("#select").click(function(){a.find("input[type=checkbox]").each(function(){$(this).prop("checked",true)});a.find("#no-invitations").html($("input[type=checkbox]").length);a.find("#invite").removeAttr("disabled")});a.find("#deselect").click(function(){a.find("input[type=checkbox]").each(function(){$(this).prop("checked",false)});a.find("#no-invitations").html("0");a.find("#invite").attr("disabled","disabled")});eventInviteAttendeesSearchSortHandlers(a)}function eventInviteAttendeesHandlers(){var a=$("#event-invite-attendees");a.find("#contacts-button").find("#no-users").html($("#my-contacts-list").find("div#user").length);a.find("#invited-button").find("#no-users").html($("#invitations-list").find("div#user").length);a.find("#level-button").find("#no-users").html($("#level-list").find("div#user").length);a.find("#contacts-button").click(function(){eventInviteAttendeesReset(a);$(this).removeClass("btn-default").addClass("btn-success");a.find("#my-contacts-list").show()});a.find("#contacts-button").click();a.find("#level-button").click(function(){eventInviteAttendeesReset(a);$(this).removeClass("btn-default").addClass("btn-success");a.find("#level-list").show()});a.find("#all-button").click(function(){eventInviteAttendeesReset(a);$(this).removeClass("btn-default").addClass("btn-success");a.find("#all-users-list").show()});a.find("#invited-button").click(function(){eventInviteAttendeesReset(a);$(this).removeClass("btn-default").addClass("btn-success");a.find("#invitations-list").show()});a.find("#selected-button").click(function(){eventInviteAttendeesReset(a);$(this).removeClass("btn-default").addClass("btn-success");a.find("#selected-list").show()});a.find("#invite-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){if(typeof b=="object"){updatePages(["#event-view-invitations"])}$(".modal").modal("hide")}});return false});$("#event-invite-attendees-invite-button").click(function(){$(this).find("i").removeClass("fa-users").addClass("fa-spinner").addClass("fa-pulse");a.find("#invite-form").submit()})}function executionAddStepDialogHandlers(){$("#stepStartDate").datepicker({defaultDate:"+1d",minDate:0,dateFormat:"dd/mm/yy",changeMonth:true,numberOfMonths:3,onClose:function(a){$("#stepEndDate").datepicker("option","minDate",a)}});$("#stepEndDate").datepicker({defaultDate:"+1d",dateFormat:"dd/mm/yy",changeMonth:true,numberOfMonths:3,onClose:function(a){$("#stepStartDate").datepicker("option","maxDate",a)}})}function executionTimelineHandlers(){var a=function(d,b){var c=finddren();var f=b.clone();f.children().each(function(e){$(this).width(c.eq(e).width())});return f};$("#timelineTable tbody").sortable({helper:a,stop:function(b,c){}}).disableSelection();$("#addStepForm").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#dialogAddNewStep").html(b);if($(".text-danger").length==0){setTimeout(function(){$("#dialogAddNewStep").dialog("close")},2000);$("#timeline").load("/city/proposal/implementation/timeline/"+$("#propUUID").val(),function(){})}else{$(":button:contains('Add step')").attr("disabled",false)}}});return false});$("a#execution-timeline-add-new-step").on("click",function(b){modalDialog("execution-timeline-add-new-step-dialog","Add new Step to Proposal",$(this).attr("href"));return false});$('a[title="Edit Step"]').on("click",function(){var b=$(this).attr("href");$("#editStepName").text($(this).text());$("#dialogEditStep .modal-body").html("Loading step <strong>"+$(this).text()+'</strong>. Please wait... <i class="fa fa-spinner fa-pulse "></i> ').load(b);$("#dialogEditStep").modal({backdrop:"static",keyboard:false,show:true});return false});$(".modal-dialog").draggable({handle:".modal-header"})}function homeLoggedinHandlers(){$("#city-level-chooser").click(function(){$("#home-step-user-1").show();$("#home-step-user-0").hide();return false});$("a#home-step-user-1-next").click(function(){$("#home-step-user-"+$(this).data("value")).show();$("#home-step-user-1").hide();return false});$("#admin-bne").click(function(){$("#home-step-admin-bne").show();$("#home-step-admin-1").hide()});$("#admin-program").click(function(){$("#home-step-admin-program").show();$("#home-step-admin-1").hide()});$("#admin-prop").click(function(){$("#home-step-admin-scenario").show();$("#home-step-admin-1").hide()});$("button#home-step-goto").click(function(){$($(this).data("show")).show();$($(this).data("hide")).hide()})}function inboxDeleteSelectedHandlers(){$("#inbox-list-delete-selected-form").submit(function(){$("#inbox-delete-selected-yes-button").prop("disabled","disabled");$("#inbox-delete-selected-yes-button-icon").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#inbox-delete-selected").parent().html(a)}});return false})}function inboxMyContactsHandlers(){$("a#page-contact").click(function(){$("#inbox-my-contacts").parent().load($(this).attr("href"));return false});$("a#inbox-my-contacts-send-message").click(function(){modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).attr("href"),true);return false});$("#inbox-my-contacts-new-message-selected").click(function(){if($("#inbox-my-contacts input:checked").length==0){return false}var a="";$("#inbox-my-contacts input:checked").each(function(){a=a+$(this).val()+"%2C%20"});modalDialog("new-message-dialog",$("#inbox-my-contacts").data("new-message"),$(this).data("href")+"/to/"+a,true);return false});$("a#inbox-my-contacts-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').addClass("btn-orange").removeClass("btn-primary").html('<i class="fa fa-plus-circle"></i> '+$("#user-profile-mini-profile").data("add-contact"));if(typeof $("#inbox-my-contacts").data("url")!=="undefined"){$("#inbox-my-contacts").parent().load($("#inbox-my-contacts").data("url"))}}},"json");return false})}function inboxListHandlersSelectToView(){return'<div class="panel panel-default" id="inbox-view-message"><div class="panel-body" style="min-height: 450px !important; text-align: center; vertical-align: middle; line-height: 450px;"><div class="row"><div class="col-md-12 col-xs-12">'+$("#inbox-list-received").data("select-message")+"</div></div></div></div>"}function inboxListHandlers(a){userMiniProfilePopover($("a#inbox-list-profile-"+a));$("a#page-ibx-"+a).click(function(){$.get($(this).attr("href"),function(b){$("#inbox-list-"+a).replaceWith(b)});return false});$("input#checkbox-"+a).change(function(){if($("input#checkbox-"+a+":checked").length){$("#inbox-delete-selected-"+a).show()}else{$("#inbox-delete-selected-"+a).hide()}return false});$("#inbox-list-delete-more-form-"+a).submit(function(){modalDialog("inbox-delete-more-dialog",$(this).data("dialog-title"),$(this).attr("action")+"?"+$(this).serialize(),false);return false});$("a#inbox-list-message-item-"+a).click(function(){$("#inbox-list-"+a).find(".list-group-item").removeClass("active");$(this).addClass("active").removeClass("notview");$("#inbox-view-div").load($(this).attr("href"));$("#inbox-list-"+a).data("view-url",$(this).attr("href"));return false});clearInterval(inboxListTimer);inboxListTimer=setInterval(function(){$.get($("#inbox-list-received").data("url"),function(b){var c=$("#inbox-list-received").css("display");$("#inbox-list-received").replaceWith(b);$("#inbox-list-received").css("display",c)})},600000);$("#inbox-list-view-received-"+a).click(function(){if($("#inbox-list-received").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-received").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-received").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").show();$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();if(typeof $("#inbox-list-received").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-received").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false});$("#inbox-list-view-sent-"+a).click(function(){if($("#inbox-list-sent").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-received").hide();$("#inbox-list-trash").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-sent").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-sent").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").hide();$("#inbox-list-sent").show();$("#inbox-list-trash").hide();if(typeof $("#inbox-list-sent").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-sent").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false});$("#inbox-list-view-trash-"+a).click(function(){if($("#inbox-list-trash").length==0){$.ajax({url:$(this).attr("href"),success:function(b){$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-my-inbox-list").append(b);if(typeof $("#inbox-list-trash").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-trash").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}})}else{$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-list-trash").show();if(typeof $("#inbox-list-trash").data("view-url")!=="undefined"){$("#inbox-view-div").load($("#inbox-list-trash").data("view-url"))}else{$("#inbox-view-div").html(inboxListHandlersSelectToView())}}$("#inbox-list-search").hide();return false})}function inboxNewMessageHandlers(b){contentEditableTextLimit($("#inbox-new-message-textbox"),$("#inbox-new-message-textbox-count"),[$("#inbox-new-message-send-message")]);textboxFormatHandlers($("#edit-description"));$("#inbox-new-message-textbox").on("change propertychange click keyup input paste focus",function(d){contentEditableTextLimit($("#inbox-new-message-textbox"),$("#inbox-new-message-textbox-count"),[$("#inbox-new-message-send-message")])});function a(d){return d.split(/,\s*/)}function c(d){return a(d).pop()}$("#msgTo").bind("keydown",function(d){if(d.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active){d.preventDefault()}}).autocomplete({source:function(e,d){$.getJSON(b,{term:c(e.term)},d)},search:function(){var d=c(this.value);if(d.length<2){return false}},focus:function(){return false},select:function(e,f){var d=a(this.value);d.pop();d.push(f.item.value);d.push("");this.value=d.join(", ");return false}});$("#newMessageForm").submit(function(){$("#inbox-new-message-send-message-icon").removeClass("fa-envelope-o").addClass("fa-spinner").addClass("fa-pulse");$("#msgText").html($("#inbox-new-message-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(d){$("#inbox-new-message").parent().html(d);updateInboxLists("all")}});return false})}function inboxPartialMenuHandlers(){$("button#inbox-partial-menu-new-message").click(function(){modalDialog("new-message-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("a#page-ibx_filter").click(function(){$("#inbox-partia-menu-filter").removeClass("open");$("#inbox-partia-menu-filter-check").prependTo($(this));$("#inbox-list").parent().load($(this).attr("href"));return false});$("a#inbox-partial-menu-view-sent").click(function(){var a=this;$(this).find("i").removeClass("fa-eye").addClass("fa-spinner").addClass("fa-pulse");$("#inbox-list").parent().load($(this).attr("href"),function(){$(a).find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-eye");if($(a).data("sent")==$("#inbox-partial-menu-view-sent-text").html()){$("#inbox-partial-menu-view-sent-text").html($(a).data("received"));$(a).attr("href",$(a).attr("href").replace("-sent",""))}else{$("#inbox-partial-menu-view-sent-text").html($(a).data("sent"));$(a).attr("href",$(a).attr("href")+"-sent")}});return false});$("a#inbox-partial-menu-refresh").click(function(){var a=this;$("#inbox-partial-menu-refresh-icon").addClass("fa-spin");if(typeof $("#inbox-list-received").data("url")!=="undefined"){$.get($("#inbox-list-received").data("url"),function(b){var c=$("#inbox-list-received").css("display");$("#inbox-list-received").replaceWith(b);$("#inbox-list-received").css("display",c);$("#inbox-partial-menu-refresh-icon").removeClass("fa-spin")})}return false});$("a#inbox-partial-menu-search-receiver").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-receiver-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-receiver-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-sender").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-sender-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-sender-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-subject").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-subject-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-subject-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-message").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times");$("#inbox-partial-menu-search-message-input").attr("value","0")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-message-input").attr("value","1")}return false});$("a#inbox-partial-menu-search-all").click(function(){if($("#inbox-partial-menu-search-receiver").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-receiver").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-receiver-input").attr("value","1")}if($("#inbox-partial-menu-search-sender").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-sender").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-sender-input").attr("value","1")}if($("#inbox-partial-menu-search-subject").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-subject").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-subject-input").attr("value","1")}if($("#inbox-partial-menu-search-message").find("i").hasClass("fa-times")){$("#inbox-partial-menu-search-message").find("i").removeClass("fa-times").addClass("fa-check");$("#inbox-partial-menu-search-message-input").attr("value","1")}return false});$("#inbox-partial-menu-search-form").submit(function(){$("#inbox-partial-menu-search-submit").find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");var a=$(this).attr("action")+"/sk/"+$("#inbox-partial-menu-search-keywords").val().trim()+"/sr/"+$("#inbox-partial-menu-search-receiver-input").attr("value")+"/ss/"+$("#inbox-partial-menu-search-sender-input").attr("value")+"/st/"+$("#inbox-partial-menu-search-subject-input").attr("value")+"/sm/"+$("#inbox-partial-menu-search-message-input").attr("value");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:a,success:function(b){$("#inbox-list-received").hide();$("#inbox-list-sent").hide();$("#inbox-list-trash").hide();if($("#inbox-list-search").length){$("#inbox-list-search").replaceWith(b).show()}else{$("#inbox-list-received").parent().append(b)}$("#inbox-partial-menu-search-submit").find("i").addClass("fa-search").removeClass("fa-spinner").removeClass("fa-pulse")}});return false})}function inboxViewInvitationHandlers(){$("#inbox-view-invitation-attend").click(function(){var a=$(this);a.find("i").removeClass("fa-check-circle-o").removeClass("fa-times-circle-o").addClass("fa-spinner").addClass("fa-pulse");$.post(a.data("url"),{},function(b){if(b.success){updatePages(["#session-my-sessions","#inbox-view-message"])}},"json");return false})}function inboxViewHandlers(a){userMiniProfilePopover($("a#inbox-view-message-view-profile"));if(a){$("span#inbox-unread-messages-count").html($("#inbox-unread-messages-count").html()-1)}$("#inbox-view-message-delete-one").click(function(){var b=$(this);$.get($(this).data("url"),function(c){$("#inbox-view-div").replaceWith('<div class="col-md-6" id="inbox-view-div"><div class="panel panel-default" id="inbox-view-message" ><div class="panel-body" style="min-height:450px !important;text-align: center;vertical-align: middle;line-height: 450px; " ><div class="row"><div class="col-md-12 col-xs-12">'+b.data("message")+"</div></div></div></div></div>");updateInboxLists(c.type);updateInboxLists("trash")});return false});$("#inbox-view-message-reply").click(function(){modalDialog("inbox-reply-dialog",$(this).data("dialog-title")+" "+$(this).data("type"),$(this).data("url"),true)});$("#inbox-view-message-reply-all").click(function(){modalDialog("inbox-reply-all-dialog",$(this).data("dialog-title"),$(this).data("url"),true)});$("#inbox-view-message-forward").click(function(){modalDialog("inbox-forward-dialog",$(this).data("dialog-title"),$(this).data("url"),true)});$("#inbox-view-message-report").click(function(){modalDialog("add-report",$(this).data("dialog-title"),$(this).data("url"),false)});$("#inbox-view-message-print").click(function(){$("#inbox-view-message-print-zone").print()})}function proposalRemoveLinkHandler(b,a){b.find("a").click(function(){$(this).parents("#link-row").remove();if(!a&&!$("#proposal-links").find("a").length){$("#measure-add-measure-publish").prop("disabled","disabled")}return false});if($("#proposal-links").find("a").length){$("#measure-add-measure-publish").prop("disabled",false)}}function mesureAllMeasuresHandlers(){var a=$("#measure-all-measures");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));userMiniProfilePopover(a.find("a#view-profile"));$("#measure-all-measures-add-new-measure").click(function(){modalDialog("new-measure-dialog",$(this).data("dialog-title").replace("$level$",a.find("#level-name").html()),$(this).data("url"),true)});$("a#page-all-measures").click(function(){a.parent().load($(this).attr("href"));return false})}function measureClaimOwnershipHandlers(){$("#measure-claim-ownership-form").submit(function(){7;$("#measure-claim-ownership-submit").prop("disabled","disabled").find("i").removeClass("fa-certificate").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){updatePages(["#measure-view-measure"]);$(".modal").modal("hide")}else{$("#measure-claim-ownership").parent().html(a)}}});return false})}function mesureDraftMeasuresHandlers(){$("#administration-dashboard-draft-measures-add-new-measure").click(function(){modalDialog("new-measure-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("a#administration-dashboard-draft-measures-edit-draft").click(function(){modalDialog("edit-draft-measure-dialog",$("#administration-dashboard-draft-measures").data("edit-measure"),$(this).attr("href"),true);return false});$("a#page-draft-measures").click(function(){$("#administration-dashboard-draft-measures").parent().load($(this).attr("href"));return false})}function measureViewMeasureHandlers(){var a=$("#measure-view-measure");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));userMiniProfilePopover($("a#measure-view-measure-view-profile"));$("#measure-view-measure-edit").click(function(){modalDialog("edit-measure-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-view-history").click(function(){modalDialog("view-history-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-claim-ownership").click(function(){modalDialog("claim-ownership-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#measure-view-measure-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false})}function measureViewHistoryHandlers(){userMiniProfilePopover($("a#measure-view-history-view-profile"))}function newsAllNewsHandlers(){userMiniProfilePopover($("a#news-all-news-view-profile"));$("a#page-all-news").click(function(){$("#news-all-news").parent().load($(this).attr("href"));return false});clearInterval(newsListTimer);newsListTimer=setInterval(function(){updatePages(["#news-all-news"])},600000)}function newsletterAddNewsletterHandlers(){var d=$("#mainCategories option:first").val();var c=$("#mainCategories option:first").data("style");var f;var e;$("#mainCategories").on("change",function(){var g=$("#mainCategories").find("option:selected");var h=g.css("background-image");h=h.substring(4,h.length-1);$("#add-proposal-category-image").html('<img width="32px" height="32px" src='+h+' title="'+g.text()+'">');d=g.val()});$("#newsletter-add-newsletter-add-category").click(function(){if(!$("#category-"+d).length&&$("#newsletter-add-newsletter-category-list").find("input").length<3){var g=$('<span id="category-'+d+'">');$("<span></span>").appendTo(g);$("#add-proposal-category-image > img").clone().appendTo(g);$('<input type="hidden" name="categories[]" value="'+d+'">').appendTo(g);$("<span></span>").appendTo(g);$('<a href=""><i class="fa fa-times-circle darkgray"></i></a>').click(function(){$(this).parent().remove();b();return false}).appendTo(g);g.appendTo($("#newsletter-add-newsletter-category-list"));b()}});$("#picture-file").on("change",function(){imageUploadPreview(this,$("#newsletter-add-newsletter-preview"))});function a(){$("#newsletter-add-newsletter-title").html($("#nlSubject").val());$("#newsletter-add-newsletter-message").html(nl2br($("#newsletter-add-newsletter-textbox").html()));if($("#nlContact").val()!=""){$("#newsletter-add-newsletter-contact").html($("#nlContact").val())}else{$("#newsletter-add-newsletter-contact").html($("#newsletter-add-newsletter").data("no-contact"))}if($("#nlUrl").val()!=""){$("#newsletter-add-newsletter-url").html($('<a target="_blank">').attr("href",$("#nlUrl").val()).text($("#nlUrl").val()))}else{$("#newsletter-add-newsletter-url").html($("#newsletter-add-newsletter").data("no-url"))}}if($("#newsletter-add-newsletter").find(".text-danger").length){a();b()}$("#nlSubject, #newsletter-add-newsletter-textbox, #nlContact, #nlUrl").on("change propertychange click keyup input paste",a);$("a#newsletter-add-newsletter-remove-category").click(function(){$(this).parent().remove();b();return false});function b(){$("#newsletter-add-newsletter-category-preview").empty();if(!$("#newsletter-add-newsletter-category-list > span").length){$("#newsletter-add-newsletter-category-preview").html($("#newsletter-add-newsletter").data("no-categories-selected"))}else{$("#newsletter-add-newsletter-category-list > span").each(function(){var g=$(this).clone();g.find("span").remove();g.find("input").remove();g.find("a").remove();$("<span></span>").appendTo(g);g.appendTo($("#newsletter-add-newsletter-category-preview"))})}}$("#newsletter-add-newsletter-citizens").click(function(){if($(this).prop("checked")){$("#newsletter-add-newsletter-champions").prop("checked",false)}newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-champions").click(function(){if($(this).prop("checked")){$("#newsletter-add-newsletter-citizens").prop("checked",false)}newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-partners").click(function(){newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-contacts").click(function(){newsletterAddNewsletterUpdateSendTo()});$("#newsletter-add-newsletter-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var g=$("#newsletter-add-newsletter-form").attr("action");if(g.indexOf("publish")<0){$("#newsletter-add-newsletter-form").attr("action",g+"/publish/true")}$("#newsletter-add-newsletter-form").submit()});$("#newsletter-add-newsletter-form").submit(function(){$("#nlMessage").html($("#newsletter-add-newsletter-textbox").html());var g=new FormData($("#newsletter-add-newsletter-form")[0]);$("#newsletter-add-newsletter-save-button > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:g,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(h){if(typeof h=="object"){if(typeof $("#newsletter-my-newsletters").data("url")!=="undefined"){$("#newsletter-my-newsletters").parent().load($("#newsletter-my-newsletters").data("url"))}$(".modal").modal("hide")}else{$("#newsletter-add-newsletter").parent().html(h)}}});return false})}function newsletterDeleteHandlers(){$("#delete-newsletter-yes-button").click(function(){$("#delete-newsletter-yes-button").prop("disabled","disabled").find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).attr("href"),success:function(a){updatePages(["#newsletter-my-newsletters"]);$(".modal").modal("hide")}});return false})}function newsletterMyNewslettersHandlers(){newsletterAddNewsletterUpdateSendTo();$("#newsletter-my-newsletters-add-new-newsletter").click(function(){modalDialog("new-newsletter-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("a#page-my-newsletters").click(function(){$("#newsletter-my-newsletters").parent().load($(this).attr("href"));return false});$("a#newsletter-my-newsletters-edit").click(function(){modalDialog("edit-newsletter-dialog",$("#newsletter-my-newsletters").data("edit-newsletter"),$(this).attr("href"),true);return false});$("a#newsletter-my-newsletters-duplicate").click(function(){modalDialog("duplicate-newsletter-dialog",$("#newsletter-my-newsletters").data("duplicate-newsletter"),$(this).attr("href"),true);return false});$("a#newsletter-my-newsletters-delete").click(function(){modalDialog("delete-newsletter-dialog",$("#newsletter-my-newsletters").data("delete-newsletter"),$(this).attr("href"),"modal-sm");return false})}function resizeImages(f,d,b,c){var e=f.prop("files")[0];if(e.type.match("image.*")){var a=new FileReader();a.onload=function(h){var g=new Image();g.onload=function(){b(resizeInCanvas(g,d))};g.src=h.target.result};a.readAsDataURL(e)}else{c()}}function resizeInCanvas(c,d){var b=500;var e=b/c.width;d?d=d[0]:$("<canvas>")[0];d.width=c.width*e;d.height=c.height*e;d.style.width="100%";var a=d.getContext("2d");a.drawImage(c,0,0,d.width,d.height);return d.toDataURL("image/jpeg")}function measureAddMeasureHandlers(a){proposalAddEditProposalHandlers(a);$(".input-daterange").datepicker({format:"dd/mm/yyyy",calendarWeeks:true,autoclose:true,todayHighlight:true})}function textboxFormatHandlers(a){a.find("button#textbox-format-button").click(function(){if($(this).hasClass("btn-success")){$(this).removeClass("btn-success").addClass("btn-default");$(this).find(".fa").removeClass("fa-check").addClass("fa-times")}else{$(this).addClass("btn-success").removeClass("btn-default");$(this).find(".fa").addClass("fa-check").removeClass("fa-times")}$("#"+$(this).data("contenteditable-id")).focus();document.execCommand($(this).data("format"))})}function proposalAddEditProposalHandlers(a){contentEditableTextLimit($("#proposal-textbox"),$("#proposal-textbox-count"),[$("#proposal-save-button"),$("#proposal-publish-button")]);$("#proposal-textbox").on("change propertychange click keyup input paste focus",function(b){contentEditableTextLimit($("#proposal-textbox"),$("#proposal-textbox-count"),[$("#proposal-save-button"),$("#proposal-publish-button")])});textboxFormatHandlers($("#edit-description"));$("canvas").each(function(){if(typeof $(this).data("image")!=="undefined"){var b=$(this)[0];var c=new Image();c.onload=function(){b.width=c.width;b.height=c.height;b.style.width="100%";var d=b.getContext("2d");d.drawImage(c,0,0,b.width,b.height)};c.src=$(this).data("image")}});$("#imageFile").change(function(){$(".modal-body").block({message:"Resizing image..."});if($(this).hasExtension(["jpg","png","gif","jpeg","bmp","tiff"])){$(this).siblings(".red").html("");var b=null;if(!$("#proposal-add-edit-proposal-image-1").is(":visible")){b=$("#proposal-add-edit-proposal-image-1")}else{if(!$("#proposal-add-edit-proposal-image-2").is(":visible")){b=$("#proposal-add-edit-proposal-image-2")}else{if(!$("#proposal-add-edit-proposal-image-3").is(":visible")){b=$("#proposal-add-edit-proposal-image-3")}else{$(this).siblings(".red").html($("#proposal-add-edit-proposal").data("error-image-size"));$("#imageFile").wrap("<form>").parent("form").trigger("reset");$("#imageFile").unwrap();$(".modal-body").unblock()}}}if(b){resizeImages($(this),b.find("canvas"),function(c){b.find("input").val(c);b.show();$("#imageFile").wrap("<form>").parent("form").trigger("reset");$("#imageFile").unwrap();$(".modal-body").unblock()},function(){})}}else{$(this).siblings(".red").html($("#proposal-add-edit-proposal").data("error-image-type"));$(".modal-body").unblock()}});proposalRemoveLinkHandler($("#proposal-links"),a);$("#proposal-new-link").click(function(){var b=$('<div class="bot5" id="link-row"><div style="width: 250px; float: left;" class="bot5"><input type="url" name="links[]" class="form-control col-md-11 text-change" value=""></div><div style="width: 20px; float: left; padding: 10px 0 0 5px;"><a href="#" id="remove-link"><i class="fa fa-times-circle darkgray"></i></a></div></div>');b.appendTo($("#proposal-links"));proposalRemoveLinkHandler(b,a)});$("a#proposal-add-edit-proposal-remove-image").click(function(){$(this).siblings("input").val("");$(this).parent().hide();$("#imageFile").prop("disabled",false);return false});$("#proposal-save-button").click(function(){$("#proposal-save-button").prop("disabled","disabled");$("#proposal-save-button").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#proposal-form").submit()});$("#proposal-publish-button").click(function(){$("#proposal-publish-button").prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");var b=$("#proposal-form").attr("action");if(b.indexOf("publish")<0){$("#proposal-form").attr("action",b+"/publish/true")}$("#proposal-form").submit()});$("#proposal-form").submit(function(){$("#propDescription").html($("#proposal-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){if(typeof b=="object"){if(b.measure){updatePages(["#measure-view-measure","#administration-dashboard-draft-measures","#measure-all-measures","#news-all-news"])}else{if(b.level=="edit"){updatePages(["#proposal-view"])}else{updatePages(["#proposal-my-proposals","#proposal-all-proposals","#news-all-news"])}}$(".modal").modal("hide")}else{$(".modal-body").html(b)}}});return false});$("input[name=level]").change(function(){$("#add-proposal-category-image").html('<i class="fa fa-spinner fa-pulse fa-2x"></i>');$.post($("div[data-get-categories-url]").data("get-categories-url")+"/level/"+$('input[name="level"]:checked').val(),function(d){$("#main_category option").remove();if(typeof d.name!="undefined"){for(var b=0;b<d.name.length;b++){$("#main_category").append('<option value="'+d.id[b]+'" style="background: url('+d.image[b]+') no-repeat; background-size: 32px 32px;  padding-left: 35px; padding-top:10px; height:35px;">'+d.name[b]+"</option>")}}$("#main_category").val($("#main_category option:first").val());var c=$("#main_category").find("option:selected").css("background-image");c=c.substring(4,c.length-1);$("#add-proposal-category-image").html('<img width="32px" height="32px" src='+c+">");updateSubCategories($("#main_category").find("option:selected").val(),$("#proposal-add-edit-proposal").data("get-subcategories-url")+"/level/"+$('input[name="level"]:checked').val())},"json");return false});$("#main_category").on("change",function(){var b=$('input[name="level"]:checked').length?$('input[name="level"]:checked').val():$('input[name="level"]').val();updateSubCategories($(this).val(),$("div[data-get-subcategories-url]").data("get-subcategories-url")+"/level/"+b)})}function proposalAddRemoveFavoriteHandler(a){var b="Add Favorite",c="Remove Favorite";if(a.length==0){return}if(typeof a.parents(".parent").data("add-favorite")!=="undefined"){b=a.parents(".parent").data("add-favorite")}if(typeof a.parents(".parent").data("remove-favorite")!=="undefined"){c=a.parents(".parent").data("remove-favorite")}a.click(function(){var d=$(this);var f=d.data("favorite");var e=d.html();d.find("i").removeClass("fa-heart").removeClass("fa-heart-o").addClass("fa-spinner").addClass("fa-pulse");$.post(d.attr("href"),{},function(g){if(g.success){updatePages(["#proposal-my-favorites"]);d.html((g.success==1)?'<i class="fa fa-heart-o size15em" title="'+b+'"></i>':'<i class="fa fa-heart size15em" title="'+c+'"></i>')}else{d.html(e)}},"json").done(function(){});return false})}function proposalAddProposalToProgramHandler(a){a.click(function(){modalDialog("add-proposal-to-program-dialog",a.parents(".parent").data("add-to-my-program"),$(this).attr("href"),false);return false})}function proposalRemoveProposalFromProgramHandler(a){a.click(function(){var b=$(this);$.post(b.attr("href"),{},function(c){var d=b.data("id");b.find("img").attr("src","/img/icon-programme-violet.svg").attr("title",b.parents(".parent").data("add-to-my-program"));b.attr("href",b.attr("href").replace("remove-",""));b.attr("id","add-to-program");b.unbind("click");proposalAddProposalToProgramHandler(b);updatePages(["#program-all-programs","#program-my-programs","#program-view-aggregated-program"])},"json").done(function(){});return false})}function proposalAllProposalsHandlers(){var a=$("#proposal-all-proposals");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover(a.find("a#view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));a.find("button#add-new-proposal").click(function(){modalDialog("add-new-proposal-dialog",$(this).data("dialog-title").replace("$level$",a.find("#level-name").html()),$(this).data("url"));return false});$("a#page-all-proposals").click(function(){$("#proposal-all-proposals").parent().load($(this).attr("href"));return false})}function proposalDeleteHandlers(){$("#delete-proposal-yes-button").click(function(){$("#delete-proposal-yes-button").prop("disabled","disabled");$("#delete-proposal-yes-button-icon").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).attr("href"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");parent.history.back()}else{$("#delete-proposal-content").parent().html(a)}}});return false})}function proposalMyFavoritesHandlers(){var a=$("#proposal-my-favorites");userMiniProfilePopover($("a#proposal-my-favorites-view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));$("a#page-fav").click(function(){$("#proposal-my-favorites").reload($(this).attr("href"));return false})}function proposalMyProposalsHandlers(){var a=$("#proposal-my-proposals");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler($("a#proposal-my-proposals-favorite"));$("a#page-my-prop").click(function(){$("#proposal-my-proposals").parent().load($(this).attr("href"));return false});$("button#proposal-my-proposals-new-proposal").click(function(){modalDialog("add-new-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"));return false})}function proposalIdeaImportedProposalsHandlers(){var a=$("#proposal-idea-proposals");userMiniProfilePopover($("a#proposal-idea-proposals-view-profile"));proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));proposalAddRemoveFavoriteHandler($("a#proposal-idea-proposals-favorite"));$("a#page-idea-prop").click(function(){$("#proposal-idea-proposals").parent().load($(this).attr("href"));return false})}function proposalProlongDebateHandlers(){$("#proposal-prolong-debate-yes-button").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-calendar-plus-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("url"),success:function(a){if(typeof a=="object"){updatePages(["#proposal-view"])}$(".modal").modal("hide")}});return false})}function proposalPublishProposalHandlers(){$("#proposal-publish-proposal-yes-button").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("url"),success:function(a){if(typeof a=="object"){updatePages(["#proposal-view"]);$(".modal").modal("hide")}else{$("#publish-proposal-dialog").parent().html(a)}}});return false})}function proposalUserProposalsHandlers(){var a=$("#proposal-user-proposals");proposalAddRemoveFavoriteHandler($("a#proposal-user-proposals-favorite"));proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));$("a#page-user-proposals").click(function(){$("#proposal-user-proposals").parent().load($(this).attr("href"));return false})}function proposalViewHandlers(){$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});var a=$("#proposal-view");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover($("a#proposal-view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"));$("#proposal-view-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#proposal-view-proposal-publish").click(function(){modalDialog("publish-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#proposal-view-proposal-delete").click(function(){modalDialog("delete-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),false)});$("#proposal-view-proposal-extend-debate").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#proposal-view-proposal-edit").click(function(){modalDialog("add-edit-proposal-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false})}function partnerSelectDepartmentsPartialFormHandlers(a){$(a+"-add-departments").click(function(){if(!$(a+"-from-departments option:selected").length){return false}moveSelect2Select($(a+"-from-departments :selected"),$(a+"-to-departments"));orderOptgroups()});$(a+"-add-all-departments").click(function(){$(a+"-from-departments option").each(function(){moveSelect2Select($(this),$(a+"-to-departments"))});orderOptgroups();return false});$(a+"-remove-departments").click(function(){if(!$(a+"-to-departments option:selected").length){return false}moveSelect2Select($(a+"-to-departments :selected"),$(a+"-from-departments"));orderOptgroups();return false});$(a+"-remove-all-departments").click(function(){$(a+"-to-departments option").each(function(){moveSelect2Select($(this),$(a+"-from-departments"))});orderOptgroups();return false})}function partnerProfilePartnerSelectCategoriesHandlers(){removeEmptyGroups();orderOptgroups();partnerSelectCategoriesPartialFormHandlers("#user-profile-partner-select-categories");$("#user-profile-partner-select-categories-form").submit(function(){$("#user-profile-partner-select-categories-to-categories option").prop("selected",true);$("#user-profile-partner-select-categories-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#partner-profile-partner-presentation-category-list").find("span").remove();$("#user-profile-partner-select-categories-to-categories optgroup").each(function(){var e=$(this).find("option").first().css("background-image");e=e.substring(5,e.length-2);var d=$('<span class="right5">');var b=$('<img src="'+e+'" valign="middle" width="34" height="34" title="" class="round5">');var c=$(this).attr("label");var f="";$(this).find("option").each(function(){f+=c+" - "+$(this).text()+"<br>"});b.attr("title",f);d.append(b);d.insertBefore("#partner-profile-partner-presentation-goto-categories")})},complete:function(){$("#user-profile-partner-select-categories-save > i").addClass("fa-floppy-o").removeClass("fa-spinner").removeClass("fa-pulse");$("#user-profile-partner-select-categories-to-categories option").prop("selected",false)}});return false})}function partnerProfilePartnerSelectDepartmentsHandlers(){removeEmptyGroups();orderOptgroups();partnerSelectDepartmentsPartialFormHandlers("#user-profile-partner-select-regions");$("#user-profile-partner-select-regions-form").submit(function(){$("#user-profile-partner-select-regions-to-departments option").prop("selected",true);$("#user-profile-partner-select-regions-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#partner-profile-partner-presentation-department-no-regions").html($("#user-profile-partner-select-regions-to-departments optgroup").length);$("#partner-profile-partner-presentation-department-no-departments").html($("#user-profile-partner-select-regions-to-departments option").length);var b="";$("#user-profile-partner-select-regions-to-departments optgroup").each(function(){var c=$(this).attr("label");$(this).find("option").each(function(){b+=c+" - "+$(this).text()+"<br>"});$("#partner-profile-partner-presentation-department-list").attr("title",b)})},complete:function(){$("#user-profile-partner-select-regions-save > i").addClass("fa-floppy-o").removeClass("fa-spinner").removeClass("fa-pulse");$("#user-profile-partner-select-regions-to-departments option").prop("selected",false)}});return false})}function partnerProfilePartnerPresentationHandlers(a){setLastCitySearch($("#usrPostalcode").val());$("#partner-profile-partner-presentation-goto-categories").click(function(){$("[href=#categ]").tab("show")});$("#partner-profile-partner-presentation-goto-departments").click(function(){$("[href=#area]").tab("show")});removeKeywordHandler("#partner-profile-partner-presentation-keyword-list");$("#partner-profile-partner-presentation-keyword-input").on("keypress",function(b){if(b.which==13){$("#partner-profile-partner-presentation-add-keyword-button").click();return false}});$("#partner-profile-partner-presentation-add-keyword-button").on("click",function(){var b=$.trim($("#partner-profile-partner-presentation-keyword-input").val());if(b.length>0&&$('#partner-profile-partner-presentation-keyword-list span[id="'+b+'"]').length==0){$("#partner-profile-partner-presentation-keyword-list").append('<span class="badgegray right5" id="'+b+'">'+b+'<input name="keywords[]" type="hidden" value="'+b+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a> </span>');removeKeywordHandler("#partner-profile-partner-presentation-keyword-list");$("#partner-profile-partner-presentation-keyword-input").val("")}});$("#usrPostalcode").on("keyup change",function(){getCities(a)});$(".partner-presentation-text-change").on("keypress",function(c){if(c.which==13){var b=$(this).closest("form").find(":focusable").not("a, button");b.eq(b.index(this)+1).focus();return false}});$("#user-profile-partner-presentation-form").submit(function(){$("#partner-profile-partner-presentation-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#partner-profile-partner-presentation").parent().html(b)}});return false});$("#partner-profile-partner-presentation-reset").click(function(){$("#partner-profile-partner-presentation-reset > i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#partner-profile-partner-presentation").parent().load($(this).attr("href"));return false})}function partnerSearchOppotunitiesFormResetDepartments(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});$.each(partnerDashboardSearchOpportunitiesFormCoveredDepartments,function(a,b){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-departments > optgroup > option[value="'+b+'"]'),$("#partner-dashboard-search-opportunities-form-to-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-department-list").empty();$("#partner-dashboard-search-opportunities-form-no-departments").html($("#partner-dashboard-search-opportunities-form-to-departments > optgroup ").length);$("#partner-dashboard-search-opportunities-form-to-departments > optgroup > option").each(function(){$("#partner-dashboard-search-opportunities-form-department-list").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredDepartments)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="departments[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')});$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){$(this).parent().remove();return false})}function partnerSearchOppotunitiesFormDepartmentHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredDepartments=a;removeEmptyGroups();orderOptgroups();partnerSelectDepartmentsPartialFormHandlers("#partner-dashboard-search-opportunities-form");$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-departments > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-departments"));orderOptgroups();$(this).parent().remove();return false});$("#partner-dashboard-search-opportunities-form-collapse-region-button").click(function(){$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("show");$("#partner-dashboard-search-opportunities-form-collapse-region-button").attr("disabled","disabled");return false});$("#partner-dashboard-search-opportunities-form-save-departments").click(function(){$("#partner-dashboard-search-opportunities-form-department-list").empty();$("#partner-dashboard-search-opportunities-form-no-departments").html($("#partner-dashboard-search-opportunities-form-to-departments > optgroup ").length);$("#partner-dashboard-search-opportunities-form-to-departments > optgroup > option").each(function(){$("#partner-dashboard-search-opportunities-form-department-list").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredDepartments)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="departments[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')});$("#partner-dashboard-search-opportunities-form-department-list span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-departments > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-departments"));orderOptgroups();$(this).parent().remove();return false});$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-region-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-cancel-departments").click(function(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});$("#partner-dashboard-search-opportunities-form-department-list > span").each(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-departments > optgroup > option[value="'+$(this).data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-to-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-collapse-region").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-region-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-reset-department-list").click(function(){partnerSearchOppotunitiesFormResetDepartments();return false});$("#partner-dashboard-search-opportunities-form-clear-department-list").click(function(){$("#partner-dashboard-search-opportunities-form-to-departments option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-departments"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-no-departments").html("0");$("#partner-dashboard-search-opportunities-form-department-list").empty();return false})}function partnerSelectCategoriesPartialFormHandlers(a){$(a+"-add-categories").click(function(){if(!$(a+"-from-categories option:selected").length){return false}moveSelect2Select($(a+"-from-categories :selected"),$(a+"-to-categories"));orderOptgroups();return false});$(a+"-add-all-categories").click(function(){$(a+"-from-categories option").each(function(){moveSelect2Select($(this),$(a+"-to-categories"))});orderOptgroups();return false});$(a+"-remove-categories").click(function(){if(!$(a+"-to-categories option:selected").length){return false}moveSelect2Select($(a+"-to-categories :selected"),$(a+"-from-categories"));orderOptgroups();return false});$(a+"-remove-all-categories").click(function(){$(a+"-to-categories option").each(function(){moveSelect2Select($(this),$(a+"-from-categories"))});orderOptgroups();return false})}function partnerSearchOppotunitiesFormRemoveCategoryHandler(){$("#partner-dashboard-search-opportunities-form-line span a").click(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-to-categories > optgroup > option[value="'+$(this).parent().data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-from-categories"));orderOptgroups();if($(this).parent().siblings().length){$(this).parent().remove()}else{$(this).parents("tr").remove()}return false})}function partnerSearchOppotunitiesFormResetCategories(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});$.each(partnerDashboardSearchOpportunitiesFormCoveredCategories,function(a,b){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-categories > optgroup > option[value="'+b+'"]'),$("#partner-dashboard-search-opportunities-form-to-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-categories-table").empty();$("#partner-dashboard-search-opportunities-form-to-categories > optgroup").each(function(){var b=$(this).children().first().css("background-image");b=b.substring(5,b.length-2);var a=$('<tr><td style="width:32px; border-top:none;"><img src="'+b+'" height="24" width="24" title="'+$(this).attr("label")+'"></td><td style="line-height:1.6em; border-top:none;" id="partner-dashboard-search-opportunities-form-line"></td></tr>');$("#partner-dashboard-search-opportunities-form-categories-table").append(a);$(this).children().each(function(){a.find("#partner-dashboard-search-opportunities-form-line").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredCategories)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="categories[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')})});partnerSearchOppotunitiesFormRemoveCategoryHandler()}function partnerSearchOppotunitiesFormCategoryHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredCategories=a;removeEmptyGroups();orderOptgroups();partnerSelectCategoriesPartialFormHandlers("#partner-dashboard-search-opportunities-form");partnerSearchOppotunitiesFormRemoveCategoryHandler();$("#partner-dashboard-search-opportunities-form-collapse-categories-button").click(function(){$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("show");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").attr("disabled","disabled");return false});$("#partner-dashboard-search-opportunities-form-save-categories").click(function(){$("#partner-dashboard-search-opportunities-form-categories-table").empty();$("#partner-dashboard-search-opportunities-form-to-categories > optgroup").each(function(){var c=$(this).children().first().css("background-image");c=c.substring(5,c.length-2);var b=$('<tr><td style="width:32px; border-top:none;"><img src="'+c+'" height="24" width="24" title="'+$(this).attr("label")+'"></td><td style="line-height:1.6em; border-top:none;" id="partner-dashboard-search-opportunities-form-line"></td></tr>');$("#partner-dashboard-search-opportunities-form-categories-table").append(b);$(this).children().each(function(){b.find("#partner-dashboard-search-opportunities-form-line").append('<span class="badgegray" '+(($.inArray($(this).val(),partnerDashboardSearchOpportunitiesFormCoveredCategories)==-1)?'style="background-color:#FFE1C0;"':"")+'data-id="'+$(this).val()+'">'+$(this).text()+' <input name="categories[]" type="hidden" value="'+$(this).val()+'"><a href=""><i class="fa fa-times-circle darkgray"></i></a></span> ')})});partnerSearchOppotunitiesFormRemoveCategoryHandler();$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-cancel-categories").click(function(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});$("#partner-dashboard-search-opportunities-form-line > span").each(function(){moveSelect2Select($('#partner-dashboard-search-opportunities-form-from-categories > optgroup > option[value="'+$(this).data("id")+'"]'),$("#partner-dashboard-search-opportunities-form-to-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-collapse-categories").collapse("hide");$("#partner-dashboard-search-opportunities-form-collapse-categories-button").removeAttr("disabled");return false});$("#partner-dashboard-search-opportunities-form-reset-categories-list").click(function(){partnerSearchOppotunitiesFormResetCategories();return false});$("#partner-dashboard-search-opportunities-form-clear-categories-list").click(function(){$("#partner-dashboard-search-opportunities-form-to-categories option").each(function(){moveSelect2Select($(this),$("#partner-dashboard-search-opportunities-form-from-categories"))});orderOptgroups();$("#partner-dashboard-search-opportunities-form-categories-table").empty();return false})}function removeKeywordHandler(a){$(a+" span a").click(function(){$(this).parent().remove();return false})}function partnerSearchOppotunitiesFormResetKeywords(){$("#partner-dashboard-search-opportunities-form-keyword-list").empty();$.each(partnerDashboardSearchOpportunitiesFormCoveredKeywords,function(b,a){$("#partner-dashboard-search-opportunities-form-keyword-list").append('<span class="badgegray" id="'+a+'">'+a+'<input name="keywords[]" type="hidden" value="'+a+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a></span>')});removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list")}function partnerSearchOppotunitiesFormKeywordsHandlers(a){partnerDashboardSearchOpportunitiesFormCoveredKeywords=a;removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list");$("#partner-dashboard-search-opportunities-form-keyword-input").on("keypress",function(b){if(b.which==13){$("#partner-dashboard-search-opportunities-form-add-keyword-button").click();return false}});$("#partner-dashboard-search-opportunities-form-add-keyword-button").on("click",function(){var b=$.trim($("#partner-dashboard-search-opportunities-form-keyword-input").val());if(b.length>0&&$('#partner-dashboard-search-opportunities-form-keyword-list span[id="'+b+'"]').length==0){$("#partner-dashboard-search-opportunities-form-keyword-list").append('<span class="badgegray" '+(($.inArray(b,partnerDashboardSearchOpportunitiesFormCoveredKeywords)==-1)?'style="background-color:#FFE1C0;" ':"")+'id="'+b+'">'+b+'<input name="keywords[]" type="hidden" value="'+b+'"> <a href=""><i class="fa fa-times-circle darkgray"></i></a></span>');removeKeywordHandler("#partner-dashboard-search-opportunities-form-keyword-list");$("#partner-dashboard-search-opportunities-form-keyword-input").val("")}});$("#partner-dashboard-search-opportunities-form-reset-keyword-list").click(function(){partnerSearchOppotunitiesFormResetKeywords();return false});$("#partner-dashboard-search-opportunities-form-clear-keyword-list").click(function(){$("#partner-dashboard-search-opportunities-form-keyword-list").empty();return false})}function partnerSearchOppotunitiesFormHandlers(c,b,a){partnerSearchOppotunitiesFormDepartmentHandlers(c);partnerSearchOppotunitiesFormCategoryHandlers(b);partnerSearchOppotunitiesFormKeywordsHandlers(a);$("#partner-dashboard-search-opportunities-form-reset-form").click(function(){partnerSearchOppotunitiesFormResetKeywords();partnerSearchOppotunitiesFormResetCategories();partnerSearchOppotunitiesFormResetDepartments();return false});$("#partner-dashboard-search-opportunities-form-form").submit(function(){$("#partner-dashboard-search-opportunities-form-update-results > i").removeClass("fa-refresh").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(d){$("#partner-dashboard-search-opportunities").parent().html(d)},complete:function(){$("#partner-dashboard-search-opportunities-form-update-results > i").addClass("fa-refresh").removeClass("fa-spinner").removeClass("fa-pulse")}});return false})}function reportAddReportHandlers(){$("#report-add-report-form").submit(function(){$("#report-add-report-submit-button").prop("disabled","disabled").find("i").removeClass("fa-exclamation-triangle").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$(".modal-body").html(a)}});return false})}function reportSubmitBugHandlers(){textboxFormatHandlers($("#report-submit-bug"));$("#report-submit-bug-form").submit(function(){$("#bugDescription").html($("#report-submit-bug-textbox").html());var a=new FormData($(this)[0]);$("#report-submit-bug-submit-icon").removeClass("fa-bug").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){$("#report-submit-bug").html(b)}});return false});contentEditableTextLimit($("#report-submit-bug-textbox"),$("#report-submit-bug-textbox-count"),[$("#report-submit-bug-send-message")]);$("#report-submit-bug-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#report-submit-bug-textbox"),$("#report-submit-bug-textbox-count"),[$("#report-submit-bug-send-message")])})}function programAddEditProgramHandlers(){contentEditableTextLimit($("#program-add-program-textbox"),$("#program-add-program-textbox-count"),[$("#program-add-program-save")]);textboxFormatHandlers($("#edit-description"));$("#program-add-program-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#program-add-program-textbox"),$("#program-add-program-textbox-count"),[$("#program-add-program-save")])});$("#program-add-program-form").submit(function(){$("#progDescription").html($("#program-add-program-textbox").html());$("#program-add-program-save").prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){if(typeof $("#program-add-program-save").data("url")!=="undefined"){$("#modal-dialog-title").html($("#program-add-program-save").data("dialog-title"));$(".modal-body").load(a.link);$("#dialog-help-button").attr("href","/pages/help#add-proposal-to-program-dialog")}else{updatePages(["#program-view-program"]);$(".modal").modal("hide")}}else{updatePages(["#program-my-programs","#program-all-programs"]);$(".modal-body").html(a)}}});return false})}function programGetProposalsHandlers(a){$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});userMiniProfilePopover($("a#program-get-proposals-view-profile"));$("a#program-get-proposals-favorite").click(function(){var b=$(this);var d=b.data("favorite");var c=b.html();b.find("i").removeClass("fa-heart").removeClass("fa-heart-o").addClass("fa-spinner").addClass("fa-pulse");$.post(b.attr("href"),{},function(e){if(e.success){b.html((e.success==1)?'<i class="fa fa-heart-o"></i>':'<i class="fa fa-heart"></i>')}else{b.html(c)}},"json").done(function(){});return false});$("a#page-prog-prop").click(function(){$("#program-get-proposals").parent().load($(this).attr("href"));return false});$("a#program-get-proposals-remove-proposal").click(function(){$(this).find("i").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get($(this).attr("href"),{},function(b){updatePages(["#program-get-proposals"])},"json");return false});$("#add-remove-proposals").click(function(){modalDialog("add-remove-proposals-dialog",$(this).data("dialog-title"),$(this).data("url"))});$("#sort-proposals-button").click(function(){modalDialog("sort-proposals-dialog",$(this).data("dialog-title"),$(this).data("url"))})}function programMyProgramsHandlers(){$("a#program-my-programs-add-remove-proposals").click(function(){modalDialog("add-remove-proposals-dialog",$(this).data("dialog-title"),$(this).attr("href"));return false});$("button#program-my-programs-add-new-program").click(function(){modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programAddProposalHandlers(){$("#program-add-proposal-add-button").click(function(){var a=$(this);$(this).prop("disabled","disabled").find("span").replaceWith($('<i class="fa fa-spinner fa-pulse"></i>'));$.post(a.data("url"),function(b){$(".modal-body").html(b)})});$("#program-add-proposal-create-program").click(function(){$(".modal").modal("hide");modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programAddProposalSuccessHandlers(){$("#program-add-proposal-success-close").click(function(){var a=$(this);$("a#add-to-program[data-id='"+a.data("id")+"']").each(function(){$(this).find("img").attr("src","/img/icon-programme-remove-violet.svg").attr("title",$(this).parents(".parent").data("remove-from-my-program"));$(this).attr("href",a.data("url"));$(this).attr("id","remove-from-program");$(this).unbind("click");proposalRemoveProposalFromProgramHandler($(this))});updatePages(["#program-all-programs","#program-my-programs","#program-view-aggregated-program"]);$(".modal").modal("hide")})}function programViewProgramHandlers(){$(".equal .panel-body").matchHeight({byRow:true,property:"min-height",target:null,remove:false});$("#program-view-program-report").click(function(){modalDialog("report-dialog",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#program-view-program-edit").click(function(){modalDialog("program-edit-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("#program-view-program-delete").click(function(){modalDialog("program-delete-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function programViewAggregatedProgramHandlers(){var a=$("#program-view-aggregated-program");proposalAddProposalToProgramHandler(a.find("a#add-to-program"));proposalRemoveProposalFromProgramHandler(a.find("a#remove-from-program"));userMiniProfilePopover(a.find("a#view-profile"));proposalAddRemoveFavoriteHandler(a.find("a#favorite"))}function programAddProposalsFromCityHandlers(){userMiniProfilePopover($("a#program-add-proposals-from-city-view-profile"));$("button#add-remove-proposal").click(function(){var a=$(this);a.children("i").removeClass("fa-plus-circle").removeClass("fa-times-circle").addClass("fa-spinner").addClass("fa-pulse");$.get(a.data("url"),{},function(b){var c=$('<a href="'+a.attr("href")+'" class="btn" id="add-remove-proposal"></a>');if(b.added){a.removeClass("btn-orange").addClass("btn-primary");a.find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-times-circle");a.find("span").html($("#program-add-proposals-from-city").data(a.data("measure")?"remove-measure":"remove-proposal"));$("#program-add-proposals-from-city-count").html(parseInt($("#program-add-proposals-from-city-count").html())+1)}else{a.addClass("btn-orange").removeClass("btn-primary");a.find("i").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-plus-circle");a.find("span").html($("#program-add-proposals-from-city").data(a.data("measure")?"add-measure":"add-proposal"));$("#program-add-proposals-from-city-count").html(parseInt($("#program-add-proposals-from-city-count").html())-1)}updatePages(["#program-get-proposals","#program-my-programs","#program-all-programs"])},"json");return false});$("a#page-add-city-proposals").click(function(){$("#program-add-proposals-from-city").parent().load($(this).attr("href"));return false})}function programDeleteProgramHandlers(){$("#program-delete-program-delete").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-trash").addClass("fa-spinner").addClass("fa-pulse");var a=$(this);$.ajax({type:"POST",url:$(this).data("url"),success:function(b){if(typeof b=="object"){window.location.href=a.data("goto");$(".modal").modal("hide")}else{$("#program-delete-program").parent().html(b)}}});return false})}function programAllProgramsHandlers(){userMiniProfilePopover($("a#program-all-programs-view-profile"));$("a#page-all-programs").click(function(){$("#program-all-programs").parent().load($(this).attr("href"));return false});$("#program-all-programs-add-new-program").click(function(){modalDialog("add-new-program-dialog",$(this).data("dialog-title"),$(this).data("url"),false)});$("#program-all-programs-view-my-program").click(function(){window.location.href=$(this).data("url")})}function programSortProposalsHandlers(){renumber_table("#sort-proposals-table");$("#sort-proposals-table tbody").sortable({helper:fixHelperModified,stop:function(a,b){renumber_table("#sort-proposals-table")}}).disableSelection();$("#sort-proposals-save-button").click(function(){$("#sort-proposals-save-button").prop("disabled","disabled");$("#sort-proposals-save-button-icon").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#sort-proposals-form").submit()});$("#sort-proposals-form").submit(function(){$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){updatePages(["#program-get-proposals"]);$(".modal").modal("hide")}});return false})}function sessionAddEditSessionHandlers(){textboxFormatHandlers($("#edit-description"));contentEditableTextLimit($("#session-add-session-textbox"),$("#session-add-session-textbox-count"),[$("#session-add-session-save-button"),$("#session-add-session-publish-button")]);$("#session-add-session-textbox").on("change propertychange click keyup input paste focus",function(a){contentEditableTextLimit($("#session-add-session-textbox"),$("#session-add-session-textbox-count"),[$("#session-add-session-save-button"),$("#session-add-session-publish-button")])});$("#session-add-session-save-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$("#session-add-edit-session-form").submit()});$("#session-add-session-publish-button").click(function(){$(this).prop("disabled","disabled");$(this).find("i").removeClass("fa-share-square-o").addClass("fa-spinner").addClass("fa-pulse");var a=$("#session-add-edit-session-form").attr("action");if(a.indexOf("publish")<0){$("#session-add-edit-session-form").attr("action",a+"/publish/true")}$("#session-add-edit-session-form").submit()});$("#eventPostalcode, #city").on("keyup change paste",function(){getCities($("#session-add-session"),$("#eventPostalcode"),$("#city"),$("#country"),"#cityLoad")});$("#session-add-edit-session-form").submit(function(){$("#eventDescription").html($("#session-add-session-textbox").html());$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){updatePages(["#session-my-sessions","#event-all-events","#event-upcoming-events","#session-view-session"]);$(".modal").modal("hide");if(a.url){modalDialog("invite-attendees-dialog",a.title,a.url,false)}}else{$("#session-add-session").parent().html(a)}}});return false})}function sessionProlongSessionHandlers(){$("#session-prolong-session-yes-button").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-calendar-plus-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$(this).data("url"),success:function(a){$(".modal").modal("hide")}})})}function sessionMySessionsHandlers(a){$("#session-my-sessions-add-new-session").click(function(){modalDialog("new-session-dialog",$("#session-my-sessions").data("add-session"),$(this).data("href"),true);return false});$("#session-my-sessions-see-all").click(function(){$("#session-my-sessions").parent().load($(this).data("url"));return false});$("#session-my-sessions-see-drafts").click(function(){$("#session-my-sessions").parent().load($(this).data("url"));return false});$("#session-my-sessions-search-form").submit(function(){$(this).find("i").removeClass("fa-search").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#session-my-sessions").replaceWith(b)}});return false});$("a#session-my-sessions-cancel").click(function(){modalDialog("cancel-session-dialog",$("#session-my-sessions").data("cancel-session"),$(this).attr("href"),true);return false});$("a#session-my-sessions-publish").click(function(){modalDialog("publish-session-dialog",$("#session-my-sessions").data("publish-session"),$(this).attr("href"),true);return false});$("a#page-my-sessions").click(function(){$("#session-my-sessions").parent().load($(this).attr("href"));return false})}function sessionMySessionsListHandlers(b){var a=$("#session-my-sessions-list");userMiniProfilePopover(a.find("a#view-profile"));$("#session-my-sessions-list-filter").find("a").click(function(){if($(this).find("i").hasClass("fa-check")){$(this).find("i").removeClass("fa-check").addClass("fa-times")}else{$(this).find("i").removeClass("fa-times").addClass("fa-check")}return false});a.find("#filter-deselect-all").click(function(){$("#session-my-sessions-list-filter").find("a").each(function(){var c=$(this).find("i");if(c.data("filter")!="completed"&&c.hasClass("fa-check")){c.removeClass("fa-check").addClass("fa-times")}});return false});a.find("#filter-select-all").click(function(){$("#session-my-sessions-list-filter").find("a").each(function(){var c=$(this).find("i");if(c.data("filter")!="completed"&&c.hasClass("fa-times")){c.removeClass("fa-times").addClass("fa-check")}});return false});$("#session-my-sessions-list-filter-apply").click(function(){var d=$("#session-my-sessions-list-filter");var c="";var e=d.find('.fa-check[data-filter!="completed"]').length;if(e&&e<9){d.find("i").each(function(f){if($(this).hasClass("fa-check")){c+=$(this).data("filter")+"|"}})}else{c=d.find('.fa-check[data-filter="completed"]').length?"completed":"none"}$("#session-my-sessions-list").parent().load($(this).data("url")+"/filter/"+c)});$("#session-my-sessions-list-filter-reset").click(function(){a.find("#filter-select-all").click();$("#session-my-sessions-list-filter-apply").click()});$("a#page-my-sessions-list").click(function(){$("#session-my-sessions-list").parent().load($(this).attr("href"));return false});a.find("#completed-sessions").click(function(){if($(this).hasClass("btn-success")){return true}$(this).removeClass("btn-default").addClass("btn-success");a.find("#upcoming-sessions").addClass("btn-default").removeClass("btn-success");$("#session-my-sessions-list-filter").find('i[data-filter="completed"]').removeClass("fa-times").addClass("fa-check");$("#session-my-sessions-list-filter-apply").click()});a.find("#upcoming-sessions").click(function(){if($(this).hasClass("btn-success")){return true}$(this).removeClass("btn-default").addClass("btn-success");a.find("#completed-sessions").addClass("btn-default").removeClass("btn-success");$("#session-my-sessions-list-filter").find('i[data-filter="completed"]').removeClass("fa-check").addClass("fa-times");$("#session-my-sessions-list-filter-apply").click()})}function sessionViewSessionHandlers(){userMiniProfilePopover($("a#session-view-session-view-profile"));$("#session-view-session-edit").click(function(){modalDialog("edit-session-dialog",$("#session-view-session").data("edit-session"),$(this).data("url"),true);return false});$("#session-view-session-cancel").click(function(){modalDialog("cancel-session-dialog",$("#session-view-session").data("cancel-session"),$(this).data("url"),false);return false})}$.fn.scrollBottom=function(){return $(document).height()-this.scrollTop()-this.height()};function sessionLiveHandlers(e,f){$("#session-live-invite").click(function(){modalDialog("invite-attendees-dialog",$(this).data("dialog-title"),$(this).data("url"),true);return false});$("#add-more-time").click(function(){modalDialog("add-more-time-dialog",$(this).data("dialog-title"),$(this).attr("href"),"modal-md");return false});$("#session-live-close-button").click(function(){modalDialog("end-session-dialog",$(this).data("dialog-title"),$(this).data("url"),"modal-lg",true)});$("#add-new-idea-form").formValidation({framework:"bootstrap",button:{selector:"#add-new-idea-submit-button",disabled:"disabled"},icon:null,fields:{ideaTitle:{validators:{notEmpty:{message:$("#idea-title").data("empty-error")},regexp:{regexp:/^[\s]*[0-9A-Za-z\u00C0-\u017F]+[^:]*(:[\s]*[0-9A-Za-z\u00C0-\u017F]+[^:]*)*$/,message:$("#idea-title").data("regexp-error")}}}},err:{clazz:"text-help red"}});$("a#category-menu-item").click(function(){var h=$("#ideaCategoryDropdown").find("img");var g=$(this).find("img");h.attr("src",g.attr("src"));h.attr("title",g.data("title"));$("#ideaCategory").val($(this).data("category-id"))});$("#add-new-idea-submit-button").click(function(){$("#add-new-idea-form").submit()});$("#add-new-idea-form").submit(function(){$("#add-new-idea-submit-button").prop("disabled","disabled").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(g){if(g.success){$("#idea-title").val("");b.getIdeas()}$("#idea-title").parent().removeClass("has-success")},error:function(){$("#idea-title").parent().removeClass("has-success").addClass("has-error")}}).always(function(){$("#add-new-idea-submit-button").prop("disabled",false).find("i").addClass("fa-floppy-o").removeClass("fa-spinner").removeClass("fa-pulse")});return false});jsGrid.setDefaults({tableClass:"jsgrid-table table table-striped table-hover"});jsGrid.setDefaults("text",{_createTextBox:function(){return $("<input>").attr("type","text").attr("class","form-control input-sm")}});var c=$("#idea-list").parent();var a=$("#idea-list");var d=$("#suggested-idea-list");var b=new Ideas(a,$("#suggested-idea-list"),true,f);$("#suggested-idea-list").jsGrid({height:"200px",width:"100%",rowClass:function(h,g){return"fullwidth idea-"+h.id+($("#chat-message-list").data("chat-filter-uuid")==h.id?" commented-idea":"")},headerRowRenderer:function(){return $('<th colspan="5" class="text-center suggested-ideas">').text(c.data("suggested-idea-header"))},editing:false,autoload:true,heading:true,loadIndication:false,deleteConfirm:c.data("delete-idea"),noDataContent:c.data("no-suggested-ideas"),controller:{loadData:function(){return b.suggestedIdeas},deleteItem:function(g){b.deleteIdea(g)}},onRefreshed:function(h){var g=d.find(".jsgrid-grid-body");g.scrollTop(g.find("table").height())},fields:[{width:20,align:"center"},{name:"category",type:"CategoryField",width:30,align:"center"},{name:"element",type:"IdeaField",width:200},{name:"user",type:"UserField",width:24,align:"center"},{type:"control",itemTemplate:function(i,h){var g=$([]);if(e==c.data("owner")){g=g.add(this._createGridButton("jsgrid-update-button",c.data("validate-idea"),function(j,k){b.validateIdea(h);k.stopPropagation()}));g=g.add(this._createDeleteButton(h))}g=g.add(createJSGridCommentButton(this,h,b));return g}}]});$("#idea-list").jsGrid({height:"323px",width:"100%",rowClass:function(h,g){return"fullwidth idea-"+h.id+($("#chat-message-list").data("chat-filter-uuid")==h.id?" commented-idea":"")},headerRowRenderer:function(){return $("<th>").attr("colspan",5).addClass("text-center").addClass("validated-ideas").text(c.data("validated-idea-header"))},editing:e==c.data("owner"),autoload:true,heading:true,loadIndication:true,deleteConfirm:c.data("delete-idea"),noDataContent:c.data("no-validated-ideas"),controller:{loadData:function(){return b.validatedIdeas},updateItem:function(g){$.ajax({data:{idea:g},type:$("#add-new-idea-form").attr("method"),url:$("#add-new-idea-form").attr("action").replace("add-idea","update-idea")})},deleteItem:function(g){b.deleteIdea(g)}},onDataLoaded:function(h,i){var g=$("#idea-list").find(".jsgrid-grid-body");g.scrollTop(g.find("table").height())},onItemEditing:function(g){b.stopTimer();sortableDisable($("#idea-list .jsgrid-grid-body tbody"))},onItemUpdating:function(h,k,j,i,g){if(this._editingRow){return}b.startTimer();sortableEnable($("#idea-list .jsgrid-grid-body tbody"))},onRefreshed:function(h){var g=$("#idea-list .jsgrid-grid-body tbody");if(e==a.parent().data("owner")){g.sortable({cancel:".disable-sort",update:function(k,j){var i=$.map(g.find("tr"),function(l){return $(l).data("JSGridItem")});b.sortIdeas(i)}})}},cancelEdit:function(){if(!this._editingRow){return}this._getEditRow().remove();this._editingRow.show();this._editingRow=null;if(!this._editingRow){sortableEnable($("#idea-list .jsgrid-grid-body tbody"))}},fields:[{name:"position",width:20,align:"center",sorter:function(h,g){return h<g}},{name:"category",type:"CategoryField",width:30,align:"center"},{name:"element",type:"IdeaField",width:200},{name:"user",type:"UserField",width:24,align:"center"},{type:"control",itemTemplate:function(j,i){var h=$([]);if(this.editButton&&e==c.data("owner")&&i.element.validated){h=h.add(this._createEditButton(i))}if(this.deleteButton&&e==c.data("owner")){h=h.add(this._createDeleteButton(i))}var g=createJSGridCommentButton(this,i,b);h=h.add(g);return h}}]});$("#chat-message-list").data("entity-lists",["idea-list","suggested-idea-list"]);$("#chat-message-list").data("entity","idea")}function sessionEndedHandlers(d){userMiniProfilePopover($("#session-view-session-view-profile"));jsGrid.setDefaults({tableClass:"jsgrid-table table table-striped table-hover"});jsGrid.setDefaults("text",{_createTextBox:function(){return $("<input>").attr("type","text").attr("class","form-control input-sm")}});var c=$("#idea-list").parent();var a=$("#idea-list");var b=new Ideas(a,$("#suggested-idea-list"),false);$("#idea-list").jsGrid({height:"523px",width:"100%",rowClass:function(f,e){return"fullwidth idea-"+f.id+($("#chat-message-list").data("chat-filter-uuid")==f.id?" commented-idea":"")},headerRowRenderer:function(){return $("<th>").attr("colspan",5).addClass("text-center").addClass("validated-ideas").text(c.data("validated-idea-header"))},editing:false,autoload:true,heading:true,loadIndication:true,controller:{loadData:function(){return b.validatedIdeas}},onDataLoaded:function(e,f){b.stopTimer()},fields:[{name:"position",width:20,align:"center",sorter:function(f,e){return f<e}},{name:"category",type:"CategoryField",width:30,align:"center"},{name:"element",type:"IdeaField",width:200},{name:"user",type:"UserField",width:24,align:"center"},{type:"control",width:70,itemTemplate:function(j,i){var g=$([]);var k=this._createGridButton("import-idea",$("#idea-list").parent().data("import-idea"),function(m,n){var l=$("#idea-list").data("import-idea-url");var o=(l.search("register")!=-1);l=o?l:l+"/idea/"+i.id;modalDialog("add-new-proposal-dialog",$("#idea-list").data("add-new-proposal-title"),l,o?"modal-md":"modal-lg");$(".modal").on("hidden.bs.modal",function(){b.getIdeas()});n.stopPropagation()});g=g.add(k);if(i.element.prop){var h=this;var e=this._createGridButton("proposals-idea",$("#idea-list").data("view-imported-proposal"),function(m,n){var l=$("#idea-list").data("view-imported-proposals-url")+"/"+i.id;modalDialog("idea-imported-proposals-dialog",$("#idea-list").data("view-imported-proposals-title"),l);n.stopPropagation()});g=g.add(e)}var f=createJSGridCommentButton(this,i,b);g=g.add(f);return g}}]});$("#chat-message-list").data("entity-lists",["idea-list"]);$("#chat-message-list").jsGrid({height:"523px"})}function createJSGridCommentButton(b,c,a){return b._createGridButton("comment-idea",$("#idea-list").parent().data("comment-idea"),function(d,f){if($("#chat-message-list").data("chat-filter-uuid")!=c.id){$("#chat-message-list").data("chat-filter-uuid",c.id);$("#chat-message-list").jsGrid({headerRowRenderer:function(){return $('<th colspan="5" class="text-center badge-info" style="padding:5px!important;">').text($("#chat-message-list").data("comment-element")+" ").append($("<i>").text(c.element.name)).append("  ").append($("<a>").attr("href","#").attr("title",$("#chat-message-list").data("back-full-chat")).html('<i class="fa fa-times-circle w size15em"></i>').click(function(){$("#chat-message-list").data("chat-filter-uuid","");$("#chat-message-list").jsGrid({heading:false});a.refresh();return false}))},heading:true})}else{$("#chat-message-list").data("chat-filter-uuid","");$("#chat-message-list").jsGrid({heading:false})}$("#chat-message-list").jsGrid("search");a.refresh();f.stopPropagation()})}function sessionIdeaListEditCategory(a){a.find("a#category-menu-item").click(function(){var c=a.find("#ideaCategoryDropdown").find("img");var b=$(this).find("img");c.attr("src",b.attr("src"));c.attr("title",b.data("title"))})}function sessionIdeaListIdeaValidation(a){a.formValidation({framework:"bootstrap",icon:null,fields:{idea:{validators:{notEmpty:{message:$("#idea-title").data("empty-error")},regexp:{regexp:/^[\s]*[0-9A-Za-z\u00C0-\u017F]+[^:]*(:[\s]*[0-9A-Za-z\u00C0-\u017F]+[^:]*)*$/,message:$("#idea-title").data("regexp-error")}}}},err:{clazz:"text-help red"},row:{selector:"form-horizontal",valid:"has-success",invalid:"has-danger"}})}function sortableEnable(a){a.sortable();a.sortable("option","disabled",false);a.disableSelection();return false}function sortableDisable(a){if(!a.hasClass("ui-sortable-disabled")){a.sortable("disable")}return false}function findIdea(a){return this.id==a.id}function compareIdeas(d,c){if(d.position<c.position){return -1}if(d.position>c.position){return 1}return 0}function Ideas(d,b,a,c){this.validatedIdeas=[];this.suggestedIdeas=[];this.live=a;this.getMessagesTime=5000;this.getMessagesTimer=null;this.validatedIdeasGrid=d;this.suggestedIdeasGrid=b;this.timer=c;this.getIdeas=function(){var e=this;$.ajax({url:this.validatedIdeasGrid.parent().data("idea-list"),dataType:"json"}).done(function(g){var k=[];var m=[];for(var j=0;j<e.validatedIdeas.length;j++){k.push(0)}for(var j=0;j<e.suggestedIdeas.length;j++){m.push(0)}var l=false;if(a&&g.ended){modalDialog("end-session-dialog",e.validatedIdeasGrid.parent().data("session-ended"),e.validatedIdeasGrid.parent().data("idea-list").replace("idea-list","session-ended"),"modal-lg",false);e.stopTimer();return}if(typeof e.timer!=="undefined"){var f=new Date(g.endDate);if(a&&f.getTime()!=e.timer.getDate().getTime()){e.timer.setDate(f)}}$.each(g.ideas,function(n,r){var p;if(r.element.validated){if((p=e.validatedIdeas.findIndex(function o(i){return i.id==r.id}))>=0){var q=e.validatedIdeas[p];k[p]=1;if(q.element.name!=r.element.name||q.element.description!=r.element.description||q.category.id!=r.category.id||q.position!=r.position||q.element.prod!=r.element.prop){e.validatedIdeas[p]=r;l=true}}else{e.validatedIdeas.push(r);l=true}}else{if((p=e.suggestedIdeas.findIndex(function o(i){return i.id==r.id}))>=0){var q=e.suggestedIdeas[p];m[p]=1;if(q.element.name!=r.element.name||q.element.description!=r.element.description||q.category.id!=r.category.id||q.position!=r.position){e.suggestedIdeas[p]=r;l=true}}else{e.suggestedIdeas.push(r);l=true}}});var h=0;for(var j=0;j<k.length;j++){if(!k[j]){e.validatedIdeas.splice(j-h,1);h++}}h=0;for(var j=0;j<m.length;j++){if(!m[j]){e.suggestedIdeas.splice(j-h,1);h++}}e.validatedIdeas.sort(compareIdeas);e.suggestedIdeas.sort(compareIdeas);if(l){e.load()}})};this.refresh=function(){this.validatedIdeasGrid.jsGrid("refresh");this.suggestedIdeasGrid.jsGrid("refresh")};this.load=function(){this.validatedIdeasGrid.jsGrid("loadData");this.suggestedIdeasGrid.jsGrid("loadData")};this.reload=function(){this.stopTimer();this.validatedIdeas=[];this.suggestedIdeas=[];this.startTimer();this.validatedIdeasGrid.jsGrid("loadData");this.suggestedIdeasGrid.jsGrid("loadData")};this.validateIdea=function(f){var e=this;$.ajax({data:{idea:f},type:"post",url:e.validatedIdeasGrid.parent().data("idea-list").replace("idea-list","validate-idea")}).done(function(g){if(g.success){e.suggestedIsdeas=$.grep(e.suggestedIdeas,function(h){return h.id!=f.id});e.validatedIdeasGrid.push(f);e.reload()}})};this.sortIdeas=function(e){var f=this;$.each(e,function(g,j){var h=f.validatedIdeas.findIndex(function(i){return i.id==j.id});f.validatedIdeas[h].position=g+1});f.validatedIdeas.sort(function(h,g){return h.position-g.position});$.ajax({data:{ideas:f.validatedIdeas},type:"post",url:$("#idea-list").parent().data("idea-list").replace("idea-list","sort-ideas")}).done(function(g){f.refresh()})};this.updateIdea=function(f){var e=this;$.ajax({data:{idea:f},type:"post",url:e.validatedIdeasGrid.parent().data("idea-list").replace("idea-list","update-idea")}).done(function(g){if(g.success){e.reload()}})};this.deleteIdea=function(f){var e=this;$.ajax({data:{idea:f},type:"post",url:e.validatedIdeasGrid.parent().data("idea-list").replace("idea-list","delete-idea")}).done(function(g){if(g.success){e.reload()}})};this.startTimer=function(){var e=this;if(this.getMessages){clearInterval(this.getMessages)}e.getIdeas();this.getMessages=setInterval(function(){e.getIdeas()},this.getMessagesTime)};this.stopTimer=function(){if(this.getMessages){clearInterval(this.getMessages);this.getMessages=null}};this.startTimer()}function updateSortIdea(a){var b=$.map(a.find("tr"),function(c){return $(c).data("JSGridItem")});grid._loadIndicator.show();$.ajax({data:{ideas:b},type:"post",url:parentIdeas.data("sort-ideas")})}function chatAddFilter(a){$("#chat-message-list").data("chat-filter-uuid",filter)}function chatViewChatHandlers(){userMiniProfilePopover($("a#chat-view-chat-moderator-profile"));$("#chat-title").on("keypress",function(c){if(c.which==13){$.ajax({data:{title:$("#chat-title").text()},type:"post",url:$(this).data("url"),success:function(d){if(d.success){$("#chat-message-list").jsGrid("loadData");$("#chat-title").blur()}}});$("#partner-profile-partner-presentation-add-keyword-button").click();return false}});$("#chat-add-message-form").submit(function(){if($.trim($("#chat-message").val())==""){return false}var c=$("#chat-message").val();$("#chat-message").val("");$.ajax({data:{message:c,id:$("#chat-message-list").data("chat-filter-uuid"),entity:$("#chat-message-list").data("entity")},type:$(this).attr("method"),url:$(this).attr("action"),success:function(d){if(d.success){$("#chat-message-list").jsGrid("loadData")}$("#chat-message").parent().removeClass("has-success")},error:function(){$("#chat-message").parent().removeClass("has-success").addClass("has-error")}}).always(function(){});return false});var b=2;var a=setInterval(function(){if($("#chat-message-list").length){$("#chat-message-list").jsGrid("loadData");if(!$("#chat-message-list").data("chat-opened")){b--;if(b<=0){clearInterval(a)}}}else{clearInterval(a)}},5000);jsGrid.setDefaults({tableClass:"jsgrid-table table table-striped table-hover"});$("#chat-message-list").jsGrid({height:"410px",width:"100%",headerRowRenderer:function(){return $("<th>").attr("colspan",5).addClass("text-center").addClass("badge-info").text("Idea name")},heading:false,rowClass:function(d,c){return"fullwidth"},rowRenderer:function(l){if(l.blockedUser==null){var f=$("<div>").append($('<img style="cursor:pointer;">').addClass("round5").attr("src",l.user.picture).attr("width",24).attr("height",24).attr("title","@"+l.user.name)).append("").append($("<a>").attr("href","/user/profile/mini-profile/"+l.user.uuid+"/context/"+$("#chat-message-list").data("chat-id")).attr("data-title",$("#chat-message-list").data("mini-profile-title").replace("%username%",l.user.name)).attr("data-id",l.user.uuid).append($("<span>").addClass("badge").addClass("left5").text(l.user.name))).append("");if(l.uuid){var c=false;var g=30;var j=false;var h="";var k=l.name;var e=k.length>g?k.slice(0,g)+"...":k;$.each($("#chat-message-list").data("entity-lists"),function(n,o){gridData=$("#"+o+" .jsgrid-grid-body tbody");var m=$.map(gridData.find("tr"),function(p){return $(p).data("JSGridItem")});$.each(m,function(p,q){if(q.id==l.uuid){j=true;k=q.element.name;e=k.length>g?k.slice(0,g)+"...":k;h=o;c=true;return false}});if(c){return false}});f.append($("<span>").text(l.date+" comment on "));if(j){f.append($("<span>").addClass("label").addClass("label-warning").css("cursor","pointer").attr("title",k).text(e));f.find(".label-warning").click(function(){$("#chat-message-list").data("chat-filter-uuid",l.uuid);$("#chat-message-list").jsGrid({headerRowRenderer:function(){return $('<th colspan="5" class="text-center badge-info" style="padding:5px!important;">').text($("#chat-message-list").data("comment-element")+" ").append($("<i>").text(k)).append("  ").append($("<a>").attr("href","#").attr("title",$("#chat-message-list").data("back-full-chat")).html('<i class="fa fa-times-circle w size15em"></i>').click(function(){$("#chat-message-list").data("chat-filter-uuid","");$("#chat-message-list").jsGrid({heading:false});$("#"+h).jsGrid("refresh");return false}))},heading:true});$("#chat-message-list").jsGrid("search");$("#"+h).jsGrid("refresh")})}else{f.append($("<span>").addClass("label").addClass("label-danger").attr("title",k+" - "+$("#chat-message-list").data("deleted")).text(e))}f.append(":")}else{f.append($("<span>").text(l.date+" "+$("#chat-message-list").data("says")))}var i=l.message;var d=$("<div>").addClass("top5");$.each(i.split("<br>"),function(m,o){var n=$("<span>").html(o);n.html(n.text().replace(/\@{1}([a-zA-Z][a-zA-Z0-9_.-]+)/g,'<span class="badge badge-chat">@$1</span> '));d.append(n).append($("<br>"))});if(l.user.me){f.find(".badge").addClass("self").addClass("white")}userMiniProfilePopover(f.find("a"));f.find("img").click(function(){$("#chat-message").val($("#chat-message").val()+"@"+l.user.name)});return $("<tr>").append($("<td>").append(f).append(d))}else{var f=$("<div>").append($('<img style="cursor:pointer;">').addClass("round5").attr("src",l.blockedUser.picture).attr("width",24).attr("title","@"+l.blockedUser.name)).append("").append($("<a>").attr("href","/user/profile/mini-profile/"+l.blockedUser.uuid+"/context/"+$("#chat-message-list").data("chat-id")).attr("data-title",$("#chat-message-list").data("mini-profile-title").replace("%username%",l.blockedUser.name)).attr("data-id",l.blockedUser.uuid).append($("<span>").addClass("badge").addClass("badge-danger").addClass("left5").text(l.blockedUser.name))).append("");if(l.message=="true"){f.append($("<span>").addClass("red").text($("#chat-message-list").data("blocked-user-text")));if(l.blockedUser.me){$("#chat-message, #chat-add-message-button").attr("disabled",true).attr("placeholder",$("#chat-message-list").data("you-have-been-blocked"));$("#idea-title, #add-new-idea-submit-button, #category-select").attr("disabled",true)}}else{f.append($("<span>").addClass("green").text($("#chat-message-list").data("unblocked-user-text")));f.find("a span").removeClass("badge-danger").addClass("badge-success");if(l.blockedUser.me){$("#chat-message, #chat-add-message-button").attr("disabled",false).attr("placeholder","");$("#idea-title, #add-new-idea-submit-button, #category-select").attr("disabled",false)}}if(l.blockedUser.me){}userMiniProfilePopover(f.find("a"));f.find("img").click(function(){$("#chat-message").val($("#chat-message").val()+"@"+l.blockedUser.name)});return $("<tr>").append($("<td>").append(f))}},filtering:false,editing:false,sorting:false,autoload:true,loadIndication:false,noDataContent:$("#chat-message-list").data("no-messages"),controller:{loadData:function(c){var e=$.Deferred();$.ajax({data:{id:$("#chat-message-list").data("chat-filter-uuid")},url:$("#chat-message-list").data("message-list"),dataType:"json"}).done(function(d){if(typeof $("#chat-title").attr("contenteditable")==="undefined"&&$("#chat-title").text()!=d.title){$("#chat-title").text(d.title)}e.resolve(d.messages)});return e.promise()}},onRefreshed:function(d){var c=$("#chat-message-list").find(".jsgrid-grid-body");c.scrollTop(c.find("table").height())},fields:[{title:"Messages"}]})}function userProfileChangePictureHandlers(){$("#layout-picture").attr("src",$("#user-profile-change-picture-picture").attr("src"));$("#user-profile-edit-picture").attr("src",$("#user-profile-change-picture-picture").attr("src"));$("#user-profile-change-picture-form").submit(function(){var a=new FormData($("#user-profile-change-picture-form")[0]);$("#user-profile-change-picture-save-button > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:a,type:$(this).attr("method"),url:$(this).attr("action"),processData:false,contentType:false,success:function(b){$("#user-profile-change-picture").replaceWith(b)}});return false})}function userProfileDeleteHandlers(){$("#user-profile-delete-yes").click(function(){$(this).prop("disabled","disabled").find("i").removeClass("fa-trash-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({type:"POST",url:$("#user-profile-delete").data("url"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide");window.location.href=a.url}else{$("#user-profile-delete").parent().html(a)}}});return false})}function userProfileUserSettingsHandlers(){$("a#user-profile-user-settings-language").click(function(){$("a#user-profile-user-settings-language").parent("li").removeClass("active");$("#language").val($(this).data("lang"));$("#user-profile-user-settings-current-language-image").attr("src",$(this).find("img").attr("src"));$("#user-profile-user-settings-current-language-image").attr("alt",$(this).find("alt").attr("src"));$("#user-profile-user-settings-current-language").html($(this).find("span").html());$(this).parent("li").addClass("active");$("#user-profile-user-settings-language-select").removeClass("open");return false});$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").on("change propertychange click keyup input paste",function(){if($("#usrOldPassword").val()!=""||$("#usrNewPassword").val()!=""||$("#usrNewPasswordConfirm").val()!=""){$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").attr("required","required")}else{$("#usrOldPassword, #usrNewPassword, #usrNewPasswordConfirm").removeAttr("required")}});$("#user-profile-user-settings-cancel").click(function(){$(this).find("i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#user-profile-user-settings").parent().load($("#user-profile-user-settings").data("url"));return false});$("#user-settings-form").submit(function(){$("#user-profile-user-settings-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#user-profile-user-settings").parent().html(a);if($("#user-profile-user-settings-refresh").length){location.reload()}}});return false});$("#user-profile-user-settings-delete").click(function(){modalDialog("delete-account-dialog",$("#user-profile-user-settings").data("delete-account"),$(this).attr("href"));return false})}function userProfileUserMailingHandlers(){$("#user-profile-user-mailing-cancel").click(function(){$(this).find("i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#user-profile-user-mailing").parent().load($("#user-profile-user-mailing").data("url"));return false});$("#user-mailing-form").submit(function(){$("#user-profile-user-mailing-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#user-profile-user-mailing").parent().html(a)}});return false})}function userProfileMiniProfileHandlers(){$("a#user-profile-mini-profile-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-plus-square-o").removeClass("fa-minus-square-o").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{if(b.added){$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').removeClass("btn-orange").addClass("btn-primary").html('<i class="fa fa-minus-circle"></i> '+$("#user-profile-mini-profile").data("remove-contact"))}else{$('a#user-profile-mini-profile-add-remove-contact[data-id="'+a.data("id")+'"]').addClass("btn-orange").removeClass("btn-primary").html('<i class="fa fa-plus-circle"></i> '+$("#user-profile-mini-profile").data("add-contact"))}if(typeof $("#inbox-my-contacts").data("url")!=="undefined"){$("#inbox-my-contacts").parent().load($("#inbox-my-contacts").data("url"))}}},"json");return false});$("button#user-profile-mini-profile-new-message").click(function(){$(".popover").popover("hide");modalDialog("new-message-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false});$("button#block-user, button#unblock-user").click(function(){var a=$(this);a.find("i").removeClass("fa-ban").addClass("fa-spinner").addClass("fa-pulse");$.post(a.data("url"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{a.find("i").addClass("fa-ban").removeClass("fa-spinner").removeClass("fa-pulse");if(b.added){$('button#block-user[data-id="'+a.data("id")+'"]').hide();$('button#unblock-user[data-id="'+a.data("id")+'"]').show()}else{$('button#block-user[data-id="'+a.data("id")+'"]').show();$('button#unblock-user[data-id="'+a.data("id")+'"]').hide()}}},"json");return false})}function userProfileViewUserInfoHandlers(){$("a#user-profile-view-user-info-add-remove-contact").click(function(){var a=$(this);a.find("i").removeClass("fa-plus-square-o").removeClass("fa-minus-square-o").addClass("fa-spinner").addClass("fa-pulse");$.get(a.attr("href"),{},function(b){if(!b.success){alert("An error occured. Please retry later.")}else{if(b.added){$('a#user-profile-view-user-info-add-remove-contact[data-id="'+a.data("id")+'"]').removeClass("btn-orange").addClass("btn-primary").html('<i class="fa fa-minus-circle"></i> '+$("#user-profile-view-user-info").data("remove-contact"))}else{$('a#user-profile-view-user-info-add-remove-contact[data-id="'+a.data("id")+'"]').addClass("btn-orange").removeClass("btn-primary").html('<i class="fa fa-plus-circle"></i> '+$("#user-profile-view-user-info").data("add-contact"))}if(typeof $("#inbox-my-contacts").data("url")!=="undefined"){$("#inbox-my-contacts").parent().load($("#inbox-my-contacts").data("url"))}}},"json");return false});$("button#user-profile-view-user-info-new-message").click(function(){modalDialog("new-message-dialog",$(this).data("dialog-title"),$(this).data("url"),false);return false})}function userProfileAdministrationPresentationHandlers(){$("#usrPostalcode, #country").on("keyup change",function(){getCities($("#administration-register"))});$("#administration-presentation-form").submit(function(){$("#user-profile-presentation-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#administration-profile-presentation").parent().html(a);if($("#user-profile-presentation-refresh").length){location.reload()}}});return false})}function userProfileUserPresentationHandlers(){$("#usrPostalcode, #country").on("keyup change",function(){getCities($("#user-profile-presentation"))});$("#user-profile-presentation-form").submit(function(){$("#user-profile-presentation-save").find("i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$("#user-profile-presentation").parent().html(a);if($("#user-profile-presentation-refresh").length){location.reload()}}});return false})}function userRegistrationAdministrationRegistrationHandlers(){getCities($("#administration-register"));getRegions($("#administration-register").data("getregions"));a();$("#usrPostalcode").on("keyup change",function(){getCities($("#administration-register"))});$("#adminPostalcode").on("keyup change",function(){getCities($("#administration-register"),"#adminPostalcode","#adminCity")});$("#country").on("keyup change",function(){getCities($("#administration-register"));getRegions($("#administration-register").data("getregions"));getCities($("#administration-register"),"#adminPostalcode","#adminCity")});$("#adminLevel").change(function(){a()});function a(){var b=$("#adminLevel").val();if(b==3){$("#administration-register-administrated-region").hide();$("#administration-register-administrated-city").hide();$("#adminRegion").removeAttr("required");$("#adminPostalcode").removeAttr("required");$("#adminCity").removeAttr("required")}else{if(b==2){$("#administration-register-administrated-region").show();$("#administration-register-administrated-city").hide();$("#adminRegion").attr("required","required");$("#adminPostalcode").removeAttr("required");$("#adminCity").removeAttr("required")}else{$("#administration-register-administrated-region").hide();$("#administration-register-administrated-city").show();$("#adminRegion").removeAttr("required");$("#adminPostalcode").attr("required","required");$("#adminCity").removeAttr("required","required")}}}$("#user-profile-partner-presentation-form").submit(function(){$("#partner-profile-partner-presentation-save > i").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#partner-profile-partner-presentation").parent().html(b)}});return false});$("#partner-profile-partner-presentation-reset").click(function(){$("#partner-profile-partner-presentation-reset > i").removeClass("fa-undo").addClass("fa-spinner").addClass("fa-pulse");$("#partner-profile-partner-presentation").parent().load($(this).attr("href"));return false})}function userRegistrationUserRegistrationHandlers(){$("#user-registration-form").submit(function(){$("#user-registration-submit").prop("disabled","disabled").find("i").removeClass("fa-sign-in").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){$(".modal-body").html(a)}});return false})}function userRegistrationFacebookRegistrationHandlers(){$("#add-user-facebook-form").submit(function(){var a=$(this);$("#facebook-registration-submit").prop("disabled","disabled").find("i").removeClass("fa-sign-in").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){if(typeof b=="object"){window.location=$("#facebook-registration").data("facebook-login-url")}else{$(".modal-body").html(b)}}});return false})}function userRegistrationUserCityHandlers(){$("#user-city-country, #user-city-usrPostalcode").on("keyup change paste",function(){getCities($("#user-city"),$("#user-city-usrPostalcode"),$("#user-city-city"),$("#user-city-country"),"#cityLoad")});$("#add-user-city-form").submit(function(){$("#user-city-submit").prop("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){location.reload()}else{$(".modal-body").html(a)}}});return false})}function userRegistrationUserNameHandlers(){$("#add-user-name-form").submit(function(){$("#user-name-submit").prop("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(a){if(typeof a=="object"){$(".modal").modal("hide")}else{$(".modal-body").html(a)}}});return false})}function userRegistrationPleaseRegisterHandlers(){$("#user-register-please-register-register-button").click(function(){modalDialog("user-registration",$(this).data("dialog-title"),$(this).attr("href"),false);return false});$("#user-register-please-register-login-button").click(function(){window.location=$(this).data("url");return false})}function voteAddHandlers(a){$("#vote").on("change",function(){var b=$("#vote option:selected").val();if(a!=b){$("#changeVoteBtn").removeAttr("disabled")}else{$("#changeVoteBtn").attr("disabled","disabled")}});$("#voteForm").submit(function(){$("#add-change-vote-div-icon").removeClass("fa-sticky-note-o").addClass("fa-spinner").addClass("fa-pulse");$.ajax({data:$(this).serialize(),type:$(this).attr("method"),url:$(this).attr("action"),success:function(b){$("#add-change-vote-div").parent().html(b)}});return false})};