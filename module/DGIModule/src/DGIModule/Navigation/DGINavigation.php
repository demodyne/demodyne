<?php /** * @link      https://github.com/demodyne/demodyne * @copyright Copyright (c) 2015-2016 Demodyne (https://www.demodyne.org) * @license   http://www.gnu.org/licenses/agpl.html GNU Affero General Public License */namespace DGIModule\Navigation;use Zend\ServiceManager\ServiceLocatorInterface;use Zend\Navigation\Service\DefaultNavigationFactory;use Zend\View\Model\ViewModel;use Zend\Session\Container;class DGINavigation extends DefaultNavigationFactory{    protected function getPages(ServiceLocatorInterface $serviceLocator)    {        $navigation = array();        $authService = $serviceLocator->get('Zend\Authentication\AuthenticationService');        $config = $serviceLocator->get('Config');                $viewModel = new ViewModel();        $user = $authService->getIdentity();        if (null === $this->pages) {                        $session = new Container('level');                        $mvcEvent = $serviceLocator->get('Application')                      ->getMvcEvent();            $routeMatch = $mvcEvent->getRouteMatch();             $routeName = ($routeMatch)?$routeMatch->getMatchedRouteName():"";                        if (!$user->isAdministration() || $user->getAdmin()->getAdminLevel()<=$config['demodyne']['account']['admin-level']['city']) {                $navigation[] = array (                    'label' => ($user)?($user->getCity()->getFullCity()?$user->getCity()->getFullCity()->getCityName().' <span class="small"><i>'.$user->getCity()->getDistrictName().'</i></span>':$user->getCity()->getCityName()):'City',                    'route'   => 'city',                    'active' => $session->level == 'city'?true:false                );            }                        if (!$user->isAdministration() || $user->getAdmin()->getAdminLevel()<=$config['demodyne']['account']['admin-level']['region']) {                $navigation[] = array (                    'label' => ($user)?$user->getCity()->getStateName():'Region',                    'route'   => 'region',                    'active' => $session->level == 'region'?true:false                );            }            if (!$user->isAdministration() || $user->getAdmin()->getAdminLevel()<=$config['demodyne']['account']['admin-level']['country']) {                $navigation[] = array (                    'label' => ($user)?'<img src="/img/flags/'.str_replace(' ', '-', $user->getCountry()->getCountryName()).'.png" style="margin-bottom: 4px;" width="25" height="17" alt="'.$user->getCountry()->getCountryName().'"> '.$user->getCountry()->getCountryName():'Country',                    'route'   => 'country',                    'active' => $session->level == 'country'?true:false                );            }                        $router     = $mvcEvent->getRouter();            $pages      = $this->getPagesFromConfig($navigation);            $this->pages = $this->injectComponents(                $pages,                $routeMatch,                $router            );        }        return $this->pages;    }}