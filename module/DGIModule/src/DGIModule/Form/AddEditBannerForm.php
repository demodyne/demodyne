<?php/** * @link      https://github.com/demodyne/demodyne * @copyright Copyright (c) 2015-2017 Demodyne (https://www.demodyne.org) * @license   http://www.gnu.org/licenses/agpl.html GNU Affero General Public License */namespace DGIModule\Form;use Zend\Form\Form;use Zend\InputFilter\InputFilterProviderInterface;use Zend\Mvc\I18n\Translator;use Zend\Hydrator\ClassMethods;use DGIModule\Entity\Banner;use Zend\Validator\File\Size;use Zend\Validator\File\UploadFile;use Zend\Validator\NotEmpty;use Zend\Validator\StringLength;use Zend\Validator\Uri;class AddEditBannerForm extends Form implements InputFilterProviderInterface{    private $translator;    public function __construct(Translator $translator)    {        parent::__construct('banner-form');        $this->translator = $translator;        $this            ->setObject(new Banner())            ->setAttribute('name', 'banner')            ->setOption( 'use_as_base_fieldset', true)            ->setOption( 'use_input_filter_defaults', false)        ;        $this->setAttribute('enctype', 'multipart/form-data');        $this->setAttribute('method', 'post');        $this->setHydrator(new ClassMethods());        $this->add([            'name' => 'bannerName',            'attributes' => [                'type'  => 'text',                'required' => 'required',                'class'=>'form-control text-change',                'id' => 'bannerName',                'maxlength' => 100,                'placeholder' => $translator->translate('Banner name', 'DGIModule')            ],        ]);        $this->add([            'type' => 'Zend\Form\Element\Textarea',            'name' => 'bannerDescription',            'attributes' => [                'required' => 'required',                'rows' => 6,                'class'=>'form-control text-change',                'id' => 'bannerDescription',                'placeholder' => $translator->translate('Enter banner description', 'DGIModule'),                'maxlength' => 1000,            ],        ]);        $this->add([            'name' => 'bannerUrl',//                  'type' => 'Zend\Form\Element\Url',            'attributes' => [                'type'  => 'text',                'required' => 'required',                'class'=>'form-control text-change',                'id' => 'bannerUrl',                'maxlength' => 200,                'placeholder' => $translator->translate('Banner url', 'DGIModule')            ],        ]);        $this->add([            'type' => 'Zend\Form\Element\File',            'name' => 'bannerImage',            //'value' => null,            'attributes' => array(                'type' => 'file',                'accept' => 'image/*',                'id' => 'bannerImage'            ),        ]);    }    /**     * @return array     */    public function getInputFilterSpecification()    {        return array(            'bannerName' => array(                'required' => true,                'filters'  => array(                    array('name' => 'StripTags'),                    array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide a banner name.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',//                              'min'      => 1,                            'max'      => 100,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The banner name is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'bannerDescription' => array(                'required' => true,                'filters' => array(                    array('name' => 'StripTags'),                ),                'validators' => array(                    array(                        'name' => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',                            //'min' => 2,                            'max' => 1000                        ),                    ),                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide a banner description.", 'DGIModule'))                        ),                    ),                ),            ),            'bannerUrl' => array(                'required' => true,                'filters' => array(                    array('name' => 'StripTags'),                    array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide an URL.", 'DGIModule'))                        ),                    ),                    array(                        'name' => 'Uri',                        'options' => array(                            'allowAbsolute' => true,                            'allowRelative' => false,                            'messages' => array(Uri::NOT_URI  => $this->translator->translate("The address does not appear to be a valid URL (should start with 'http(s)://')", 'DGIModule'))                        ),                    ),                    array(                        'name' => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',                            //'min' => 2,                            'max' => 2000,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The URL is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'bannerImage' => array(                'required' => true,                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide an image file.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'Zend\Validator\File\UploadFile',                        'options' => array(                            'messages' => array(                                UploadFile::NO_FILE  => $this->translator->translate("The banner image was not uploaded", 'DGIModule'),                            )                        ),                    ),                    array(                        'name'    => 'Zend\Validator\File\Size',                        'options' => array(                            'max'      => 524288, // 512Ko                            'messages' => array(                                Size::TOO_BIG  => $this->translator->translate("Maximum allowed size for file is 512Kb but '%size%' detected", 'DGIModule'),                                Size::NOT_FOUND  => $this->translator->translate("File is not readable or does not exist", 'DGIModule'),                            )                        ),                    ),                ),            )        );    }}