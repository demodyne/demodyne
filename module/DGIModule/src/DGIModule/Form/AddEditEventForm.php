<?php/** * @link      https://github.com/demodyne/demodyne * @copyright Copyright (c) 2015-2017 Demodyne (https://www.demodyne.org) * @license   http://www.gnu.org/licenses/agpl.html GNU Affero General Public License */namespace DGIModule\Form;use DGIModule\Entity\Event;use Zend\Form\Form;use Zend\InputFilter\InputFilterProviderInterface;use Zend\Hydrator\ClassMethods;use DGIModule\Entity\Hydrator\Strategy\DateTimeStrategy;use Zend\Mvc\I18n\Translator;use Zend\Validator\Date;use Zend\Validator\File\Size;use Zend\Validator\File\UploadFile;use Zend\Validator\NotEmpty;use Zend\Validator\StringLength;use Zend\Validator\Uri;class AddEditEventForm extends Form implements InputFilterProviderInterface{    private $translator;    public function __construct(Translator $translator)    {        parent::__construct('event-add-event-form');        $this->translator = $translator;        $this            ->setObject(new Event())            ->setAttribute('name', 'event')            ->setOption( 'use_as_base_fieldset', true)            ->setOption( 'use_input_filter_defaults', false)        ;        $this->setAttribute('enctype', 'multipart/form-data');        $this->setAttribute('method', 'post');        $hydrator = new ClassMethods();        $hydrator->addStrategy('eventStartDate', new DateTimeStrategy());        $hydrator->addStrategy('eventEndDate', new DateTimeStrategy());        $this->setHydrator($hydrator);        $this->add(array(            'name' => 'eventName',            'attributes' => array(                'type'  => 'text',                'required' => 'required',                'class'=>'form-control text-change',                'id' => 'eventName',                'maxlength' => 200,                'placeholder' => $this->translator->translate('Event name', 'DGIModule'),            ),        ));        $this->add([            'type' => 'Zend\Form\Element\Textarea',            'name' => 'eventDescription',            'attributes' => array(                'rows' => 6,                'class'=>'form-control text-change',                'id' => 'eventDescription',                'placeholder' => $this->translator->translate('Enter event description','DGIModule'),                'style' => 'display:none'            ),        ]);        $this->add(array(            'name' => 'eventLink',//                  'type' => 'Zend\Form\Element\Url',            'attributes' => array(                'type'  => 'text',                'required' => 'required',                'class'=>'form-control text-change',                'id' => 'eventLink',                'maxlength' => 1000,                'placeholder' => $this->translator->translate('Event url', 'DGIModule'),            ),        ));        $this->add([            'type' => 'Zend\Form\Element\File',            'name' => 'eventImage',            'attributes' => array(                'type' => 'file',                'accept' => 'image/*',                'id' => 'eventImage'            ),        ]);        $this->add(array(            'name' => 'eventStartDate',            'type'  => 'Zend\Form\Element\DateTime',            'options' => array(                'label' => 'Start date: ',                'format' => 'd/m/Y H:i',            ),            'attributes' => [                'type'  => 'text',                'id' => 'eventStartDate',                'class'=>'form-control text-change',                'step' => '1', // days; default step interval is 1 day                'placeholder' => 'DD/MM/YYYY HH:mm'            ]        ));        $this->add(array(            'name' => 'eventEndDate',            'type'  => 'Zend\Form\Element\DateTime',            'options' => array(                'label' => 'End date: ',                'format' => 'd/m/Y H:i',            ),            'attributes' => [                'type'  => 'text',                'id' => 'eventEndDate',                'class'=>'form-control text-change',                'step' => '1', // days; default step interval is 1 day                'placeholder' => 'DD/MM/YYYY HH:mm'            ]        ));        $this->add(array(            'name' => 'eventLocation',            'attributes' => array(                'type'  => 'text',                'required' => 'required',                'class'=>'form-control text-change',                'id' => 'eventLocation',                'maxlength' => 500,                'placeholder' => $this->translator->translate('Event location', 'DGIModule'),            ),        ));    }    /**     * @return array     */    public function getInputFilterSpecification()    {        return array(            'eventName' => array(                'required' => true,                'filters'  => array(                    array('name' => 'StripTags'),                    array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide a name for the event.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',//                              'min'      => 1,                            'max'      => 200,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The event name is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'eventDescription' => array(                'required' => true,                'filters' => array(                    array('name' => 'StripTags',                        'options' => [                            'allowTags' => ['b','u', 'i', 'br', 'strong', 'blockquote', 'span', 'div', 'p']                        ]),                    //array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide a description for the event.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',//                              'min'      => 1,                            'max'      => 5000,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The event description is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'eventStartDate' => array(                'required' => true,                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide the start date.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'Date',                        'options' => array(                            'format' => 'd/m/Y H:i',                            'messages' => array(Date::INVALID_DATE  => $this->translator->translate("The start date does not appear to be a valid date", 'DGIModule'))                        ),                    ),                ),            ),            'eventEndDate' => array(                'required' => true,                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide the end date.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'Date',                        'options' => array(                            'format' => 'd/m/Y H:i',                            'messages' => array(Date::INVALID_DATE  => $this->translator->translate("The end date does not appear to be a valid date", 'DGIModule'))                        ),                    ),                ),            ),            'eventLocation' => array(                'required' => true,                'filters'  => array(                    array('name' => 'StripTags'),                    array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide a location.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',//                              'min'      => 1,                            'max'      => 500,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The location is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'eventLink' => array(                'required' => false,                'filters' => array(                    array('name' => 'StripTags'),                    //array('name' => 'StringTrim'),                ),                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide an URL.", 'DGIModule'))                        ),                    ),                    array(                        'name' => 'Uri',                        'options' => array(                            'allowAbsolute' => true,                            'allowRelative' => false,                            'messages' => array(Uri::NOT_URI  => $this->translator->translate("The URL does not appear to be valid (should start with 'http(s)://')", 'DGIModule'))                        ),                    ),                    array(                        'name' => 'StringLength',                        'options' => array(                            'encoding' => 'UTF-8',                            //'min' => 2,                            'max' => 2000,                            'messages' => array(StringLength::TOO_LONG  => $this->translator->translate("The URL is more than %max% characters long", 'DGIModule'))                        ),                    ),                ),            ),            'eventImage' => array(                'required' => false,                'validators' => array(                    array(                        'name'    => 'NotEmpty',                        'options' => array(                            'messages' => array(NotEmpty::IS_EMPTY  => $this->translator->translate("You must provide an image file.", 'DGIModule'))                        ),                    ),                    array(                        'name'    => 'Zend\Validator\File\UploadFile',                        'options' => array(                            'messages' => array(                                UploadFile::NO_FILE  => $this->translator->translate("The banner image was not uploaded", 'DGIModule'),                            )                        ),                    ),                    array(                        'name'    => 'Zend\Validator\File\Size',                        'options' => array(                            'max'      => 524288, // 512Ko                            'messages' => array(                                Size::TOO_BIG  => $this->translator->translate("The maximum file size is 512Kb", 'DGIModule'),                                Size::NOT_FOUND  => $this->translator->translate("File is not readable or does not exist", 'DGIModule'),                            )                        ),                    ),                ),            )        );    }}